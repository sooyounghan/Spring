-----
### ì™¸ë¶€ ì„¤ì • ì‚¬ìš© - Environment
-----
1. ì™¸ë¶€ ì„¤ì •ì€ ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” Environmentë¥¼ í†µí•´ ì¼ê´€ëœ ë°©ì‹ì„ ì¡°íšŒ ê°€ëŠ¥
2. ì™¸ë¶€ ì„¤ì •
   - ì„¤ì • ë°ì´í„° (application.properties)
   - OS í™˜ê²½ë³€ìˆ˜
   - ìë°” ì‹œìŠ¤í…œ ì†ì„±
   - ì»¤ë§¨ë“œ ë¼ì¸ ì˜µì…˜ ì¸ìˆ˜

3. ë‹¤ì–‘í•œ ì™¸ë¶€ ì„¤ì • ì½ê¸°
   - ìŠ¤í”„ë§ì€ EnvironmentëŠ” ë¬¼ë¡ , ì´ë¥¼ í™œìš©í•´ ë” í¸ë¦¬í•˜ê²Œ ì™¸ë¶€ ì„¤ì •ì„ ì½ëŠ” ë°©ë²• ì œê³µ

4. ğŸ’¡ ìŠ¤í”„ë§ì´ ì§€ì›í•˜ëŠ” ë‹¤ì–‘í•œ ì™¸ë¶€ ì„¤ì • ì¡°íšŒ ë°©ë²•
   - Environment
   - @Value : ê°’ ì£¼ì…
   - @ConfigurationProperties : íƒ€ì…ì— ì•ˆì „í•œ ì„¤ì • ì†ì„±

5. ì˜ˆì œ) ê°€ìƒì˜ ë°ì´í„° ì†ŒìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³ , ì—¬ê¸°ì— í•„ìš”í•œ ì†ì„±ì„ ì™¸ë¶€ ì„¤ì •ê°’ìœ¼ë¡œ ì±„ìš´ ë‹¤ìŒ, ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
   - ì´ ì˜ˆì œëŠ” ì™¸ë¶€ ì„¤ì •ê°’ì„ ì–´ë–¤ì‹ìœ¼ë¡œ í™œìš©í•˜ëŠ” ì˜ˆì œ
   - MyDataSource
```java
package hello.datasource;

import jakarta.annotation.PostConstruct;
import lombok.extern.slf4j.Slf4j;

import java.time.Duration;
import java.util.List;

@Slf4j
public class MyDataSource {
    private String url;
    private String username;
    private String password;
    private int maxConnection;
    private Duration timeout;
    private List<String> options;

    public MyDataSource(String url, String username, String password, int maxConnection, Duration timeout, List<String> options) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.maxConnection = maxConnection;
        this.timeout = timeout;
        this.options = options;
    }

    @PostConstruct
    public void init() {
        log.info("url = {}", url);
        log.info("username = {}", username);
        log.info("password = {}", password);
        log.info("maxConnection = {}", maxConnection);
        log.info("timeout = {}", timeout);
        log.info("options = {}", options);
    }
}
```
  - url, username, password : ì ‘ì† URL, ì´ë¦„, ë¹„ë°€ë²ˆí˜¸
  - maxConnection : ìµœëŒ€ ì—°ê²° ìˆ˜
  - timeout : ì‘ë‹µ ì§€ì—° ì‹œ íƒ€ì„ì•„ì›ƒ
  - options : ì—°ê²°ì‹œ ì‚¬ìš©í•˜ëŠ” ê¸°íƒ€ ì˜µì…˜ë“¤
  - @PostConstructì—ì„œ í™•ì¸ì„ ìœ„í•´ ì„¤ì •ëœ ê°’ì„ ì¶œë ¥
  
  - application.properties
```properties
my.datasource.url=local.db.com
my.datasource.username=username
my.datasource.password=password

my.datasource.etc.max-connection=1
my.datasource.etc.timout=3500ms
my.datasource.etc.options=CACHE,ADMIN
```
  - ì™¸ë¶€ ì†ì„±ì€ ì„¤ì • ë°ì´í„°(application.properties) ì‚¬ìš©
  - ì—¬ê¸°ì„œëŠ” ë³„ë„ì˜ í”„ë¡œí•„ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŒ (í™˜ê²½ì— ë”°ë¼ì„œ, ë‹¤ë¥¸ ì„¤ì •ê°’ì´ í•„ìš”í•˜ë©´ ê° í™˜ê²½ì— ë§ëŠ” í”„ë¡œí•„ì„ ì ìš©í•˜ë©´ ë¨)

  - ğŸ’¡ ì°¸ê³  : properties ìºë°¥ í‘œê¸°ë²•
    + propertiesëŠ” ìë°”ì˜ ë‚™íƒ€ í‘œê¸°ë²•(maxConnection)ì´ ì•„ë‹ˆë¼ ì†Œë¬¸ìì™€ -(dash)ë¥¼ ì‚¬ìš©í•˜ëŠ” ìºë°¥ í‘œê¸°ë²•(max-connection)ì„ ì£¼ë¡œ ì‚¬ìš©
    + ì°¸ê³ ë¡œ ì´ê³³ì— ìë°”ì˜ ë‚™íƒ€ í‘œê¸°ë²•ì„ ì‚¬ìš©í•œë‹¤ê³  ë¬¸ì œê°€ ë˜ëŠ” ê²ƒì€ ì•„ë‹˜
    + ìŠ¤í”„ë§ì€ propertiesì—ì„œ ìºë°¥ í‘œê¸°ë²•ì„ ê¶Œì¥

  - ì™¸ë¶€ ì†ì„±ì„ ì½ì–´ì„œ ì•ì„œ ë§Œë“  MyDataSourceì— ê°’ì„ ì„¤ì •í•˜ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
  - MyDataSourceEnvConfig
```java
package hello.config;

import hello.datasource.MyDataSource;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.env.Environment;

import java.time.Duration;
import java.util.List;

@Slf4j
@Configuration
public class MyDataSourceEnvConfig {
    private final Environment env;

    public MyDataSourceEnvConfig(Environment env) {
        this.env = env;
    }

    @Bean
    public MyDataSource myDataSource() {
        String url = env.getProperty("my.datasource.url");
        String username = env.getProperty("my.datasource.username");
        String password = env.getProperty("my.datasource.password");
        Integer maxConnection = env.getProperty("my.datasource.etc.max-connection", Integer.class);
        Duration duration = env.getProperty("my.datasource.etc.timeout", Duration.class); // msëŠ” milli secondë¡œ ì¸ì‹
        List<String> options = env.getProperty("my.datasource.etc.options", List.class);

        return new MyDataSource(url, username, password, maxConnection, duration, options);
    }
}
```
  - MyDataSourceë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ìë°” ì„¤ì •
  - Environmentë¥¼ ì‚¬ìš©í•˜ë©´ ì™¸ë¶€ ì„¤ì • ì¢…ë¥˜ì— ê´€ê³„ ì—†ì´ ì½”ë“œ ì•ˆì—ì„œ ì¼ê´€ì„± ìˆê²Œ ì™¸ë¶€ ì„¤ì • ì¡°íšŒ ê°€ëŠ¥
  - ğŸ’¡ Environment.getProperty(key, Type)ë¥¼ í˜¸ì¶œí•  ë•Œ, íƒ€ì… ì •ë³´ë¥¼ ì£¼ë©´ í•´ë‹¹ íƒ€ì…ìœ¼ë¡œ ë³€í™˜ (ìŠ¤í”„ë§ ë‚´ë¶€ ë³€í™˜ê¸° ì‘ë™)
    + env.getProperty("my.datasource.etc.max-connection", Integer.class) : ë¬¸ìë¥¼ ìˆ«ìë¡œ ë³€í™˜
    + env.getProperty("my.datasource.etc.timout", Duration.class) : ë¬¸ìë¥¼ Duration(ê¸°ê°„)ìœ¼ë¡œ ë³€í™˜
    + env.getProperty("my.datasource.etc.options", List.class) : ë¬¸ìë¥¼ Listë¡œ ë³€í™˜ (A, B â†’ [A, B])
  - ìŠ¤í”„ë§ì€ ë‹¤ì–‘í•œ íƒ€ì…ë“¤ì— ëŒ€í•´ ê¸°ë³¸ ë³€í™˜ ê¸°ëŠ¥ ì œê³µ
    + ì†ì„± ë³€í™˜ê¸° (ìŠ¤í”„ë§ ê³µì‹ ë¬¸ì„œ) : https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config.typesafe-configuration-properties.conversio
```
2024-09-15T21:45:07.892+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : url = local.db.com
2024-09-15T21:45:07.894+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : username = username
2024-09-15T21:45:07.894+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : password = password
2024-09-15T21:45:07.896+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : maxConnection = 1
2024-09-15T21:45:07.896+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : timeout = PT3.5S
2024-09-15T21:45:07.896+09:00  INFO 18488 --- [           main] hello.datasource.MyDataSource            : options = [CACHE, ADMIN]
```

  - ExternalReadApplication - ìˆ˜ì •
```java
package hello;

import hello.config.MyDataSourceEnvConfig;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Import;

@Import(MyDataSourceEnvConfig.class)
@SpringBootApplication(scanBasePackages = "hello.datasource")
public class ExternalReadApplication {

    public static void main(String[] args) {
        SpringApplication.run(ExternalReadApplication.class, args);
    }

}
```
  - ì„¤ì • ì •ë³´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ @Import(MyDataSourceEnvConfig.class) ì¶”ê°€
  - @SpringBootApplication(scanBasePackages = "hello.datasource")
    + ì˜ˆì œì—ì„œëŠ” @Importë¡œ ì„¤ì • ì •ë³´ë¥¼ ê³„ì† ë³€ê²½í•  ì˜ˆì •ì´ë¯€ë¡œ, ì„¤ì • ì •ë³´ë¥¼ ë°”ê¾¸ë©´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ hello.configì˜ ìœ„ì¹˜ë¥¼ í”¼í•´ì„œ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìœ„ì¹˜ ì„¤ì •
    + scanBasePackages ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ìœ„ì¹˜ì¸ hello íŒ¨í‚¤ì§€ë¶€í„° ê·¸ í•˜ìœ„ê°€ ëª¨ë‘ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì˜ ëŒ€ìƒì´ ë¨
    + ë”°ë¼ì„œ, @Configurationì„ í¬í•¨í•˜ê³  ìˆëŠ” MyDataSourceEnvConfigì´ í•­ìƒ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì˜ ëŒ€ìƒì´ ë¨

  - ì‹¤í–‰ ê²°ê³¼
```
2024-09-15T21:49:26.885+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : url = local.db.com
2024-09-15T21:49:26.889+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : username = username
2024-09-15T21:49:26.889+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : password = password
2024-09-15T21:49:26.890+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : maxConnection = 1
2024-09-15T21:49:26.890+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : timeout = PT3.5S
2024-09-15T21:49:26.890+09:00  INFO 11544 --- [           main] hello.datasource.MyDataSource            : options = [CACHE, ADMIN]
```

6. ì •ë¦¬
   - application.propertiesì— í•„ìš”í•œ ì™¸ë¶€ ì„¤ì •ì„ ì¶”ê°€í•˜ê³ , Environmentë¥¼ í†µí•´ í•´ë‹¹ ê°’ë“¤ì„ ì½ì–´, MyDataSoruceë¥¼ ë§Œë“¬
   - í–¥í›„ ì™¸ë¶€ ì„¤ì • ë°©ì‹ì´ ë‹¬ë¼ì ¸ë„, (ì˜ˆë¥¼ ë“¤ì–´, ì„¤ì • ë°ì´í„°(application.properties)ë¥¼ ì‚¬ìš©í–ˆë‹¤ê°€ ì»¤ë§¨ë“œ ë¼ì¸ ì˜µì…˜ ì¸ìˆ˜ë‚˜ ìë°” ì‹œìŠ¤í…œ ì†ì„±ìœ¼ë¡œ ë³€ê²½) ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥

7. ë‹¨ì 
   - ì´ ë°©ì‹ì€ Environmentë¥¼ ì§ì ‘ ì£¼ì… ë°›ê³ , env.getProperty(key)ë¥¼ í†µí•´ì„œ ê°’ì„ êº¼ë‚´ëŠ” ê³¼ì • ë°˜ë³µ
   - ìŠ¤í”„ë§ì€ @Valueë¥¼ í†µí•´ ì™¸ë¶€ ì„¤ì •ê°’ì„ ì£¼ì… ë°›ëŠ” ë”ìš± í¸ë¦¬í•œ ê¸°ëŠ¥ ì œê³µ
  
