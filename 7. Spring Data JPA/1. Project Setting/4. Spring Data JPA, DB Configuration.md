-----
### ìŠ¤í”„ë§ ë°ì´í„° JPAì™€ DB ì„¤ì •, ë™ì‘ í™•ì¸
-----
1. application.properties
```properties
spring.application.name=data-jpa

server.port=9090
spring.output.ansi.enabled=ALWAYS

spring.datasource.url=jdbc:h2:tcp://localhost/~/datajpa
spring.datasource.username=sa

spring.jpa.hibernate.ddl-auto=create
# spring.jpa.properties.hibernate.show_sql=false
spring.jpa.properties.hibernate.format_sql=true

logging.level.org.hibernate.SQL=DEBUG

logging.level.org.springframework.orm.jpa.JpaTransactionManager=DEBUG
logging.level.org.hibernate.resource.transaction=DEBUG

# logging.level.org.hibernate.type=trace # ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x / Hibernate 5
logging.level.org.hibernate.orm.jdbc.bind=trace # ìŠ¤í”„ë§ ë¶€íŠ¸ 3.x / Hibernate 6
```

  - spring.jpa.hibernate.ddl-auto : ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— í…Œì´ë¸”ì„ DROP í•˜ê³ , ë‹¤ì‹œ ìƒì„±
  - ëª¨ë“  ë¡œê·¸ ì¶œë ¥ì€ ê°€ê¸‰ì  ë¡œê·¸ë¥¼ í†µí•´ ë‚¨ê²¨ì•¼ í•¨
    + ğŸ’¡ spring.jpa.properties.hibernate.show_sql : System.outì— í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¹€
    + ğŸ’¡ logging.level.org.hibernate.SQL : Loggerë¥¼ í†µí•´ í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¹€

2. ë™ì‘ í™•ì¸
   - íšŒì› ì—”í‹°í‹°
```java
package study.data_jpa.entity;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import lombok.Getter;

@Entity
@Getter
public class Member {
    @Id @GeneratedValue
    private Long id;
    private String username;

    protected Member() {
        // JPA ìŠ¤í™ìœ¼ë¡œ ì¸í•´ ê¸°ë³¸ ìƒì„±ì ìƒì„±
    }

    public Member(String username) {
        this.username = username;
    }
}
```

  - íšŒì› JPA ë ˆí¬ì§€í† ë¦¬
```java
package study.data_jpa.repository;

import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import org.springframework.stereotype.Repository;
import study.data_jpa.entity.Member;

@Repository
public class MemberJpaRepository {
    @PersistenceContext EntityManager em;

    public Member save(Member member) {
        em.persist(member);
        return member;
    }

    public Member find(Long id) {
        return em.find(Member.class, id);
    }
}
```

  - JPA ê¸°ë°˜ í…ŒìŠ¤íŠ¸
```java
package study.data_jpa.repository;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.transaction.annotation.Transactional;
import study.data_jpa.entity.Member;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
@Transactional
class MemberJpaRepositoryTest {

    @Autowired MemberJpaRepository memberJpaRepository;

    @Test
    public void testMember() {
        Member member = new Member("memberA");

        Member saveMember = memberJpaRepository.save(member);

        Member findMember = memberJpaRepository.find(saveMember.getId());

        assertThat(findMember.getId()).isEqualTo(member.getId());
        assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        assertThat(findMember).isEqualTo(member); // ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ JPA ì—”í‹°í‹° ë™ì¼ì„± ë³´ì¥
    }
}
```

  - ìŠ¤í”„ë§ ë°ì´í„° JPA ë ˆí¬ì§€í† ë¦¬
```java
package study.data_jpa.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import study.data_jpa.entity.Member;

public interface MemberRepository extends JpaRepository<Member, Long> {
    
}
```

  - ìŠ¤í”„ë§ ë°ì´í„° JPA ê¸°ë°˜ í…ŒìŠ¤íŠ¸
```java
package study.data_jpa.repository;

import org.junit.jupiter.api.Test; // ğŸ’¡ Junit 5
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;
import org.springframework.transaction.annotation.Transactional;
import study.data_jpa.entity.Member;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
@Transactional
@Rollback(false)
public class MemberRepositoryTest {
    @Autowired MemberRepository memberRepository;

    @Test
    public void testMember() {
        Member member = new Member("memberA");
        Member savedMember = memberRepository.save(member);

        Member findMember = memberRepository.findById(savedMember.getId()).get();

        assertThat(findMember.getId()).isEqualTo(member.getId());
        assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        assertThat(findMember).isEqualTo(member);
    }
}
```

  - Entity, Repository ë™ì‘ í™•ì¸
  - jar ë¹Œë“œí•´ì„œ ë™ì‘ í™•ì¸
  - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•´ ë³µì¡í•œ ì„¤ì • ëª¨ë‘ ìë™í™”
    + persistence.xmlë„ ì—†ìœ¼ë©°, LocalContainerEntityManagerFactoryBeanë„ ì—†ìŒ
    + ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•œ ì¶”ê°€ ì„¤ì •ì€ ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ë‰´ì–¼ ì°¸ê³ 

3. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸°
   - org.hibernate.type : SQL ì‹¤í–‰ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¹€
   - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© : https://github.com/gavlyukovskiy/spring-boot-data-source-decorator
   - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
```gradle
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.7'
```
   - ì°¸ê³  : ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” ê²ƒì€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ëŠ” ì‹œìŠ¤í…œ ìì›ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” í¸í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
     + í•˜ì§€ë§Œ ìš´ì˜ ì‹œìŠ¤í…œì— ì ìš©í•˜ë ¤ë©´ ê¼­ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ì‚¬ìš©í•  ê²ƒ
   - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ 1.9.0 ì´ìƒ ì‚¬ìš©
```gradle
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0'
```
