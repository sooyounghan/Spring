-----
### ë²Œí¬ì„± ìˆ˜ì • ì¿¼ë¦¬
-----
1. JPAë¥¼ ì‚¬ìš©í•œ ë²Œí¬ì„± ìˆ˜ì • ì¿¼ë¦¬
```java
    public int bulkAgePlus(int age) {
        return em.createQuery("UPDATE Member m SET m.age = m.age + 1 WHERE m.age >= :age")
                .setParameter("age", age)
                .executeUpdate();
    }
```

2. JPAë¥¼ ì‚¬ìš©í•œ ë²Œí¬ì„± ìˆ˜ì • ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
```java
@Test
public void bulkUpdate() {
    // given
    memberJpaRepository.save(new Member("member1", 10));
    memberJpaRepository.save(new Member("member2", 19));
    memberJpaRepository.save(new Member("member3", 20));
    memberJpaRepository.save(new Member("member4", 21));
    memberJpaRepository.save(new Member("member5", 40));

    // when
    int resultCount = memberJpaRepository.bulkAgePlus(20);

    // then
    assertThat(resultCount).isEqualTo(3);
}
```

```
update
    member m1_0 
set
    age=(m1_0.age+1) 
where
    m1_0.age>=?
[data-jpa] [    Test worker] org.hibernate.orm.jdbc.bind              : binding parameter (1:INTEGER) <- [20]
[data-jpa] [    Test worker] p6spy                                    : #1725435681155 | took 4ms | statement | connection 3| url jdbc:h2:tcp://localhost/~/datajpa
```

3. ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•œ ë²Œí¬ì„± ìˆ˜ì • ì¿¼ë¦¬
```java
package study.data_jpa.repository;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Slice;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import study.data_jpa.dto.MemberDto;
import study.data_jpa.entity.Member;

import java.util.Collection;
import java.util.List;
import java.util.Optional;

public interface MemberRepository extends JpaRepository<Member, Long> {

    ...

    @Modifying // executeUpdate()
    @Query("UPDATE Member m SET m.age = m.age + 1 WHERE m.age = :age")
    int bulkAgePlus(@Param("age") int age);
}
```
   - ğŸ’¡ğŸ’¡ ë²Œí¬ì„± ìˆ˜ì •, ì‚­ì œ ì¿¼ë¦¬ëŠ” @Modifying ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©
     + ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ì˜ˆì™¸ ë°œìƒ
     + org.hibernate.hql.internal.QueryExceptionRequestException: Not supported for DML operation

   - ğŸ’¡ ë²Œí¬ì„± ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ë‚˜ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
     + ğŸ’¡ @Modifying(clearAutomatically = true) (ì˜µì…˜ ê¸°ë³¸ê°’ : false)
     + ğŸ’¡ ì´ ì˜µì…˜ ì—†ì´ findByIdë¡œ ë‹¤ì‹œ ì¡°íšŒí•˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê³¼ê±° ê°’ì´ ë‚¨ì•„ì„œ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
     + ğŸ’¡ ë§Œì•½ ë‹¤ì‹œ ì¡°íšŒí•´ì•¼ í•˜ë©´, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê¼­ ì´ˆê¸°í™”
```java
@Modifying(clearAutomatically = true) // ë²Œí¬ ì—°ì‚° í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
@Query("UPDATE Member m SET m.age = m.age + 1 WHERE m.age >= :age")
int bulkAgePlus(@Param("age") int age);
```

   - ğŸ’¡ ì°¸ê³  : ë²Œí¬ ì—°ì‚°ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  ì‹¤í–‰í•˜ë¯€ë¡œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ì—”í‹°í‹°ì˜ ìƒíƒœì™€ DBì˜ ì—”í‹°í‹° ìƒíƒœê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
     + ğŸ’¡ ë”°ë¼ì„œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—”í‹°í‹°ê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ë²Œí¬ ì—°ì‚° ë¨¼ì € ì‹¤í–‰
     + ğŸ’¡ ë¶€ë“ì´í•˜ê²Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—”í‹°í‹°ê°€ ìˆìœ¼ë©´ ë²Œí¬ ì—°ì‚° ì§í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”

4. ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•œ ë²Œí¬ì„± ìˆ˜ì • ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
```java
@Test
public void bulkUpdate() {
    // given
    memberRepository.save(new Member("member1", 10));
    memberRepository.save(new Member("member2", 19));
    memberRepository.save(new Member("member3", 20));
    memberRepository.save(new Member("member4", 21));
    memberRepository.save(new Member("member5", 40));

    // when
    int resultCount = memberRepository.bulkAgePlus(20);

    // then
    assertThat(resultCount).isEqualTo(3);
}
```

