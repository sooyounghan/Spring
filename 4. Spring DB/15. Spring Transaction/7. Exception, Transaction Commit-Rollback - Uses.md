-----
### ì˜ˆì™¸ì™€ íŠ¸ëœì­ì…˜ ì»¤ë°‹, ë¡¤ë°± - í™œìš©
-----
1. ìŠ¤í”„ë§ì€ ì™œ Checked ì˜ˆì™¸ëŠ” ì»¤ë°‹í•˜ê³ , Unchecked(Runtime) ì˜ˆì™¸ëŠ” Rollback í•˜ëŠ” ì´ìœ ëŠ”?
2. ğŸ’¡ ìŠ¤í”„ë§ì€ ê¸°ë³¸ì ìœ¼ë¡œ Checked ì˜ˆì™¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸ê°€ ìˆì„ ë•Œ ì‚¬ìš©í•˜ê³ , Runtime(Unchecked) ì˜ˆì™¸ëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ë¡œ ê°€ì •
   - Checked ì˜ˆì™¸ : ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸ê°€ ìˆì„ ë•Œ ì‚¬ìš©
   - Unchecked ì˜ˆì™¸ : ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸
   - ì°¸ê³ ë¡œ, ê¼­ ì´ëŸ° ì •ì±…ì„ ë”°ë¥¼ í•„ìš”ëŠ” ì—†ìŒ (rollbackForë¼ëŠ” ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ Checked ì—ì™¸ë„ ë¡¤ë°±í•˜ë©´ ë¨)
3. ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸ê°€ ìˆëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ì˜ ì˜ë¯¸?
   - ì˜ˆì œ) ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­
     + ì£¼ë¬¸ì„ í•˜ëŠ”ë° ìƒí™©ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¡°ì¹˜
     + A. ì •ìƒ : ì£¼ë¬¸ ì‹œ ê²°ì œë¥¼ ì„±ê³µí•˜ë©´, ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê²°ì œ ìƒíƒœë¥¼ ì™„ë£Œë¡œ ì²˜ë¦¬
     + B. ì‹œìŠ¤í…œ ì˜ˆì™¸ : ì£¼ë¬¸ ì‹œ ë‚´ë¶€ì— ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì „ì²´ ë°ì´í„° ë¡¤ë°±
     + C. ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ : ì£¼ë¬¸ ì‹œ ê²°ì œ ì”ê³ ê°€ ë¶€ì¡±í•˜ë©´ ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ê²°ì œ ìƒíƒœë¥¼ ëŒ€ê¸°ë¡œ ì²˜ë¦¬
       * ì´ ê²½ìš°, ê³ ê°ì—ê²Œ ì”ê³  ë¶€ì¡±ì„ ì•Œë¦¬ê³ , ë³„ë„ì˜ ê³„ì¢Œë¥¼ ì…ê¸ˆí•˜ë„ë¡ ì•ˆë‚´

   - ì´ ë•Œ, ê²°ì œ ì”ê³ ê°€ ë¶€ì¡±í•˜ë©´ NotEnoughMoneyException ì´ë¼ëŠ” Checked ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤ê³  ê°€ì •
   - ì´ ì˜ˆì™¸ëŠ” ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìˆì–´ì„œ ë°œìƒí•˜ëŠ” ì‹œìŠ¤í…œ ì˜ˆì™¸ê°€ ì•„ë‹˜
   - ì‹œìŠ¤í…œì€ ì •ìƒ ë™ì‘í–ˆì§€ë§Œ, ë¹„ì¦ˆë‹ˆìŠ¤ ìƒí™©ì—ì„œ ë¬¸ì œê°€ ë˜ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ì˜ˆì™¸
   - ë” ìì„¸íˆ ì„¤ëª…í•˜ìë©´, ê³ ê°ì˜ ì”ê³ ê°€ ë¶€ì¡±í•œ ê²ƒì€ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìˆëŠ” ê²ƒì´ ì•„ë‹Œ, ì˜¤íˆë ¤ ì‹œìŠ¤í…œì€ ë¬¸ì œ ì—†ì´ ë™ì‘í•œ ê²ƒì´ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ìƒí™©ì´ ì˜ˆì™¸ì¸ ê²ƒ
   - ì´ëŸ° ì˜ˆì™¸ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ë¼ í•¨
   - ğŸ’¡ ê·¸ë¦¬ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ëŠ” ë§¤ìš° ì¤‘ìš”í•˜ê³ , ë°˜ë“œì‹œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë¯€ë¡œ Checked ì˜ˆì™¸ë¡œ ê³ ë ¤í•  ìˆ˜ ìˆìŒ

4. ë‹¤ìŒ ë¶€ë¶„ë“¤ì€ í…ŒìŠ¤íŠ¸ë¥¼ ì œì™¸í•˜ê³  src/mainì— ì‘ì„±
5. NotEnoughMoneyException
```java
package hello.springtx.order;

public class NotEnoughMoneyException extends Exception {
    public NotEnoughMoneyException(String message) {
        super(message);
    }
}
```
  - ê²°ì œ ì”ê³ ê°€ ë¶€ì¡±í•˜ë©´ ë°œìƒí•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
  - Exceptionì„ ìƒì† ë°›ì•„ì„œ Checked ì˜ˆì™¸ê°€ ë¨

6. Order
```java
package hello.springtx.order;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import lombok.Getter;
import lombok.Setter;

@Entity
@Table(name = "orders")
@Getter
@Setter
public class Order {
    @Id
    @GeneratedValue
    private Long id;

    private String username; // ì •ìƒ, ì˜ˆì™¸, ì”ê³ ë¶€ì¡±
    private String payStatus; // ëŒ€ê¸°, ì™„ë£Œ
}
```
  - JPAë¥¼ ì‚¬ìš©í•˜ëŠ” Order Entity
  - ì˜ˆì œë¥¼ ë‹¨ìˆœí•˜ê²Œ í•˜ê¸° ìœ„í•´ @Getter, @Setter ì‚¬ìš© (ì‹¤ë¬´ì—ì„œëŠ” Entityì— @Setterë¥¼ ë‚¨ë°œí•´ì„œ ë¶ˆí•„ìš”í•œ ë³€ê²½ í¬ì¸íŠ¸ ë…¸ì¶œì€ ì˜³ì§€ ì•ŠìŒ)
  - @Table(name = "orders")ë¼ê³  í–ˆëŠ”ë°, í…Œì´ë¸” ì´ë¦„ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´, í…Œì´ë¸” ì´ë¦„ì´ í´ë˜ìŠ¤ ì´ë¦„ì¸ orderê°€ ë¨ (orderëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì˜ˆì•½ì–´ (order by)ì—¬ì„œ ì‚¬ìš© ë¶ˆê°€í•˜ë¯€ë¡œ ë”°ë¡œ í…Œì´ë¸” ì´ë¦„ ì§€ì •)

7. OrderRepository
```java
package hello.springtx.order;

import org.springframework.data.jpa.repository.JpaRepository;

public interface OrderRepository extends JpaRepository<Order, Long> {
}
```
  - ìŠ¤í”„ë§ ë°ì´í„° JPA ì‚¬ìš©

8. OrderService
```java
package hello.springtx.order;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Slf4j
@Service
@RequiredArgsConstructor
public class OrderService {
    private final OrderRepository orderRepository;

    // JPAëŠ” íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— Order ë°ì´í„°ë¥¼ DBì— ë°˜ì˜
    @Transactional
    public void order(Order order) throws NotEnoughMoneyException {
        log.info("order í˜¸ì¶œ");
        orderRepository.save(order);

        log.info("ê²°ì œ í”„ë¡œì„¸ìŠ¤ ì§„ì…");
        if(order.getUsername().equals("ì˜ˆì™¸")) {
            log.info("ì‹œìŠ¤í…œ ì˜ˆì™¸ ë°œìƒ");
            throw new RuntimeException();
        } else if (order.getUsername().equals("ì”ê³ ë¶€ì¡±")) {
            log.info("ì”ê³ ë¶€ì¡± ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ ë°œìƒ");
            order.setPayStatus("ëŒ€ê¸°");
            throw new NotEnoughMoneyException("ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        } else {
            // ì •ìƒ ìŠ¹ì¸
            log.info("ì •ìƒ ìŠ¹ì¸");
            order.setPayStatus("ì™„ë£Œ");
        }
        log.info("ê²°ì œ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ");
    }
}
```
  - ì—¬ëŸ¬ ìƒí™©ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©ì ì´ë¦„(username)ì— ë”°ë¼ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬
    + ê¸°ë³¸ : payStatusë¥¼ ì™„ë£Œ ìƒíƒœë¡œ ì²˜ë¦¬í•˜ê³ , ì •ìƒ ì²˜ë¦¬
    + ì˜ˆì™¸ : RuntimeException("ì‹œìŠ¤í…œ ì˜ˆì™¸") ëŸ°íƒ€ì„ ì˜ˆì™¸ ë°œìƒ
    + ì”ê³  ë¶€ì¡±
      * payStatusë¥¼ ëŒ€ê¸° ìƒíƒœë¡œ ì²˜ë¦¬
      * NotEnoughException("ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.") Checked ì˜ˆì™¸ ë°œìƒ
      * ì”ê³  ë¶€ì¡±ì€ payStatusë¥¼ ëŒ€ê¸° ìƒíƒœë¡œ ë‘ê³ , Checked ì˜ˆì™¸ë¥¼ ë°œìƒí•˜ì§€ë§Œ, order ë°ì´í„°ëŠ” ì»¤ë°‹ë˜ê¸°ë¥¼ ëŒ€ê¸°

9. OrderServiceTest
```java
package hello.springtx.order;

import lombok.extern.slf4j.Slf4j;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.Optional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatThrownBy;

@Slf4j
@SpringBootTest
class OrderServiceTest {
    @Autowired OrderService orderService;
    @Autowired OrderRepository orderRepository;

    @Test
    void complete() throws NotEnoughMoneyException {
        // given
        Order order = new Order();
        order.setUsername("ì •ìƒ");

        // when
        orderService.order(order);

        // then
        Order findOrder = orderRepository.findById(order.getId()).get();
        assertThat(findOrder.getPayStatus()).isEqualTo("ì™„ë£Œ");
    }

    @Test
    void runtimeException() {
        // given
        Order order = new Order();
        order.setUsername("ì˜ˆì™¸");

        // when
        assertThatThrownBy(() -> orderService.order(order))
                .isInstanceOf(RuntimeException.class);

        // then
        Optional<Order> orderOptional = orderRepository.findById(order.getId());
        assertThat(orderOptional.isEmpty()).isTrue();
    }

    @Test
    void bizException() {
        // given
        Order order = new Order();
        order.setUsername("ì”ê³ ë¶€ì¡±");

        // when
        try {
            orderService.order(order);
        } catch (NotEnoughMoneyException e) {
            log.info("ê³ ê°ì—ê²Œ ì”ê³  ë¶€ì¡±ì„ ì•Œë¦¬ê³ , ë³„ë„ì˜ ê³„ì¢Œë¡œ ì…ê¸ˆí•˜ë„ë¡ ì•ˆë‚´");
        }

        // then
        Order findOrder = orderRepository.findById(order.getId()).get();
        assertThat(findOrder.getPayStatus()).isEqualTo("ëŒ€ê¸°");
    }
}
```

10. ì¤€ë¹„ : ì‹¤í–‰í•˜ê¸° ì „ ë‹¤ìŒì„ ì¶”ê°€ (JPA(Hibernate)ê°€ ì‹¤í–‰í•˜ëŠ” SQL ë¡œê·¸ í™•ì¸ ê°€ëŠ¥
```properties
logging.level.org.hibernate.SQL=DEBUG
```
  - application.properties
```properties
logging.level.org.springframework.transaction.interceptor=TRACE
logging.level.org.springframework.jdbc.datasource.DataSourceTransactionManager=DEBUG

#JPA log
logging.level.org.springframework.orm.jpa.JpaTransactionManager=DEBUG 
logging.level.org.hibernate.resource.transaction=DEBUG

#JPA SQL
logging.level.org.hibernate.SQL=DEBUG
```
  - ì•„ì§ í…Œì´ë¸”ì„ ìƒì„±í•œ ì ì´ ì—†ìœ¼ë‚˜ ì§€ê¸ˆì²˜ëŸ¼ ë©”ëª¨ë¦¬ DBë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´ í…Œì´ë¸” ìë™ ìƒì„± ì˜µì…˜ì´ í™œì„±í™”
  - JPAëŠ” ì—”í‹°í‹° ì •ë³´ë¥¼ ì°¸ê³ í•´ì„œ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±
  - ì°¸ê³ ë¡œ í…Œì´ë¸” ìë™ ìƒì„±ì€ application.propertiesì— spring.jpa.hibernate.ddl-auto ì˜µì…˜ìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥
    + none : í…Œì´ë¸”ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ
    + create : ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— í…Œì´ë¸”ì„ ìƒì„±
  - ì‹¤í–‰ SQL
```
[springtx] [    Test worker] org.hibernate.SQL : create table orders (id bigint not null, pay_status varchar(255), username varchar(255), primary key (id))
```

11. complete()
    - ì‚¬ìš©ì ì´ë¦„ì„ ì •ìƒìœ¼ë¡œ ì„¤ì • (ì¦‰, ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ ì •ìƒ ìˆ˜í–‰)
    - ë‹¤ìŒì„ í†µí•´ ë°ì´í„°ê°€ ì™„ë£Œ ìƒíƒœë¡œ ì €ì¥ ë˜ì—ˆëŠ”ì§€ ê²€ì¦
```java
assertThat(findOrder.getPayStatus()).isEqualTo("ì™„ë£Œ");
```

12. runtimeException()
    - ì‚¬ìš©ì ì´ë¦„ì„ ì˜ˆì™¸ë¡œ ì„¤ì • (ë”°ë¼ì„œ, RuntimeException("ì‹œìŠ¤í…œ ì˜ˆì™¸")ì´ ë°œìƒ)
    - ëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ ë¡¤ë°±ì´ ìˆ˜í–‰ë˜ì—ˆìœ¼ë¯€ë¡œ, Order ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŒ

13. bizException()
    - ì‚¬ìš©ì ì´ë¦„ì„ ì”ê³  ë¶€ì¡±ìœ¼ë¡œ ì„¤ì • (NotEnoughMoneyException("ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")ê°€ ë°œìƒ)
    - Checked ì˜ˆì™¸ë¡œ ì»¤ë°‹ì´ ìˆ˜í–‰ë˜ì—ˆê¸° ë•Œë¬¸ì—, Order ë°ì´í„°ê°€ ì €ì¥
    - ë‹¤ìŒì„ í†µí•´ì„œ ë°ì´í„°ê°€ ëŒ€ê¸° ìƒíƒœë¡œ ì˜ ì €ì¥ë˜ì—ˆëŠ”ì§€ ê²€ì¦
```java
assertThat(findOrder.getPayStatus()).isEqualTo("ëŒ€ê¸°");
```

14. ì •ë¦¬
    - NotEnoughMoneyExceptionì€ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒì´ ì•„ë‹ˆë¼, ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì œ ìƒí™©ì„ ì˜ˆì™¸ë¡œ í†µí•´ ì•Œë ¤ì¤Œ (ì¦‰, ì˜ˆì™¸ê°€ return ê°’ ì²˜ëŸ¼ ì‚¬ìš©ë¨)
    - ë”°ë¼ì„œ, ì´ ê²½ìš°ì—ëŠ” íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ê²ƒì´ ë§ìŒ
    - ì´ ê²½ìš°, ë¡¤ë°±ì„ í•˜ë©´, ìƒì„±í•œ Order ë°ì´í„° ìì²´ê°€ ì‚¬ë¼ì§€ë¯€ë¡œ, ê³ ê°ì—ê²Œ ì”ê³  ë¶€ì¡±ì„ ì•Œë¦¬ê³ , ë³„ë„ì˜ ê³„ì¢Œë¡œ ì…ê¸ˆì„ ì•ˆë‚´í•´ë„ ì£¼ë¬¸(Order) ìì²´ê°€ ì‚¬ë¼ì§€ë¯€ë¡œ ë¬¸ì œê°€ ë°œìƒ
    - ê·¸ëŸ°ë°, ë¹„ì¦ˆë‹ˆìŠ¤ ìƒí™©ì— ë”°ë¼ Checked ì˜ˆì™¸ì˜ ê²½ìš° íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ì§€ ì•Šê³ , ë¡¤ë°±í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆëŠ”ë°, ì´ëŸ´ ë• rollbackFor ì˜µì…˜ ì‚¬ìš©
    - RuntimeExceptionì€ í•­ìƒ ë¡¤ë°±ë˜ë¯€ë¡œ, Checked ì˜ˆì™¸ì˜ ê²½ìš° rollbackFor ì˜µì…˜ì„ ì‚¬ìš©í•´ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒí™©ì— ë”°ë¼ Commitê³¼ Rollbackì„ ì„ íƒí•˜ë©´ ë¨
