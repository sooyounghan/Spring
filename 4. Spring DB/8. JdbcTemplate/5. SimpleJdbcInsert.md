-----
### SimpleJdbcInsert
-----
1. JdbcTemplateì€ INSERT SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ë„ë¡ SimpleJdbcInsertë¼ëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥ ì œê³µ
2. JdbcTemplateRepositoryV3
```java
package hello.itemservice.repository.jdbctemplate;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.extern.slf4j.Slf4j;
import org.springframework.dao.EmptyResultDataAccessException;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;
import org.springframework.stereotype.Repository;
import org.springframework.util.StringUtils;

import javax.sql.DataSource;
import java.util.List;
import java.util.Map;
import java.util.Optional;

/**
 * SimpleJdbcInsert
 */
@Slf4j
@Repository
public class JdbcTemplateRepositoryV3 implements ItemRepository {

    // private final JdbcTemplate template;
    private final NamedParameterJdbcTemplate template;
    private final SimpleJdbcInsert jdbcInsert;

    public JdbcTemplateRepositoryV3(DataSource dataSource) {
        this.template = new NamedParameterJdbcTemplate(dataSource);
        this.jdbcInsert = new SimpleJdbcInsert(dataSource)
                .withTableName("item")
                .usingGeneratedKeyColumns("id");
                // .usingColumns("item_name", "price", "quantity"); // ìƒëµ ê°€ëŠ¥
    }

    @Override
    public Item save(Item item) {
        SqlParameterSource param = new BeanPropertySqlParameterSource(item);
        Number key = jdbcInsert.executeAndReturnKey(param);
        item.setId(key.longValue());
        return item;
    }
    ...
}
```
  - JdbcTemplateItemRepositoryV3ì€ ItemRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„
  - this.jdbcInsert = new SimpleJdbcInsert(dataSource)
    + ìƒì„±ìë¥¼ ë³´ë©´ ì˜ì¡´ ê´€ê³„ ì£¼ì…ì€ dataSourceë¥¼ ë°›ìŒ
    + ë‚´ë¶€ì—ì„œ SimpleJdbcInsertì„ ìƒì„±í•´ì„œ ê°€ì§€ê³  ìˆìŒ
  - ìŠ¤í”„ë§ì—ì„œ JdbcTemplate ê´€ë ¨ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ ê´€ë¡€ ìƒ ì´ ë°©ë²•ì„ ë§ì´ ì‚¬ìš©
  - ë¬¼ë¡ , SimpleJdbcInsertë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì§ì ‘ ë“±ë¡í•˜ê³  ì£¼ì… ë°›ì•„ë„ ë¨

3. SimpleJdbcInsert
```java
this.jdbcInsert = new SimpleJdbcInsert(dataSource)
        .withTableName("item")
        .usingGeneratedKeyColumns("id");
        // .usingColumns("item_name", "price", "quantity"); // ìƒëµ ê°€ëŠ¥
```
  - withTableName : ë°ì´í„°ë¥¼ ì €ì¥í•  í…Œì´ë¸” ëª… ì§€ì •
  - usingGeneratedKeyColumns : keyë¥¼ ìƒì„±í•˜ëŠ” PK ì»¬ëŸ¼ëª…  ì§€ì •
  - usingColumns : INSERT SQLì— ì‚¬ìš©í•  ì»¬ëŸ¼ ì§€ì •. íŠ¹ì • ê°’ë§Œ ì €ì¥í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš© (ìƒëµ ê°€ëŠ¥í•˜ë©°, ìƒëµí•˜ë©´ ëª¨ë“  ì»¬ëŸ¼ ì‚¬ìš©)

4. SimpleJdbcInsertëŠ” ìƒì„± ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì˜ ë©”íƒ€ ë°ì´í„° ì¡°íšŒ
5. ë”°ë¼ì„œ, ì–´ë–¤ ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ usingColumnsì„ ìƒëµ ê°€ëŠ¥
6. ë§Œì•½, íŠ¹ì • ì»¬ëŸ¼ë§Œ ì§€ì •í•´ì„œ ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´ usingColumns ì‚¬ìš©
7. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•´ë³´ë©´, SimpleJdbcInsertì´ ì–´ë–¤ INSERT SQLì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ”ì§€ ë¡œê·¸ í™•ì¸ ê°€ëŠ¥
```
DEBUG 39424 --- [           main] o.s.jdbc.core.simple.SimpleJdbcInsert    : Compiled insert object: insert string is [INSERT INTO item (ITEM_NAME, PRICE, QUANTITY) VALUES(?, ?, ?)]
```

8. save()
   - ğŸ’¡ jdbcInsert.executeAndReturnKey(param)ì„ ì‚¬ìš©í•´ì„œ INSERT SQLì„ ì‹¤í–‰í•˜ê³ , ìƒì„±ëœ í‚¤ ê°’ë„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì¡°íšŒ ê°€ëŠ¥
```java
public Item save(Item item) {
    SqlParameterSource param = new BeanPropertySqlParameterSource(item);
    Number key = jdbcInsert.executeAndReturnKey(param);
    item.setId(key.longValue());
    return item;
}
```

9. JdbcTemplateV3Config
```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbctemplate.JdbcTemplateRepositoryV3;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class JdbcTemplateV3Config {

    private final DataSource dataSource;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JdbcTemplateRepositoryV3(dataSource);
    }
}
```
  - JdbcTemplateItemRepositoryV3ì„ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡

10. ItemServiceApplciation ë³€ê²½
```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;


// @Import(MemoryConfig.class)
// @Import(JdbcTemplateV1Config.class)
// @Import(JdbcTemplateV2Config.class)
@Import(JdbcTemplateV3Config.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```
  - JdbcTemplateV3Config.classë¥¼ ì„¤ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
  - @Import(JdbcTemplateV2Config.class) â†’ @Import(JdbcTemplateV3Config.class)
