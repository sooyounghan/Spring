-----
### ìŠ¤í”„ë§ ë°ì´í„° JPA ì˜ˆì œì™€ íŠ¸ë ˆì´ë“œ ì˜¤í”„
-----
1. í´ë˜ìŠ¤ ì˜ì¡´ ê´€ê³„
<div align="center">
<img src="https://github.com/user-attachments/assets/15770027-f124-4e17-9f27-e8594256fd8b">
</div>

  - ì¤‘ê°„ì— JpaItemRepositoryV2ê°€ ì–´ëŒ‘í„° ì—­í• ì„ í•´ì¤€ ë•ì— ItemServiceê°€ ì‚¬ìš©í•˜ëŠ” ItemRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥
  - í´ë¼ì´ì–¸íŠ¸ì¸ ItemServiceì˜ ì½”ë“œëŠ” ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì  ì¡´ì¬

2. ë¬¸ì œì 
   - êµ¬ì¡°ë¥¼ ë§ì¶”ê¸° ìœ„í•´, ì¤‘ê°„ì— ì–´ëŒ‘í„°ê°€ ë“¤ì–´ê°€ë©´ì„œ ì „ì²´ êµ¬ì¡°ê°€ ë„ˆë¬´ ë³µì¡í•´ì§€ê³ , ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë„ ë§ì•„ì§€ëŠ” ë‹¨ì  ì¡´ì¬
   - ê°œë°œ ì…ì¥ì—ì„œ ë³´ë©´, ì¤‘ê°„ì— ì–´ëŒ‘í„°ë„ ë§Œë“¤ê³ , ì‹¤ì œ ì½”ë“œê¹Œì§€ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ ì¡´ì¬
   - ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ItemServiceë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³ , ItemRepositoryì˜ êµ¬í˜„ì²´ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì¥ì  ì¡´ì¬
   - ì¦‰, DI, OCP ì›ì¹™ì„ ì§€í‚¬ ìˆ˜ ìˆëŠ” ì¥ì  ì¡´ì¬
   - í•˜ì§€ë§Œ, ë°˜ëŒ€ë¡œ êµ¬ì¡°ê°€ ë³µì¡í•´ì§€ë©´ì„œ ì–´ëŒ‘í„° ì½”ë“œì™€ ì‹¤ì œ ì½”ë“œê¹Œì§€ í•¨ê»˜ ìœ ì§€ë³´ìˆ˜í•´ì•¼ í•˜ëŠ” ì–´ë ¤ì›€ ë°œìƒ

3. ë‹¤ë¥¸ ë°©ì•ˆ
   - ItemService ì½”ë“œë¥¼ ì¼ë¶€ ê³ ì³ì„œ ì§ì ‘ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
   - DI, OCP ì›ì¹™ì„ í¬ê¸°í•˜ëŠ” ëŒ€ì‹ , ë³µì¡í•œ ì–´ëŒ‘í„°ë¥¼ ì œê±°í•˜ê³ , êµ¬ì¡°ë¥¼ ë‹¨ìˆœí•˜ê²Œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆëŠ” ì¥ì  ì¡´ì¬
<div align="center">
<img src="https://github.com/user-attachments/assets/403ed519-1e24-453c-a975-7879f24ac4c2">
</div>

   - ItemServiceì—ì„œ ìŠ¤í”„ë§ ë°ì´í„° JPAë¡œ ë§Œë“  ë ˆí¬ì§€í† ë¦¬ë¥¼ ì§ì ‘ ì°¸ì¡° (ë¬¼ë¡ , ì´ ê²½ìš° ItemService ì½”ë“œë¥¼ ë³€ê²½í•´ì•¼ í•¨)
<div align="center">
<img src="https://github.com/user-attachments/assets/3c8d31b5-b89a-42c3-ae57-79efd53cc7ef">
</div>

4. Trade-Off
   - A. ì¦‰, DI, OCPë¥¼ ì§€í‚¤ê¸° ìœ„í•´ ì–´ëŒ‘í„°ë¥¼ ë„ì…í•˜ê³ , ë” ë§ì€ ì½”ë“œë¥¼ ìœ ì§€
   - B. ë˜ëŠ”, ì–´ëŒ‘í„°ë¥¼ ì œê±°í•˜ê³  êµ¬ì¡°ë¥¼ ë‹¨ìˆœí•˜ê²Œ ê°€ì ¸ê°€ì§€ë§Œ, DI, OCPë¥¼ í¬ê¸°í•˜ê³ , ItemService ì½”ë“œë¥¼ ì§ì ‘ ë³€ê²½
     + ì—¬ê¸°ì„œ ë°œìƒí•˜ëŠ” íŠ¸ë ˆì´ë“œ ì˜¤í”„ëŠ” êµ¬ì¡°ì˜ ì•ˆì •ì„±ê³¼ ë‹¨ìˆœí•œ êµ¬ì¡°ì™€ ê°œë°œì˜ í¸ë¦¬ì„± ì‚¬ì´ì˜ ì„ íƒ
     + ê°œë°œì„ í•  ë•Œ í•­ìƒ ìì›ì´ ë¬´í•œí•œ ê²ƒì´ ì•„ë‹ˆë©°, ì–´ì„¤í”ˆ ì¶”ìƒí™”ëŠ” ì˜¤íˆë ¤ ë…ì´ ë  ìˆ˜ ìˆìŒ
     + ğŸ’¡ ë¬´ì—‡ë³´ë‹¤ ì¶”ìƒí™”ë„ ë¹„ìš©ì´ ë“¤ë©°, ì¸í„°í˜ì´ìŠ¤ë„ ë¹„ìš©ì´ ë“¬
     + ğŸ’¡ ì—¬ê¸°ì„œ ë§í•˜ëŠ” ë¹„ìš©ì€ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ë¹„ìš©ì„ ëœ»í•˜ë©°, ì´ ì¶”ìƒí™” ë¹„ìš©ì„ ë„˜ì–´ì„¤ ë§Œí¼ íš¨ê³¼ê°€ ìˆì„ ë•Œ, ì¶”ìƒí™” ë„ì…ì´ ì‹¤ìš©ì 
   - ë”°ë¼ì„œ, í•˜ë‚˜ì˜ ì •ë‹µì´ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆì§€ë§Œ, í”„ë¡œì íŠ¸ì˜ í˜„ì¬ ìƒí™©ì— ë§ëŠ” ë” ì ì ˆí•œ ì„ íƒì§€ê°€ ìˆë‹¤ê³  ìƒê°í•˜ë©°, í˜„ì¬ ìƒí™©ì— ë§ëŠ” ì„ íƒì„ í•´ì•¼í•¨
   
-----
### ì‹¤ìš©ì ì¸ êµ¬ì¡°
-----
1. ë§ˆì§€ë§‰ì— Querydslì„ ì‚¬ìš©í•œ ë ˆí¬ì§€í† ë¦¬ëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì•„ì‰¬ì›€ì´ ì¡´ì¬
2. ë¬¼ë¡  Querydslì„ ì‚¬ìš©í•˜ëŠ” ë ˆí¬ì§€í† ë¦¬ê°€ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•´ë„ ë¨
3. ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ê¸°ëŠ¥ì€ ìµœëŒ€í•œ ì‚´ë¦¬ë©´ì„œ, Querydslë„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°
  - ë³µì¡í•œ ì¿¼ë¦¬ ë¶„ë¦¬
<div align="center">
<img src="https://github.com/user-attachments/assets/66a21280-f496-42fe-9a9d-0773633bb97f">
</div>

  - ItemRepositoryV2ëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë ˆí¬ì§€í† ë¦¬
  - ItemQueryRepositoryëŠ” Querydslë¥¼ ì‚¬ìš©í•´ ë³µì¡í•œ ì¿¼ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë ˆí¬ì§€í† ë¦¬

4. ë‘˜ì„ ë¶„ë¦¬í•˜ë©´, ê¸°ë³¸ CRUDì™€ ë‹¨ìˆœ ì¡°íšŒëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ë‹´ë‹¹, ë³µì¡í•œ ì¡°íšŒ ì¿¼ë¦¬ëŠ” Querydslì´ ë‹´ë‹¹
5. ë¬¼ë¡ , ItemServiceëŠ” ê¸°ì¡´ ItemRepositoryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì½”ë“œ ë³€ê²½ í•„ìš”
6. ItemRepositoryV2
```java
package hello.itemservice.repository.v2;

import hello.itemservice.domain.Item;
import org.springframework.data.jpa.repository.JpaRepository;

public interface ItemRepositoryV2 extends JpaRepository<Item, Long> {

}
```
  - ItemRepositoryV2ëŠ” JpaRepositoryë¥¼ ì¸í„°í˜ì´ìŠ¤ ìƒì†ì„ ë°›ì•„ì„œ ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë ˆí¬ì§€í† ë¦¬ê°€ ë¨
  - ê¸°ë³¸ CRUDëŠ” ì´ ê¸°ëŠ¥ ì‚¬ìš©
  - ì—¬ê¸°ì— ì¶”ê°€ë¡œ ë‹¨ìˆœ ì¡°íšŒ ì¿¼ë¦¬ ì¶”ê°€ ê°€ëŠ¥

7. ItemQueryRepositoryV2
```java
package hello.itemservice.repository.v2;

import com.querydsl.core.types.dsl.BooleanExpression;
import com.querydsl.jpa.impl.JPAQueryFactory;
import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import org.springframework.stereotype.Repository;
import org.springframework.util.StringUtils;

import javax.persistence.EntityManager;
import java.util.List;

import static hello.itemservice.domain.QItem.*;

@Repository
public class ItemQueryRepositoryV2 {
    private final JPAQueryFactory query;

    public ItemQueryRepositoryV2(EntityManager em) {
        this.query = new JPAQueryFactory(em);
    }

    public List<Item> findAll(ItemSearchCond cond) {
        return query.select(item)
                .from(item)
                .where(likeItemName(cond.getItemName()), maxPrice(cond.getMaxPrice()))
                .fetch();
    }

    private BooleanExpression likeItemName(String itemName) {
        if(StringUtils.hasText(itemName)) {
            return item.itemName.like("%" + itemName + "%");
        }

        return null;
    }

    private BooleanExpression maxPrice(Integer maxPrice) {
        if(maxPrice != null) {
            return item.price.loe(maxPrice);
        }

        return null;
    }
}
```
  - ItemQueryRepositoryV2ëŠ” Querydslë¥¼ ì‚¬ìš©í•´ì„œ ë³µì¡í•œ ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°
  - Querydslì„ ì‚¬ìš©í•œ ì¿¼ë¦¬ ë¬¸ì œì— ì§‘ì¤‘ë˜ì–´ ìˆì–´ì„œ, ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ì´ ë¶€ë¶„ë§Œ ìœ ì§€ë³´ìˆ˜ í•˜ë©´ ë¨

8. ItemServiceV2
```java
package hello.itemservice.service;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import hello.itemservice.repository.v2.ItemQueryRepositoryV2;
import hello.itemservice.repository.v2.ItemRepositoryV2;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

@Service
@Transactional
@RequiredArgsConstructor
public class ItemServiceV2 implements ItemService{

    private final ItemRepositoryV2 itemRepositoryV2;
    private final ItemQueryRepositoryV2 itemQueryRepositoryV2;

    @Override
    public Item save(Item item) {
        return itemRepositoryV2.save(item);
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        Item findItem = itemRepositoryV2.findById(itemId).orElseThrow();
        findItem.setItemName(updateParam.getItemName());
        findItem.setPrice(updateParam.getPrice());
        findItem.setQuantity(updateParam.getQuantity());
    }

    @Override
    public Optional<Item> findById(Long id) {
        return itemRepositoryV2.findById(id);
    }

    @Override
    public List<Item> findItems(ItemSearchCond itemSearch) {
        return itemQueryRepositoryV2.findAll(itemSearch);
    }
}
```
  - ê¸°ì¡´ ItemServiceV1 ì½”ë“œë¥¼ ë‚¨ê²¨ë‘ê¸° ìœ„í•´ ItemServiceV2 ì œì‘
  - ItemServiceV2ëŠ” ItemRepositoryV2ì™€ ItemQueryRepositoryV2 ì˜ì¡´

9. V2Config
```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jpa.JpaItemRepositoryV3;
import hello.itemservice.repository.v2.ItemQueryRepositoryV2;
import hello.itemservice.repository.v2.ItemRepositoryV2;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV2;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;

@Configuration
@RequiredArgsConstructor
public class V2Config {
    private final EntityManager em;
    private final ItemRepositoryV2 itemRepositoryV2 // SpringDataJpa

    @Bean
    public ItemService itemService() {
        return new ItemServiceV2(itemRepositoryV2, itemQueryRepositoryV2());
    }

    @Bean
    public ItemQueryRepositoryV2 itemQueryRepositoryV2() {
        return new ItemQueryRepositoryV2(em);
    }

    @Bean
    public ItemRepository itemRepository() { // TestData ì´ˆê¸°í™”
        return new JpaItemRepositoryV3(em);
    }
}
```

  - ItemRepositoryëŠ” í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ë¯€ë¡œ ì—¬ì „íˆ í•„ìš”

10. ItemServiceApplication ë³€ê²½
```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;


// @Import(MemoryConfig.class)
// @Import(JdbcTemplateV1Config.class)
// @Import(JdbcTemplateV2Config.class)
// @Import(JdbcTemplateV3Config.class)
// @Import(MyBatisConfig.class)
// @Import(JpaConfig.class)
// @Import(SpringDataJpaConfig.class)
// @Import(QuerydslConfig.class)
@Import(V2Config.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
@Slf4j
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

  ...
}
```
  - V2Configë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½

11. í…ŒìŠ¤íŠ¸
    - í…ŒìŠ¤íŠ¸ëŠ” ItemRepositoryë¥¼ í…ŒìŠ¤íŠ¸ í•˜ëŠ”ë°, í˜„ì¬ JpaItemRepositoryV3ì´ ë“±ë¡
    - V2Configì—ì„œ ì‚¬ìš©í•œ ë ˆí¬ì§€í† ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´, ItemQueryRepositoryV2, ItemRepositoryV2ìš© í…ŒìŠ¤íŠ¸ ë³„ë„ í•„ìš”
  
