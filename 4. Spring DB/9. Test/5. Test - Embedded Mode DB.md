-----
### í…ŒìŠ¤íŠ¸ - ì„ë² ë””ë“œ ëª¨ë“œ (Embedded Mode)
-----
1. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ê³ , ìš´ì˜í•˜ëŠ” ê²ƒì€ ìƒë‹¹íˆ ë²ˆì¡í•œ ì‘ì—…
2. ë‹¨ìˆœíˆ í…ŒìŠ¤íŠ¸ë¥¼ ê²€ì¦í•  ìš©ë„ë¡œë§Œ ì‚¬ìš©í•˜ê¸° ë–„ë¬¸ì—, í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•´ë„ ë¨
3. ë” ë‚˜ì•„ê°€ì„œ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ ìì²´ë¥¼ ì œê±°í•´ë„ ë¨
4. H2 ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìë°”ë¡œ ê°œë°œë˜ì–´ìˆê³ , JVM ì•ˆì—ì„œ ë©”ëª¨ë¦¬ ëª¨ë“œë¡œ ì‘ë™í•˜ëŠ” íŠ¹ë³„ ê¸°ëŠ¥ ì œê³µ
5. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ë–„ H2 ë°ì´ë²„í…Œì´ìŠ¤ë„ í•´ë‹¹ JVM ë©”ëª¨ë¦¬ì— í¬í•¨í•´ì„œ í•¨ê»˜ ì‹¤í–‰ ê°€ëŠ¥
6. ğŸ’¡ DBë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë‚´ì¥í•´ì„œ í•¨ê»˜ ì‹¤í–‰í•œë‹¤ê³  í•´ì„œ ì„ë² ë””ë“œ ëª¨ë“œ(Embedded Mode)
7. ë¬¼ë¡ , ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë˜ë©´ ì„ë² ë””ë“œ ëª¨ë“œë¡œ ë™ì‘í•˜ëŠ” H2 ë°ì´ë²„í…Œì´ìŠ¤ë„ í•¨ê»˜ ì¢…ë£Œë˜ê³ , ë°ì´í„°ë„ ëª¨ë‘ ì‚­ì œ
8. ì¦‰, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìë°” ë©”ëª¨ë¦¬ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì²˜ëŸ¼ ë™ì‘
9. ì„ë² ë””ë“œ ëª¨ë“œ ì§ì ‘ ì‚¬ìš©
```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;


// @Import(MemoryConfig.class)
// @Import(JdbcTemplateV1Config.class)
// @Import(JdbcTemplateV2Config.class)
@Import(JdbcTemplateV3Config.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
@Slf4j
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

	@Bean
	@Profile("test")
	public DataSource dataSource() {
		log.info("ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”");
		DriverManagerDataSource dataSource = new DriverManagerDataSource();
		dataSource.setDriverClassName("org.h2.Driver");
		dataSource.setUrl("jdbc:h2:mem:db;DB_CLOSE_DELAY=-1");
		dataSource.setUsername("sa");
		dataSource.setPassword("");

		return dataSource;
	}
}
```
  - @Profile("test") : í”„ë¡œí•„ì´ testì¸ ê²½ìš°ì—ë§Œ ë°ì´í„°ì†ŒìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
    + í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì—ì„œë§Œ ì´ ë°ì´í„°ì†ŒìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ì‚¬ìš©
      
  - dataSource()
    + ğŸ’¡ jdbc:h2:mem:db : ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë§Œë“¤ ë•Œ ì´ë ‡ê²Œ ì ìœ¼ë©´ ì„ë² ë””ë“œ ëª¨ë“œ(ë©”ëª¨ë¦¬ ëª¨ë“œ)ë¡œ ë™ì‘í•˜ëŠ” H2 ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ê°€ëŠ¥
    + DB_CLOSE_DELAY=-1 : ì„ë² ë””ë“œ ëª¨ë“œì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì—°ê²°ì´ ëª¨ë‘ ëŠì–´ì§€ë©´ ë°ì´í„°ë² ì´ìŠ¤ë„ ì¢…ë£Œë˜ëŠ”ë°, ì´ë¥¼ ë°©ì§€í•˜ëŠ” ì„¤ì •
    + ì´ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ëª¨ë¦¬ DB ì‚¬ìš© ê°€ëŠ¥
  
  - í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰ë§Œí•˜ë©´, ìƒˆë¡œ ë“±ë¡í•œ ë©”ëª¨ë¦¬ DBì— ì ‘ê·¼í•˜ëŠ” ë°ì´í„°ì†ŒìŠ¤ ì‚¬ìš©
  - ì‹¤í–‰ ê²°ê³¼
```
org.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar []; nested exception is org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "ITEM" not found; SQL statement: insert into item (item_name, price, quantity) values (?, ?, ?) [42102-200]
...
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "ITEM" not found; SQL statement: insert into item (item_name, price, quantity) values (?, ?, ?) [42102-200]
```
   - ğŸ’¡ ì˜¤ë¥˜ëŠ” í•­ìƒ ì•„ë˜ì— ìˆëŠ” ì •ë³´ê°€ ë” ê·¼ë³¸ ì›ì¸ì— ê°€ê¹Œìš´ ì˜¤ë¥˜ ë¡œê·¸
   - Table "ITEM" not found, ì¦‰ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì—†ëŠ” ê²ƒ
   - ì¦‰, ë©”ëª¨ë¦¬ DBì— ì•„ì§ í…Œì´ë¸”ì„ ë§Œë“¤ì§€ ì•Šì€ ê²ƒ

-----
### ìŠ¤í”„ë§ ë¶€íŠ¸ - ê¸°ë³¸ SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”
-----
1. ë©”ëª¨ë¦¬ DBëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë  ë•Œ í•¨ê»˜ ì‚¬ë¼ì§€ë¯€ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ë„ ìƒˆë¡œ ë§Œë“¤ì–´ì¤˜ì•¼ í•¨
2. JDBCë‚˜ JdbcTemplateì„ ì§ì ‘ ì‚¬ìš©í•´ì„œ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” DDLì„ í˜¸ì¶œí•´ë„ ë˜ì§€ë§Œ, ë¶ˆí¸í•¨
3. ë”°ë¼ì„œ, ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê¸°ëŠ¥ ì œê³µ
4. src/testì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ ìƒì„± : src/test/resources/schema.sql
```sql
DROP TABLE IF EXISTS item CASCADE; 
CREATE TABLE item
(
    id        BIGINT GENERATED BY DEFAULT AS IDENTITY, 
    item_name VARCHAR(10),
    price     INTEGER, 
    quantity  INTEGER,
    PRIMARY KEY (id) 
);
```
5. SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ìì„¸í•œ ë°©ë²• : https://docs.spring.io/spring-boot/redirect.html?page=howto#howto.data-initialization.using-basic-sql-scripts

6. ì‹¤í–‰í•˜ë©´ ì •ìƒ ìˆ˜í–‰

7. ë¡œê·¸ í™•ì¸ (ê¸°ë³¸ SQL ìŠ¤í¬ë¦½íŠ¸ê°€ ì˜ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸) (src/test/resources/application.properteis)
```properties
#schema.sql
logging.level.org.springframework.jdbc=debug
```
  - SQL ìŠ¤í¬ë¦½íŠ¸ ë¡œê·¸
```
..init.ScriptUtils     : 0 returned as update count for SQL: drop table if exists item CASCADE
..init.ScriptUtils     : 0 returned as update count for SQL: create table item ( id bigint generated by default as identity, item_name varchar(10), price integer, quantity integer, primary key (id) )
```
