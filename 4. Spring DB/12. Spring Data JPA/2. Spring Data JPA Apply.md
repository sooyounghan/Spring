-----
### ìŠ¤í”„ë§ ë°ì´í„° JPA ì ìš©
-----
1. ì„¤ì •
   - ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” spring-boot-starter-data-jpa ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ì–´ì£¼ë©´ ë¨
   - build.gradle ì¶”ê°€
```gradle
//JPA, ìŠ¤í”„ë§ ë°ì´í„° JPA ì¶”ê°€
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
```
  - ì—¬ê¸°ì—ëŠ” JPA, Hibernate, Spring Data JPA(spring-data-jpa), ê·¸ë¦¬ê³  ìŠ¤í”„ë§ JDBC ê´€ë ¨ ê¸°ëŠ¥ ëª¨ë‘ í¬í•¨

2. SpringDataJpaItemRepository
```java
package hello.itemservice.repository.jpa;

import hello.itemservice.domain.Item;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.util.List;

public interface SpringDataJpaItemRepository extends JpaRepository<Item, Long> {

    List<Item> findByItemNameLike(String itemName);

    List<Item> findByPriceLessThanEqual(Integer price);

    // ì¿¼ë¦¬ ë©”ì„œë“œ
    List<Item> findByItemNameAndPriceLessThanEqual(String itemName, Integer price);

    // ì¿¼ë¦¬ ì§ì ‘ ì‹¤í–‰
    @Query("SELECT i FROM Item i WHERE i.itemName LIKE :itemName and i.price <= :price")
    List<Item> findItems(@Param("itemName") String itemName, @Param("price") Integer price);
}
```
  - ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì† ë°›ìœ¼ë©´ ê¸°ë³¸ì ì¸ CRUD ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
  - ê·¸ëŸ¬ë‚˜, ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ê±°ë‚˜ ê°€ê²©ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì€ ê³µí†µìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì•„ë‹ˆë¯€ë¡œ, ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ @Queryë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ì¿¼ë¦¬ ì‹¤í–‰
  - ì—¬ê¸°ì„œëŠ” ë°ì´í„°ë¥¼ ì¡°ê±´ì— ë”°ë¼ 4ê°€ì§€ë¡œ ë¶„ë¥˜í•´ì„œ ê²€ìƒ‰
    + ëª¨ë“  ë°ì´í„° ì¡°íšŒ
    + ì´ë¦„ ì¡°íšŒ
    + ê°€ê²© ì¡°íšŒ
    + ì´ë¦„ + ê°€ê²© ì¡°íšŒ

3. ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ë™ì  ì¿¼ë¦¬ì— ì•½í•¨ (ë”°ë¼ì„œ, Querydslë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•´ì•¼ í•¨)
   - ìŠ¤í”„ë§ ë°ì´í„° JPAë„ Exampleì´ë¼ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ì•½ê°„ì˜ ë™ì  ì¿¼ë¦¬ë¥¼ ì§€ì›í•˜ì§€ë§Œ, ë¹ˆì•½í•¨

4. findAll()
   - JpaRepository ê³µí†µ ì¸í„°í˜ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
   - ëª¨ë“  Itemì„ ì¡°íšŒí•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ JPQL ì‹¤í–‰
```sql
SELECT i FROM Item i
```

5. findByItemNameLike()
   - ì´ë¦„ ì¡°ê±´ë§Œ ê²€ìƒ‰í–ˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ë©”ì„œë“œ
   - ë‹¤ìŒê³¼ ê°™ì€ JPQL ì‹¤í–‰
```sql
SELECT i FROM Item i WHERE i.itemName LIKE ?
```

6. findByPriceLessThanEqual()
   - ê°€ê²© ì¡°ê±´ë§Œ ê²€ìƒ‰í–ˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ë©”ì„œë“œ
   - ë‹¤ìŒê³¼ ê°™ì€ JPQL ì‹¤í–‰
```sql
SELECT i FROM Item i WHERE i.price <= ?
```

7. findByItemNameAndPriceLessThanEqual()
   - ì´ë¦„ê³¼ ê°€ê²© ì¡°ê±´ì„ ê²€ìƒ‰í–ˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ë©”ì„œë“œ
   - ë‹¤ìŒê³¼ ê°™ì€ JPQL ì‹¤í–‰
```sql
SELECT i FROM Item i WHERE i.itemName LIKE ? AND i.price <= ?
```

8. findItems()
   - ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ì  ì¡´ì¬
     + ì¡°ê±´ì´ ë§ìœ¼ë©´ ë©”ì„œë“œ ì´ë¦„ì´ ê¸¸ì–´ì§
     + ì¡°ì¸ ê°™ì€ ë³µì¡í•œ ì¡°ê±´ ì‚¬ìš© ë¶ˆê°€
   - ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì€ ê°„ë‹¨í•œ ê²½ìš°ì— ìœ ìš©í•˜ì§€ë§Œ, ë³µì¡í•´ì§€ë©´ JPQL ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
     + ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ë ¤ë©´ @Query ì• ë„ˆí…Œì´ì…˜ ì‚¬ìš©
     + ğŸ’¡ ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•´ì•¼ í•˜ì§€ë§Œ, ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‹¤í–‰í•  ë•ŒëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë°”ì¸ë”©
     + ğŸ’¡ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì€ @Param("itemName") ì• ë„ˆí…Œì´ì…˜ ì‚¬ìš©, ì• ë„ˆí…Œì´ì…˜ì˜ ê°’ì— íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ì£¼ë©´ ë¨

9. JpaItemRepoistoryV2
```java
package hello.itemservice.repository.jpa;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.util.List;
import java.util.Optional;

@Repository
@Transactional
@RequiredArgsConstructor
public class JpaItemRepositoryV2 implements ItemRepository {

    private final SpringDataJpaItemRepository repository;

    @Override
    public Item save(Item item) {
        return repository.save(item);
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        Item item = repository.findById(itemId).orElseThrow();
        item.setItemName(updateParam.getItemName());
        item.setPrice(updateParam.getPrice());
        item.setQuantity(updateParam.getQuantity());
    }

    @Override
    public Optional<Item> findById(Long id) {
        return repository.findById(id);
    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        if(StringUtils.hasText(itemName) && maxPrice != null) {
            // = return repository.findByItemNameAndPriceLessThanEqual("%" + itemName + "%", maxPrice);
            return repository.findItems("%" + itemName + "%", maxPrice);
        } else if(StringUtils.hasText(itemName)) {
            return repository.findByItemNameLike("%" + itemName + "%");
        } else if(maxPrice != null) {
            return repository.findByPriceLessThanEqual(maxPrice);
        } else {
            return repository.findAll();
        }
    }
}
```

10. ì˜ì¡´ ê´€ê³„ì™€ êµ¬ì¡°
    - ItemServiceëŠ” ItemRepositoryì— ì˜ì¡´
    - ë”°ë¼ì„œ, ItemServiceì—ì„œ SpringDataJpaItemRepositoryë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
    - ë¬¼ë¡ , ItemServiceê°€ SpringDataJpaItemRepositoryë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë„ë¡ ì½”ë“œë¥¼ ê³ ì¹˜ë©´ ë˜ì§€ë§Œ, ItemService ì½”ë“œ ë³€ê²½ ì—†ì´ ItemServiceê°€ ItemRepositoryì— ì˜ì¡´ì„ ìœ ì§€í•˜ë©´ì„œ DIë¥¼ í†µí•´ êµ¬í˜„ ê¸°ìˆ ì„ ë³€ê²½í•˜ê³  ì‹¶ìŒ
    - ë”°ë¼ì„œ, JpaItemRepositoryV2ê°€ ItemRepositoryì™€ SpringDataJpaItemRepository ì‚¬ì´ë¥¼ ë§ì¶”ê¸° ìœ„í•œ ì–´ëŒ‘í„° ì²˜ëŸ¼ ì‚¬ìš©

11. í´ë˜ìŠ¤ ì˜ì¡´ ê´€ê³„
<div align="center">
<img src="https://github.com/user-attachments/assets/c4a6e7ce-ec4f-4af0-88c9-60d625ba90a2">
</div>

  - JpaItemRepositoryV2ëŠ” ItemRepositoryë¥¼ êµ¬í˜„
  - ê·¸ë¦¬ê³ , SpringDataJpaItemRepositoryë¥¼ ì‚¬ìš©

12. ëŸ°íƒ€ì„ ê°ì²´ ì˜ì¡´ ê´€ê³„
<div align="center">
<img src="https://github.com/user-attachments/assets/6cbd5121-2733-41c9-b84c-6bc1e19af2d5">
</div>

  - itemService â†’ jpaItemRepositoryV2 â†’ springDataJpaItemRepository (í”„ë¡ì‹œ ê°ì²´)
  - ì´ë ‡ê²Œ ì¤‘ê°„ì—ì„œ JpaItemRepositoryê°€ ì–´ëŒ‘í„° ì—­í• ì„ í•´ì¤Œìœ¼ë¡œì¨, ItemServiceê°€ ì‚¬ìš©í•˜ëŠ” ItemRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥
  - í´ë¼ì´ì–¸íŠ¸ì¸ ItemServiceëŠ” ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì 

 13. ê¸°ëŠ¥
  - save() : ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” save() í˜¸ì¶œ
```java
repository.save(item);
```

  - update() : ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” findById() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ Entityë¥¼ ì°¾ì•„ ìˆ˜ì •
    + ì´í›„ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë  ë•Œ, ë³€ê²½ ë‚´ìš©ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ (JPAê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥)

  - findById() : ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” findById() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ Entityë¥¼ ì°¾ìŒ
```java
repository.findById(id);
```

  - findByAll() : ë°ì´í„°ë¥¼ ì¡°ê±´ì— ë”°ë¼ 4ê°€ì§€ë¡œ ë¶„ë¥˜í•´ ê²€ìƒ‰
    + ëª¨ë“  ë°ì´í„° ì¡°íšŒ
    + ì´ë¦„ ì¡°íšŒ
    + ê°€ê²© ì¡°íšŒ
    + ì´ë¦„ + ê°€ê²© ì¡°íšŒ
    + ëª¨ë“  ì¡°ê±´ì— ë¶€í•©í•  ë–„ëŠ” findByItemNameLikeAndPriceLessThanEqaul()ì„ ì‚¬ìš©í•´ë„ ë˜ê³ , repository.findItems() ì‚¬ìš© ê°€ëŠ¥
    + ê·¸ëŸ°ë°, ì¡°ê±´ì´ 2ê°œë§Œ ë˜ì–´ë„ ì´ë¦„ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ëŠ” ë‹¨ì ì´ ì¡´ì¬í•˜ë¯€ë¡œ, ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ê¸°ëŠ¥ê³¼ @Queryë¡œ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ê¸°ëŠ¥ ì¤‘ ì ì ˆí•œ ì„ íƒ í•„ìš”
    + ì½”ë“œë¥¼ ë³´ë©´, ë™ì  ì¿¼ë¦¬ê°€ ì•„ë‹ˆë¼ ìƒí™©ì— ë”°ë¼ ê° ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ìƒë‹¹íˆ ë¹„íš¨ìœ¨ì ì¸ ì½”ë“œ

------
### SpringDataJpaConfig
------
```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jpa.JpaItemRepositoryV2;
import hello.itemservice.repository.jpa.SpringDataJpaItemRepository;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;

@Configuration
@RequiredArgsConstructor
public class SpringDataJpaConfig {

    private final SpringDataJpaItemRepository springDataJpaItemRepository;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JpaItemRepositoryV2(springDataJpaItemRepository);
    }
}
```

  - SpringDataJpaItemRepositoryëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ í”„ë¡ì‹œ ê¸°ìˆ ë¡œ ë§Œë“¤ì–´ì£¼ê³ , ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ ì¤Œ

1. ItemServiceApplication ë³€ê²½
```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;


// @Import(MemoryConfig.class)
// @Import(JdbcTemplateV1Config.class)
// @Import(JdbcTemplateV2Config.class)
// @Import(JdbcTemplateV3Config.class)
// @Import(MyBatisConfig.class)
// @Import(JpaConfig.class)
@Import(SpringDataJpaConfig.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
@Slf4j
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

  ...
}
```
  - SpringDataJpaConfigë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½

2. ì˜ˆì™¸ ë³€í™˜
   - ìŠ¤í”„ë§ ë°ì´í„° JPAë„ ìŠ¤í”„ë§ ì˜ˆì™¸ ì¶”ìƒí™”ë¥¼ ì§€ì›
   - ğŸ’¡ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ë§Œë“¤ì–´ì£¼ëŠ” í”„ë¡ì‹œì—ì„œ ì´ë¯¸ ì˜ˆì™¸ ë³€í™˜ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ @Repositoryì™€ ê´€ê³„ ì—†ì´ ì˜ˆì™¸ ë³€í™˜

3. ğŸ’¡ Hinbernate ë²„ê·¸ (5.6.6 ~ 5.6.7)
   - LIKE ë¬¸ì¥ì—ì„œ ì˜ˆì™¸ ë°œìƒ (ìŠ¤í”„ë§ ë¶€íŠ¸ 2.6.5ë²„ì „ì€ í•´ë‹¹ ë²„ì „ ì‚¬ìš©)
```
java.lang.IllegalArgumentException: Parameter value [\] did not match expected type [java.lang.String (n/a)]
```
   - ì´ëŠ” build.gradleì—ì„œ ë‹¤ìŒì„ ì¶”ê°€í•´ ë¬¸ì œ ì—†ëŠ” ë²„ì „ì¸ 5.6.5 Finalë¡œ ë§ì¶¤
```gradle
group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

ext["hibernate.version"] = "5.6.5.Final"

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}
```
