-----
### Model ì¶”ê°€ - v3
-----
1. ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°
  - ì»¨íŠ¸ë¡¤ëŸ¬ ì…ì¥ì—ì„œ HttpServletRequest, HttpServletResponseê°€ í•„ìš”í•œê°€?
  - ğŸ’¡ ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” ìë°”ì˜ Mapìœ¼ë¡œ ëŒ€ì‹  ë„˜ê¸°ë„ë¡ í•œë‹¤ë©´, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ëª°ë¼ë„ ë™ì‘ ê°€ëŠ¥
  - ğŸ’¡ request ê°ì²´ë¥¼ Modelë¡œ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ë³„ë„ì˜ Model ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ ë¨
  - ì¦‰, êµ¬í˜„í•œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ë³€ê²½í•˜ë©´, êµ¬í˜„ ì½”ë“œë„ ë§¤ìš° ë‹¨ìˆœí•´ì§€ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì´ ì‰¬ì›Œì§   

2. ë·° ì´ë¦„ ì¢…ì†ì„± ì œê±°
   - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§€ì •í•˜ëŠ” ë·° ì´ë¦„ì— ì¤‘ë³µì´ ìˆëŠ” ê²ƒ í™•ì¸ ê°€ëŠ¥
   - ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” 'ë·°ì˜ ë…¼ë¦¬ ì´ë¦„'ì„ ë°˜í™˜í•˜ê³ , ì‹¤ì œ ë¬¼ë¦¬ ìœ„ì¹˜ì˜ ì´ë¦„ì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë‹¨ìˆœí™”
   - í–¥í›„ ë·°ì˜ í´ë” ìœ„ì¹˜ê°€ í•¨ê»˜ ì´ë™í•´ë„ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ê³ ì¹˜ë©´ ë¨
```
/WEB-INF/views/new-form.jsp (ë·°ì˜ ë¬¼ë¦¬ ìœ„ì¹˜) â†’ new-form (ë·°ì˜ ë…¼ë¦¬ ì´ë¦„)
/WEB-INF/views/save-result.jsp (ë·°ì˜ ë¬¼ë¦¬ ìœ„ì¹˜) â†’ save-result (ë·°ì˜ ë…¼ë¦¬ ì´ë¦„)
/WEB-INF/views/members.jsp (ë·°ì˜ ë¬¼ë¦¬ ìœ„ì¹˜) â†’ members (ë·°ì˜ ë…¼ë¦¬ ì´ë¦„)
```

3. v3 êµ¬ì¡°
<div align="center">
<img src="https://github.com/sooyounghan/Spring/assets/34672301/09b83eae-c9ef-4951-a979-f2be0c58fcd9">
</div>

  - viewResolver : Viewì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë·°ì˜ ë¬¼ë¦¬ ìœ„ì¹˜ë¡œ ë³€í™˜í•´ ë°˜í™˜

4. ModelView 
  - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„œë¸”ë¦¿ì— ì¢…ì†ì ì¸ HttpServletRequest ì‚¬ìš©, Modelë„ request.setAttribute()ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë·°ì— ì „ë‹¬
  - ì„œë¸”ë¦¿ ì¢…ì†ì„±ì„ ì œê±°í•˜ê¸° ìœ„í•´ Modelì„ ì§ì ‘ ë§Œë“¤ê³ , ì¶”ê°€ë¡œ View ì´ë¦„ê¹Œì§€ ì „ë‹¬í•˜ëŠ” ê°ì²´ ì „ë‹¬
    + ì¦‰, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ HttpServletReqeustë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë©°, request.setAttribute()ë¥¼ í˜¸ì¶œí•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, Modelì´ ë³„ë„ë¡œ í•„ìš”

-----
### ModelView
-----
1. ModelView ê°ì²´ : frontcontrollerì— ìœ„ì¹˜
```java
package hello.servlet.web.frontcontroller;

import java.util.HashMap;
import java.util.Map;

public class ModelView {
    private String viewName; // Viewì˜ ë…¼ë¦¬ì  ì´ë¦„
    private Map<String, Object> model = new HashMap<>(); // Modelì— ëŒ€í•œ ì •ë³´

    public ModelView(String viewName) {
        this.viewName = viewName;
    }

    public String getViewName() {
        return viewName;
    }

    public void setViewName(String viewName) {
        this.viewName = viewName;
    }

    public Map<String, Object> getModel() {
        return model;
    }

    public void setModel(Map<String, Object> model) {
        this.model = model;
    }
}
```

2. ë·°ì˜ ì´ë¦„ê³¼ ë·°ë¥¼ ë Œë”ë§ í•  ë•Œ, í•„ìš”í•œ Mdoel ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìŒ
3. modelì€ ë‹¨ìˆœíˆ mapìœ¼ë¡œ ë˜ì–´ ìˆì–´ìˆìœ¼ë¯€ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë·°ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ key, valueì— ë„£ì–´ì£¼ë©´ ë¨

-----
### ControllerV3
-----
```java
package hello.servlet.web.frontcontroller.v3;

import hello.servlet.web.frontcontroller.ModelView;

import java.util.Map;

public interface ControllerV3 {
    ModelView process(Map<String, String> paramMap);
}
```

1. í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
2. ë”°ë¼ì„œ, êµ¬í˜„ì´ ë§¤ìš° ë‹¨ìˆœí•´ì§€ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€
3. HttpServeltRequestê°€ ì œê³µí•˜ëŠ” íŒŒë¼ë¯¸í„°ëŠ” Front-Controllerê°€ paramMapì— ë‹´ì•„ì„œ í˜¸ì¶œí•´ì£¼ë©´ ë¨
4. ì‘ë‹µ ê²°ê³¼ë¡œ ë·° ì´ë¦„ê³¼ ë·°ì— ì „ë‹¬í•  Model ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ModelView ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ ë¨

-----
### MemberFormControllerV3 - íšŒì› ë“±ë¡ í¼
-----
```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberFormControllerV3 implements ControllerV3 {
    @Override
    public ModelView process(Map<String, String> paramMap) {
        // ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ModelView ë°˜í™˜
        return new ModelView("new-form");
    }
}
```

1. ModelViewë¥¼ ìƒì„±í•  ë•Œ, new-formì´ë¼ëŠ” Viewì˜ ë…¼ë¦¬ì  ì´ë¦„ì„ ì§€ì •
2. ì‹¤ì œ ë¬¼ë¦¬ì  ì´ë¦„ì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬

-----
### MemberSaveControllerV3 - íšŒì› ì €ì¥
-----
```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberSaveControllerV3 implements ControllerV3 {
    MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        // paramMapì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ request ì •ë³´
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        // í•´ë‹¹ ì •ë³´ë¥¼ Memberì— ì €ì¥
        Member member = new Member(username, age);
        memberRepository.save(member);

        // ModelView ê°ì²´ ìƒì„±(ë·°ì˜ ë…¼ë¦¬ì  ì´ë¦„) í›„, í•´ë‹¹ modelì— member ì €ì¥ í›„ ë°˜í™˜
        ModelView modelView = new ModelView("save-result");
        modelView.getModel().put("member", member);
        return modelView;
    }
}
```

1. paramMap.get("username"), paramMap.get("age") : íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” Mapì— ë‹´ê²¨ìˆìœ¼ë¯€ë¡œ, Mapì— í•„ìš”í•œ ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ ì¡°íšŒ
2. modelView.getModel.put("member", member) : Modelì€ ë‹¨ìˆœí•œ Mapì´ë¯€ë¡œ, ëª¨ë¸ì— ë·°ì—ì„œ í•„ìš”í•œ member ê°ì²´ë¥¼ ë‹´ê³  ë°˜í™˜

-----
### MemberListControllerV3 - íšŒì› ëª©ë¡
-----
```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.List;
import java.util.Map;

public class MemberListControllerV3 implements ControllerV3 {
    private MemberRepository memberRepository = MemberRepository.getInstance();
    @Override
    public ModelView process(Map<String, String> paramMap) {
        // ì „ì²´ íšŒì› ì •ë³´ë¥¼ Listì— ì €ì¥
        List<Member> members = memberRepository.findAll();

        // ModelView ìƒì„± (ë·° ë…¼ë¦¬ì  ì´ë¦„ : members)
        ModelView modelView = new ModelView("members");
        // í•´ë‹¹ ì •ë³´ ì €ì¥
        modelView.getModel().put("members", members);
        return modelView;
    }
}
```

-----
### FrontControllerV3 êµ¬í˜„
-----
```java
package hello.servlet.web.frontcontroller.v3;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v3.controller.MemberFormControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberListControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberSaveControllerV3;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerV3", urlPatterns = "/front-controller/v3/*")
public class FrontControllerV3 extends HttpServlet {

    private Map<String, ControllerV3> controllerMap = new HashMap<>();

    public FrontControllerV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI();

        ControllerV3 controllerV3 = controllerMap.get(requestURI);
        if(controllerV3 == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        Map<String, String> paramMap = createParamMap(request);

        // í•´ë‹¹ paramMapì— ëŒ€í•œ ì •ë³´ë¥¼ Controllerì—ê²Œ ì „ë‹¬
        ModelView modelView = controllerV3.process(paramMap);

        String viewName = modelView.getViewName(); // Viewì˜ ë…¼ë¦¬ ì´ë¦„
        // Viewì˜ ë…¼ë¦¬ ì´ë¦„ â†’ ë¬¼ë¦¬ ê²½ë¡œë¡œ ë³€í™˜ /WEB-INF/views/Viewì˜ ë…¼ë¦¬ì´ë¦„.jsp
        MyView view = viewResolver(viewName);
        view.render(modelView.getModel(), request, response);
    }

    // Request Parameter ì •ë³´ ì¶”ì¶œí•´ Mapì„ ìƒì„±í•˜ê³ , ì €ì¥í•˜ëŠ” ë©”ì„œë“œ
    private Map<String, String> createParamMap(HttpServletRequest request) {
        // paramMap ìƒì„±
        Map<String, String> paramMap = new HashMap<>();
        // Request Parameter ì •ë³´ë¥¼ paramMapì— ì €ì¥
        request.getParameterNames().asIterator()
                        .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```

1. view.render(modelView.getModel(), request, response)
   - MyView ê°ì²´ì— í•´ë‹¹ render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) ë©”ì„œë“œ ì˜¤ë²„ë¡œë”© í•„ìš”

2. ğŸ’¡ createParamMap()
   - HttpServletRequestì—ì„œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ êº¼ë‚´ì„œ Mapìœ¼ë¡œ ë³€í™˜
   - í•´ë‹¹ Map(paramMap)ì„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì „ë‹¬í•˜ë©´ì„œ í˜¸ì¶œ

3. ğŸ’¡ ViewResolver
   - MyView view = viewResolver(viewName);
   - ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°˜í™˜í•œ ë…¼ë¦¬ ë·° ì´ë¦„ì„ ì‹¤ì œ ë¬¼ë¦¬ ë·° ê²½ë¡œë¡œ ë°˜í™˜
   - ì‹¤ì œ ë¬¼ë¦¬ ê²½ë¡œê°€ ìˆëŠ” MyView ê°ì²´ë¥¼ ë°˜í™˜
     + ë…¼ë¦¬ ë·° ì´ë¦„ : members
     + ë¬¼ë¦¬ ë·° ê²½ë¡œ : /WEB-INF/views/members.jsp

4. view.render(modelView.getModel(), request, response)
   - ë·° ê°ì²´ë¥¼ í†µí•´ì„œ HTML í™”ë©´ ë Œë”ë§
   - ë·° ê°ì²´ì˜ render()ëŠ” ëª¨ë¸ ì •ë³´ë„ í•¨ê»˜ ë°›ìŒ
   - ğŸ’¡ JSPëŠ” request.getAttribute()ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë¯€ë¡œ, ëª¨ë¸ì˜ ë°ì´í„°ë¥¼ êº¼ë‚´ì„œ request.setAttribute()ë¡œ ì €ì¥
   - JSPë¡œ forward í•´ì„œ JSPë¥¼ Rendering

5. MyView
```java
package hello.servlet.web.frontcontroller;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.Map;

public class MyView {
    private String viewPath; // ë·° í˜ì´ì§€ ì´ë™ ê²½ë¡œ

    // ì»¨íŠ¸ë¡¤ëŸ¬ì— ì˜í•´ ë·° ê°ì²´ê°€ ìƒì„±ë  ë•Œ, ì´ë™í•  View ê²½ë¡œ ì´ˆê¸°í™”
    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    // ë·° í˜ì´ì§€ë¡œ Rendering ë©”ì„œë“œ
    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher requestDispatcher = request.getRequestDispatcher(viewPath);
        requestDispatcher.forward(request, response);
    }

    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // Model â†’ Request Attributeë¡œ ë³€í™˜
        modelToRequestAttribute(model, request);
        RequestDispatcher requestDispatcher = request.getRequestDispatcher(viewPath);
        requestDispatcher.forward(request, response);
    }

    private void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}
```

  - ì‹¤í–‰
    + ë“±ë¡ : http://localhost:9090/front-controller/v3/members/new-form
    + ëª©ë¡ : http://localhost:9090/front-controller/v3/members
