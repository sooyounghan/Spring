------
### HTML VS API ì˜¤ë¥˜
------
1. ì›¹ ë¸Œë¼ìš°ì € HTML í™”ë©´ì„ ì œê³µí•  ë•Œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ BasicErrorControllerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•¨
   - ë‹¨ìˆœíˆ 5xx, 4xxì™€ ê´€ë ¨ëœ ì˜¤ë¥˜ í™”ë©´ì„ ë³´ì—¬ì£¼ë©´ ë˜ë¯€ë¡œ, ì´ëŸ° ë©”ì»¤ë‹ˆì¦˜ì„ ëª¨ë‘ êµ¬í˜„
2. í•˜ì§€ë§Œ, APIëŠ” ê° ì‹œìŠ¤í…œ ë§ˆë‹¤ ì‘ë‹µì˜ ëª¨ì–‘ë„ ë‹¤ë¥´ë©°, ìŠ¤í™ë„ ë‹¤ë¦„
   - ë‹¨ìˆœíˆ ì˜¤ë¥˜ í™”ë©´ì„ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ì•„ë‹Œ, ì˜ˆì™¸ì— ë”°ë¼ ê°ê° ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì¶œë ¥í•´ì•¼ í•  ìˆ˜ ìˆìŒ
   - ê·¸ë¦¬ê³ , ê°™ì€ ì˜ˆì™¸ë¼ê³  í•˜ë”ë¼ë„ ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí–ˆëŠ”ê°€ì— ë”°ë¼ ë‹¤ë¥¸ ì˜ˆì™¸ ì‘ë‹µì„ ë‚´ë ¤ì£¼ì–´ì•¼ í•  ìˆ˜ ìˆìŒ (ì¦‰, ì„¸ë°€í•œ ì œì–´ê°€ í•„ìš”)

-----
### API ì˜ˆì™¸ ì²˜ë¦¬ì˜ ì–´ë ¤ìš´ ì 
-----
1. HandlerExceptionResolverëŠ” ModelAndViewë¥¼ ë°˜í™˜í•˜ëŠ”ë°, ì´ëŠ” API ì‘ë‹µì—ëŠ” í•„ìš”í•˜ì§€ ì•ŠìŒ
2. API ì‘ë‹µì„ ìœ„í•´ì„œëŠ” HttpServletResponseì— ì§ì ‘ ì‘ë‹µ ë°ì´í„°ë¥¼ ë„£ì–´ì¤Œ
3. íŠ¹ì • ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë§Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ë³„ë„ë¡œ ì²˜ë¦¬í•˜ê¸° ì–´ë ¤ì›€
   - ì˜ˆë¥¼ ë“¤ì–´, íšŒì›ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” RuntimeException ì˜ˆì™¸ì™€ ìƒí’ˆì„ ê´€ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•œ ë™ì¼í•œ RuntimeExceptin ì˜ˆì™¸ë¥¼ ì„œë¡œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´?

-----
### @ExceptionHandler
-----
1. ìŠ¤í”„ë§ì€ API ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ @ExceptionHandlerë¼ëŠ” ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë§¤ìš° í¸ë¦¬í•œ ì˜ˆì™¸ ì²˜ë¦¬ ê¸°ëŠ¥ ì œê³µ
2. ì´ê²ƒì´ ë°”ë¡œ ExceptionHandlerExceptionResolver
3. ìŠ¤í”„ë§ì€ ê¸°ë³¸ìœ¼ë¡œ ExceptionHandlerExceptionResolverë¥¼ ì œê³µí•˜ê³ , ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ExceptionHandler ì¤‘ì—ì„œë„ ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ìŒ
4. ì‹¤ë¬´ì—ì„œ API ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ëŒ€ë¶€ë¶„ ì´ ê¸°ëŠ¥ ì‚¬ìš©

-----
### ì˜ˆì œ
-----
1. ErrorResult
```java
package hello.exception.exhandler;

import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class ErrorResult {
    private String code;
    private String message;
}
```
  - ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ API ì‘ë‹µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ ì •ì˜

2. ApiExceptionV2Controller
```java
package hello.exception.api;

import hello.exception.exception.UserException;
import hello.exception.exhandler.ErrorResult;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@Slf4j
@RestController
public class ApiExceptionV2Controller {

    @ResponseStatus(HttpStatus.BAD_REQUEST)
    @ExceptionHandler(IllegalArgumentException.class)
    public ErrorResult illegalExHandler(IllegalArgumentException e) {
        log.error("[exceptionHandler] ex", e);
        return new ErrorResult("BAD", e.getMessage());
    }

    @ExceptionHandler
    public ResponseEntity<ErrorResult> userExHandler(UserException e) {
        log.error("[exceptionHandler] ex", e);
        ErrorResult errorResult = new ErrorResult("USER-EX", e.getMessage());

        return new ResponseEntity<>(errorResult, HttpStatus.BAD_REQUEST);
    }

    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ExceptionHandler
    public ErrorResult exHandler(Exception e) {
        log.error("[exceptionHandler] ex", e);
        return new ErrorResult("EX", e.getMessage());
    }

    @GetMapping("/api2/members/{id}")
    public MemberDto getMember(@PathVariable String id) {
        if(id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }

        if(id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }

        if(id.equals("user-ex")) {
            throw new UserException("ì‚¬ìš©ì ì˜¤ë¥˜");
        }

        return new MemberDto(id, "hello " + id);
    }

    @Data
    @AllArgsConstructor
    static class MemberDto {
        private String memberId;
        private String name;
    }
}
```

3. @ExceptionHandler ì˜ˆì™¸ ì²˜ë¦¬ ë°©ë²•
   - ğŸ’¡ @ExceptionHandler ì• ë„ˆí…Œì´ì…˜ì„ ì„ ì–¸í•˜ê³ , í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ì˜ˆì™¸ë¥¼ ì§€ì •
   - ğŸ’¡ í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ ë©”ì„œë“œê°€ í˜¸ì¶œ
   - ğŸ’¡ ì°¸ê³ ë¡œ, ì§€ì •í•œ ì˜ˆì™¸ ë˜ëŠ” ê·¸ ì˜ˆì™¸ì˜ ìì‹ í´ë˜ìŠ¤ëŠ” ëª¨ë‘ ì¡ì„ ìˆ˜ ìˆìŒ
   - ì˜ˆ) IllegalArgumentException ë˜ëŠ” ê·¸ í•˜ìœ„ ìì‹ í´ë˜ìŠ¤ ëª¨ë‘ ì²˜ë¦¬ ê°€ëŠ¥
```java
@ExceptionHandler(IllegalArgumentException.class)
public ErrorResult illegalExHandler(IllegalArgumentException e) {
    log.error("[exceptionHandler] ex", e);
    return new ErrorResult("BAD", e.getMessage());
}
```
   - í•´ë‹¹ ì˜ˆì™¸ë¥¼ ì¡ê³ , WASì— ì •ìƒ ì‘ë‹µí•˜ë¯€ë¡œ HttpStatusëŠ” 200 (OK)ë˜ë¯€ë¡œ, ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ @ResponseStatus(HttpStatus.ìƒíƒœì½”ë“œ) ì§€ì •

4. ìš°ì„ ìˆœìœ„
   - ğŸ’¡ ìŠ¤í”„ë§ì˜ ìš°ì„  ìˆœìœ„ëŠ” í•­ìƒ ìì„¸í•œ ê²ƒì´ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§
   - ì˜ˆë¥¼ ë“¤ì–´, ë¶€ëª¨ / ìì‹ í´ë˜ìŠ¤ê°€ ìˆê³ , ë‹¤ìŒê³¼ ê°™ì´ ì˜ˆì™¸ê°€ ì²˜ë¦¬
```java
@ExceptionHandler(ë¶€ëª¨ì˜ˆì™¸.class)
public String ë¶€ëª¨ì˜ˆì™¸ì²˜ë¦¬(ë¶€ëª¨ì˜ˆì™¸ e) { }

@ExceptionHandler(ìì‹ì˜ˆì™¸.class)
public String ìì‹ì˜ˆì™¸ì²˜ë¦¬(ìì‹ì˜ˆì™¸ e) { }
```
  - @ExceptionHandlerì— ì§€ì •í•œ ë¶€ëª¨ í´ë˜ìŠ¤ëŠ” ìì‹ í´ë˜ìŠ¤ê¹Œì§€ ì²˜ë¦¬ ê°€ëŠ¥
  - ğŸ’¡ ë”°ë¼ì„œ, ìì‹ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë¶€ëª¨ ì˜ˆì™¸ì²˜ë¦¬(), ìì‹ ì˜ˆì™¸ ì²˜ë¦¬() ë‘˜ë‹¤ í˜¸ì¶œ ëŒ€ìƒì´ ë¨
  - ğŸ’¡ ê·¸ëŸ°ë°, ë‘˜ ì¤‘ ì¢€ ë” ìì„¸í•œ ê²ƒì´ ìš°ì„ ê¶Œì„ ê°€ì§€ë¯€ë¡œ ìì‹ ì˜ˆì™¸ ì²˜ë¦¬()ê°€ í˜¸ì¶œ
  - ğŸ’¡ ë¬¼ë¡ , ë¶€ëª¨ ì˜ˆì™¸ê°€ í˜¸ì¶œë˜ë©´ ë¶€ëª¨ ì˜ˆì™¸ ì²˜ë¦¬()ë§Œ í˜¸ì¶œ ëŒ€ìƒì´ ë˜ë¯€ë¡œ ë¶€ëª¨ ì˜ˆì™¸ ì²˜ë¦¬()ê°€ í˜¸ì¶œ

5. ë‹¤ì–‘í•œ ì˜ˆì™¸
   - ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì˜ˆì™¸ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬ ê°€ëŠ¥
```java
@ExceptionHandler({AException.class, BException.class})
public String ex(Exception e) {
  log.info("exception e", e);
}
```

6. ì˜ˆì™¸ ìƒëµ
   - @ExceptionHandlerì— ì˜ˆì™¸ ìƒëµ ê°€ëŠ¥ : ìƒëµí•˜ë©´ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ì˜ ì˜ˆì™¸ê°€ ì§€ì •
```java
@ExceptionHandler
public ResponseEntity<ErrorResult> userExHandler(UserException e) {
    log.error("[exceptionHandler] ex", e);
    ErrorResult errorResult = new ErrorResult("USER-EX", e.getMessage());

    return new ResponseEntity<>(errorResult, HttpStatus.BAD_REQUEST);
}
```

7. íŒŒë¼ë¯¸í„°ì™€ ì‘ë‹µ
   - @ExceptionHandlerì—ëŠ” ë§ˆì¹˜ ìŠ¤í”„ë§ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŒŒë¼ë¯¸í„° ì‘ë‹µì²˜ëŸ¼ ë‹¤ì–‘í•œ íŒŒë¼ë¯¸í„°ì™€ ì‘ë‹µ ì§€ì • ê°€ëŠ¥
   - https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-exceptionhandler-args
  
8. Postman ì‹¤í–‰ ê²°ê³¼
   - IllegalArgumentException ì²˜ë¦¬
```java
@ResponseStatus(HttpStatus.BAD_REQUEST)
@ExceptionHandler(IllegalArgumentException.class)
public ErrorResult illegalExHandler(IllegalArgumentException e) {
    log.error("[exceptionHandler] ex", e);
    return new ErrorResult("BAD", e.getMessage());
}
```
   - http://localhost:9090/api2/members/bad
   - ì‹¤í–‰ íë¦„
     + ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•œ ê²°ê³¼ IllegalArgumentException ì˜ˆì™¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë˜ì ¸ì§
     + ì˜ˆì™¸ê°€ ë°œìƒí–ˆìœ¼ë¯€ë¡œ ExceptionResolverê°€ ì‘ë™í•˜ê³ , ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ì€ ExceptionHandlerExceptionResolver í˜¸ì¶œ
     + ExceptionHandlerExceptionResolverëŠ” í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì— IllegalArgumentExceptionì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” @ExceptionHandlerê°€ ìˆëŠ”ì§€ í™•ì¸
     + illegalExHandle()ì„ ì‹¤í–‰í•˜ë©°, @RestControllerì´ë¯€ë¡œ, í•´ë‹¹ ë©”ì„œë“œì—ë„ ì ìš©ë˜ë©°, HTTP ì»¨ë²„í„°ê°€ ì‚¬ìš©ë˜ì–´ ì‘ë‹µì€ JSONìœ¼ë¡œ ë°˜í™˜
     + @ResponseStatus(HttpStatus.BAD_REQUEST)ë¥¼ ì§€ì •í–ˆìœ¼ë¯€ë¡œ HTTP ìƒíƒœ ì½”ë“œ 400ìœ¼ë¡œ ì‘ë‹µ
```json
{
    "code": "BAD",
    "message": "ì˜ëª»ëœ ì…ë ¥ ê°’"
}
```

  - UserException ì²˜ë¦¬
```java
@ExceptionHandler
public ResponseEntity<ErrorResult> userExHandler(UserException e) {
    log.error("[exceptionHandler] ex", e);
    ErrorResult errorResult = new ErrorResult("USER-EX", e.getMessage());

    return new ResponseEntity<>(errorResult, HttpStatus.BAD_REQUEST);
}
```
  - http://localhost:9090/api2/members/user-ex
  - ì‹¤í–‰ íë¦„
    + @ExceptionHandlerì— ì˜ˆì™¸ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ í•´ë‹¹ ë©”ì„œë“œ íŒŒë¼ë¯¸í„° ì˜ˆì™¸ë¥¼ ì‚¬ìš© (ì—¬ê¸°ì„œëŠ” UserException)
    + ResponseEntityë¥¼ ì‚¬ìš©í•´ì„œ HTTP ë©”ì„¸ì§€ ë°”ë””ì— ì§ì ‘ ì‘ë‹µ (ë¬¼ë¡ , HTTP ì»¨ë²„í„°ê°€ ì‚¬ìš©)
    + ğŸ’¡ ResponseEntityë¥¼ ì‚¬ìš©í•˜ë©´ HTTP ì‘ë‹µ ì½”ë“œë¥¼ í”„ë¡œê·¸ë˜ë°í•´ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŒ (@ResponseStatusëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë¯€ë¡œ ë™ì ìœ¼ë¡œ ë³€ê²½ ë¶ˆê°€)

  - Exception
```java
@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
@ExceptionHandler
public ErrorResult exHandler(Exception e) {
    log.error("[exceptionHandler] ex", e);
    return new ErrorResult("EX", e.getMessage());
}
```

  - http://localhost:9090/api2/members/ex
  - ì‹¤í–‰ íë¦„
  - + throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì") ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ, ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ RuntimeExceptionì´ ë˜ì ¸ì§
    + RuntimeExceptionì€ Exceptionì˜ ìì‹ í´ë˜ìŠ¤ì´ë¯€ë¡œ, ì´ ë©”ì„œë“œê°€ í˜¸ì¶œ
    + @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)ë¡œ HTTP ìƒíƒœ ì½”ë“œë¥¼ 500ìœ¼ë¡œ ì‘ë‹µ

9. ê¸°íƒ€
    - HTML ì˜¤ë¥˜ í™”ë©´ì˜ ê²½ìš° ModelAndViewë¥¼ ì‚¬ìš©í•´ ì˜¤ë¥˜ í™”ë©´(HTML) ì‘ë‹µì— ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
```java
@ExceptionHandler(ViewException.class) 
public ModelAndView ex(ViewException e) { 
    log.info("exception e", e);
    return new ModelAndView("error"); 
}
```
