-----
### Validator
-----
1. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê²€ì¦ ë¡œì§ì´ ì°¨ì§€í•˜ëŠ” ë¶€ë¶„ì€ ë§¤ìš° í°ë°, ì´ëŸ° ê²½ìš° ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ì—­í• ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
2. ì´ë ‡ê²Œ ë¶„ë¦¬í•œ ê²€ì¦ ë¡œì§ì„ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆìŒ
3. Validator ì¸í„°í˜ì´ìŠ¤
```java
public interface Validator {
    boolean supports(Class<?> clazz);
    void validate(Object target, Errors errors); 
}
```
  - supports() { } : í•´ë‹¹ ê²€ì¦ê¸°ë¥¼ ì§€ì›í•˜ëŠ” ì—¬ë¶€ í™•ì¸
  - validate(Object target, Errors errors) : ê²€ì¦ ëŒ€ìƒ ê°ì²´ì™€ BindingResult
    
4. ItemValidator
```java
package hello.itemservice.web.validation;

import hello.itemservice.domain.item.Item;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;
import org.springframework.validation.Errors;
import org.springframework.validation.Validator;

@Component
public class ItemValidator implements Validator {
    @Override
    public boolean supports(Class<?> clazz) {
        // Item == clazz or Item == subItem
        return Item.class.isAssignableFrom(clazz);
    }

    @Override
    public void validate(Object target, Errors errors) {
        Item item = (Item) target;

        // ê²€ì¦ ë¡œì§
        if(!StringUtils.hasText(item.getItemName())) {
            // ë¬¼ê±´ëª…ì— ê¸€ìê°€ ì—†ìœ¼ë©´, í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•œ ê²€ì¦ ì‹¤íŒ¨ ì´ìœ  ëª…ì‹œ
            errors.rejectValue("itemName", "required");
        }

        if(item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
            // ê°€ê²© ì •ë³´ê°€ ì—†ê±°ë‚˜ 1000ì› ë¯¸ë§Œ, ë°±ë§Œì› ì´ˆê³¼í•˜ëŠ” ê¸ˆì•¡ì´ë©´, í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•œ ê²€ì¦ ì‹¤íŒ¨ ì´ìœ  ëª…ì‹œ
            errors.rejectValue("price", "range", new Object[]{1000, 1000000}, null);
        }

        if(item.getQuantity() == null || item.getQuantity() > 9999) {
            // ìˆ˜ëŸ‰ì´ ì—†ê±°ë‚˜, 9999ë¥¼ ì´ˆê³¼í•œë‹¤ë©´, í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•œ ê²€ì¦ ì‹¤íŒ¨ ì´ìœ  ëª…ì‹œ
            errors.rejectValue("quantity", "max", new Object[]{9999}, null);
        }

        // íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© Rule ê²€ì¦
        if(item.getPrice() != null && item.getQuantity() != null) {
            // ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì´ ì¡´ì¬í•¨
            int resultPrice = item.getPrice() * item.getQuantity();
            if(resultPrice < 10000) {
                // ê°€ê²© * ìˆ˜ëŸ‰ ê°’ì´ 10000ì› ë¯¸ë§Œì´ë©´, í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•œ ê²€ì¦ ì‹¤íŒ¨ ì´ìœ  ëª…ì‹œ
                errors.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }
    }
}
```

5. ItemValidator ì§ì ‘ í˜¸ì¶œí•˜ê¸° (ValidationItemControllerV2 - addItemV5())
```java
package hello.itemservice.web.validation;

import hello.itemservice.domain.item.Item;
import hello.itemservice.domain.item.ItemRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.util.StringUtils;
import org.springframework.validation.BindingResult;
import org.springframework.validation.FieldError;
import org.springframework.validation.ObjectError;
import org.springframework.validation.ValidationUtils;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.View;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Slf4j
@Controller
@RequestMapping("/validation/v2/items")
@RequiredArgsConstructor
public class ValidationItemControllerV2 {

    private final ItemRepository itemRepository;
    private final ItemValidator itemValidator;

    @PostMapping("/add")
    public String addItemV5(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes, Model model) {

        itemValidator.validate(item, bindingResult);

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´, ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ ì´ë™
        if(bindingResult.hasErrors()) {
            log.info("errors={}", bindingResult);
            return "validation/v2/addForm";
        }

        // ê²€ì¦ ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v2/items/{itemId}";
    }
}
```
  - ItemValidatorë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì£¼ì… ë°›ì•„ì„œ ì§ì ‘ í˜¸ì¶œ
  - ê¸°ì¡´ê³¼ ì™„ì „í•˜ê²Œ ë™ì‘

-----
### Validator ë¶„ë¦¬
-----
1. ìŠ¤í”„ë§ì´ Validator ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³„ë„ë¡œ ì œê³µí•˜ëŠ” ì´ìœ ëŠ” ì²´ê³„ì ìœ¼ë¡œ ê²€ì¦ ê¸°ëŠ¥ì„ ë„ì…í•˜ê¸° ìœ„í•´ì„œì„
2. ê·¸ëŸ°ë°, ì•ì—ì„œëŠ” ê²€ì¦ê¸°ë¥¼ ë¶ˆëŸ¬ì„œ ì‚¬ìš©í–ˆê³ , ì´ë ‡ê²Œ ì‚¬ìš©í•´ë„ ë¨
3. ê·¸ëŸ°ë° Validator ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ ê²€ì¦ê¸°ë¥¼ ë§Œë“¤ë©´ ìŠ¤í”„ë§ì˜ ì¶”ê°€ì ì¸ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŒ
4. WebDataBinderë¥¼ í†µí•´ì„œ ì‚¬ìš©
   - WebDataBinderëŠ” ìŠ¤í”„ë§ì˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì—­í• ì„ í•´ì£¼ê³  ê²€ì¦ ê¸°ëŠ¥ë„ ë‚´ë¶€ì— í¬í•¨
   - ValidationItemControllerV2ì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```java
@InitBinder
public void init(WebDataBinder dataBinder) {
    log.info("init binder={}", dataBinder);
    dataBinder.addValidators(itemValidator);
}
```
  - ì´ë ‡ê²Œ WebDataBinderì— ê²€ì¦ê¸°ë¥¼ ì¶”ê°€í•˜ë©´ í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ê²€ì¦ê¸°ë¥¼ ìë™ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆìŒ
  - @InitBinderëŠ” í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ì˜í–¥ì„ ì¤Œ (ê¸€ë¡œë²Œ ì„¤ì •ì€ ë³„ë„ë¡œ í•´ì•¼í•¨)

5. @Validated ì ìš©
   - ValidationItemControllerV2 - addItemV6()
```java
@PostMapping("/add")
public String addItemV6(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

    // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´, ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ ì´ë™
    if(bindingResult.hasErrors()) {
        log.info("errors={}", bindingResult);
        return "validation/v2/addForm";
    }

    // ê²€ì¦ ì„±ê³µ ë¡œì§
    Item savedItem = itemRepository.save(item);
    redirectAttributes.addAttribute("itemId", savedItem.getId());
    redirectAttributes.addAttribute("status", true);
    return "redirect:/validation/v2/items/{itemId}";
}
```
  - validatorë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ ì‚¬ë¼ì§€ê³ , ëŒ€ì‹  ê²€ì¦ ëŒ€ìƒ ì•ì— @Validatedê°€ ë¶™ì—¬ì§
  - ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ì˜ ë™ì‘í•¨

6. @Validated ë™ì‘ ë°©ì‹
   - @ValidatedëŠ” ê²€ì¦ê¸°ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ì• ë„ˆí…Œì´ì…˜
   - ì´ ì• ë„ˆí…Œì´ì…˜ì´ ë¶™ìœ¼ë©´ ì•ì„œ WebDataBinderì— ë“±ë¡í•œ ê²€ì¦ê¸°ë¥¼ ì°¾ì•„ì„œ ì‹¤í–‰
   - ê·¸ëŸ°ë°, ì—¬ëŸ¬ ê²€ì¦ê¸°ë¥¼ ë“±ë¡í•œë‹¤ë©´, ì–´ë–¤ ê²€ì¦ê¸°ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í• ì§€ êµ¬ë¶„ í•„ìš”
   - ì´ ë•Œ, supports()ê°€ ì‚¬ìš©ë˜ë©°, ì—¬ê¸°ì„œëŠ” supports(Item.class)ê°€ í˜¸ì¶œë˜ê³ , ê²°ê³¼ê°€ trueì´ë¯€ë¡œ ItemValidatorì˜ validate() í˜¸ì¶œ
```java
@Component
public class ItemValidator implements Validator { 
    @Override
    public boolean supports(Class<?> clazz) { 
        return Item.class.isAssignableFrom(clazz);
    }

    @Override
    public void validate(Object target, Errors errors) {...}
}
```

7. ê¸€ë¡œë²Œ ì„¤ì • - ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì— ë‹¤ ì ìš©
```java
@SpringBootApplication
public class ItemServiceApplication implements WebMvcConfigurer {

    public static void main(String[] args) {
        SpringApplication.run(ItemServiceApplication.class, args);
    }

    @Override
    public Validator getValidator() { 
        return new ItemValidator();
    } 
}
```
  - ê¸€ë¡œë²Œ ì„¤ì • ì¶”ê°€ ê°€ëŠ¥
  - ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ @InitBinderë¥¼ ì œê±°í•´ë„ ê¸€ë¡œë²Œ ì„¤ì •ìœ¼ë¡œ ì •ìƒ ë™ì‘ í™•ì¸ ê°€ëŠ¥ (ë‹¨, ì°¸ê³ ë¡œ ê¸€ë¡œë²Œ ì„¤ì •ì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë“œë­„)
  - ğŸ’¡ ê¸€ë¡œë²Œ ì„¤ì •ì„ í•˜ë©´ BeanValidatorê°€ ìë™ ë“±ë¡ë˜ì§€ ì•ŠìŒ

-----
#### @Validatorì™€ Valid
-----
1. ê²€ì¦ ì‹œ ë‘˜ ë‹¤ ì‚¬ìš© ê°€ëŠ¥
2. javax.validation.@Validë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ build.gradleì˜ ì˜ì¡´ê´€ê³„ ì¶”ê°€ í•„ìš”
   - implementation 'org.springframework.boot:spring-boot-starter-validation'
3. @ValidatorëŠ” ìŠ¤í”„ë§ ì „ìš© ê²€ì¦ ì• ë„ˆí…Œì´ì…˜, @ValidëŠ” ìë°” í‘œì¤€ ê²€ì¦ ì• ë„ˆí…Œì´ì…˜
