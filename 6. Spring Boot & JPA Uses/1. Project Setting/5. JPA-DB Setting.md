-----
### JPAì™€ DB ì„¤ì •, ë™ì‘ í™•ì¸
-----
1. main/resources/application.properties
```properties
spring.application.name=jpashop

server.port=9090
spring.output.ansi.enabled=ALWAYS

spring.datasource.url=jdbc:h2:tcp://localhost/~/jpashop
spring.datasource.username=sa

logging.level.org.springframework.transaction.interceptor=TRACE
logging.level.org.springframework.jdbc.datasource.DataSourceTransactionManager=DEBUG

spring.jpa.hibernate.ddl-auto=create
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.format_sql=true

logging.level.org.hibernate.SQL=debug
logging.level.org.springframework.orm.jpa.JpaTransactionManager=DEBUG
logging.level.org.hibernate.resource.transaction=DEBUG

# logging.level.org.hibernate.type=trace # ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x / Hibernate 5
# logging.level.org.hibernate.orm.jdbc.bind=trace
```
  - spring.jpa.hibernate.ddl-auto=create : ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— í…Œì´ë¸”ì„ dropí•˜ê³ , ë‹¤ì‹œ ìƒì„±
  - ì°¸ê³  : ëª¨ë“  ë¡œê·¸ ì¶œë ¥ì€ ê°€ê¸‰ì  ë¡œê±°ë¥¼ í†µí•´ ë‚¨ê²¨ì•¼ í•¨
    + ğŸ’¡ show_sql : ì˜µì…˜ì€ System.outì— í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¹€
    + ğŸ’¡ org.hiberante.SQL : ì˜µì…˜ì€ loggerë¥¼ í†µí•´ í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¹€
    
2. yml í˜•íƒœ
```yspring:
spring: # ë„ì–´ì“°ê¸° ì—†ìŒ
  datasource: # ë„ì–´ì“°ê¸° 2ì¹¸
    url: jdbc:h2:tcp://localhost/~/jpashop  # ë„ì–´ì“°ê¸° 4ì¹¸
    username: sa
    password:
    driver-class-name: org.h2.Driver 

  jpa: # ë„ì–´ì“°ê¸° 2ì¹¸
    hibernate: # ë„ì–´ì“°ê¸° 4ì¹¸
      ddl-auto: create # ë„ì–´ì“°ê¸° 6ì¹¸
    properties: # ë„ì–´ì“°ê¸° 4ì¹¸
      hibernate: # ë„ì–´ì“°ê¸° 6ì¹¸
        # show_sql: true # ë„ì–´ì“°ê¸° 8ì¹¸
        format_sql: true 

logging.level: # ë„ì–´ì“°ê¸° ì—†ìŒ
  org.hibernate.SQL: debug # ë„ì–´ì“°ê¸° 2ì¹¸
  #  org.hibernate.type: trace #ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x, hibernate5
  #  org.hibernate.orm.jdbc.bind: trace #ìŠ¤í”„ë§ ë¶€íŠ¸ 3.x, hibernate6ml
```
  - ğŸ’¡ application.yml ê°™ì€ yml íŒŒì¼ì€ ë„ì–´ì“°ê¸° (ìŠ¤í˜ì´ìŠ¤) 2ì¹¸ìœ¼ë¡œ ê³„ì¸µì„ ë§Œë“¬
  - ë”°ë¼ì„œ, ë„ì–´ì“°ê¸° 2ì¹¸ì„ í•„ìˆ˜ë¡œ ì ì–´ì¤˜ì•¼ í•¨

-----
### íšŒì› ì—”í‹°í‹°
-----
```java
package jpabook.jpashop;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import lombok.Getter;
import lombok.Setter;

@Entity
@Getter @Setter
public class Member {
    
    @Id @GeneratedValue
    private Long id;
    private String username;
    
}
```

-----
### íšŒì› ë ˆí¬ì§€í† ë¦¬
-----
```java
package jpabook.jpashop;

import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import org.springframework.stereotype.Repository;

@Repository
public class MemberRepository {

    @PersistenceContext // EntityManager ì£¼ì…
    EntityManager em;
    
    public Long save(Member member) {
        em.persist(member);
        return member.getId();
    }
    
    public Member find(Long id) {
        return em.find(Member.class, id);
    }
}
```

-----
### í…ŒìŠ¤íŠ¸
-----
```java
package jpabook.jpashop;

import org.assertj.core.api.Assertions;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import static org.junit.Assert.*;

@RunWith(SpringRunner.class)
@SpringBootTest
public class MemberRepositoryTest {
    @Autowired MemberRepository memberRepository;

    @Test
    @Transactional // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë‚´ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ Rollback
    @Rollback(false)
    public void testMember() throws Exception {
        // given
        Member member = new Member();
        member.setUsername("memberA");

        // when
        Long saveId = memberRepository.save(member);
        Member findMember = memberRepository.find(saveId);

        // then
        Assertions.assertThat(findMember.getId()).isEqualTo(member.getId());
        Assertions.assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        Assertions.assertThat(findMember).isEqualTo(member); // JPA ì—”í‹°í‹° ë™ì¼ì„± ë³´ì¥
    }
}
```
```
Hibernate: 
    drop table if exists member cascade

Hibernate: 
    create table member (
        id bigint not null,
        username varchar(255),
        primary key (id)
    )

[jpashop] [    Test worker] o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(88256198<open>)]

Hibernate: 
    insert 
    into
        member
        (username, id) 
    values
        (?, ?)

[jpashop] [    Test worker] o.s.orm.jpa.JpaTransactionManager : Closing JPA EntityManager [SessionImpl(88256198<open>)] after transaction
```
  - Junit4 : @TestëŠ” org.junit.Test ì‚¬ìš©
  - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•´ ë³µì¡í•œ ì„¤ì •ì´ ëª¨ë‘ ìë™í™” (persistence.xml / LocalContainerEntityManagerFactoryBean ì—†ìŒ)
  - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•œ ì¶”ê°€ ì„¤ì •ì€ ìŠ¤í”„ë§ ë©”ë‰´ì–¼ ì°¸ê³ 
    
  - ì˜¤ë¥˜ : í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆëŠ”ë°, í…ŒìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ ê²½ìš°
```
No tests found for given includes: [jpabook.jpashop.MemberRepositoryTest] (filter.includeTestsMatching)
```
  - ìŠ¤í”„ë§ ë¶€íŠ¸ 2.2.x ë²„ì „ì„ ì‚¬ìš©í•˜ë©´ Junit5ê°€ ì„¤ì¹˜ë˜ëŠ”ë°, ì´ ë•Œ build.gradle ë§ˆì§€ë§‰ì— ë‹¤ìŒ ë‚´ìš© ì¶”ê°€
  - Junit5ë¶€í„°ëŠ” build.gradleì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•´ì•¼ í…ŒìŠ¤íŠ¸ ì¸ì‹
```gradle
test { 
    useJUnitPlatform()
}
```

-----
### ğŸ’¡ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸° 
-----
1. SQL ì‹¤í–‰ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¹€
2. ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x, Hiberante 5 : org.hiberante.type: trace
3. ìŠ¤í”„ë§ ë¶€íŠ¸ 3.x, Hiberante 6 : org.hibernate.orm.jdbc.bind: trace
```
Hibernate: 
    insert 
    into
        member
        (username, id) 
    values
        (?, ?)

2024-08-21T12:53:38.527+09:00 TRACE 1788 --- [jpashop] [    Test worker] org.hibernate.orm.jdbc.bind : binding parameter (1:VARCHAR) <- [memberA]
2024-08-21T12:53:38.527+09:00 TRACE 1788 --- [jpashop] [    Test worker] org.hibernate.orm.jdbc.bind : binding parameter (2:BIGINT) <- [1]
```
4. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© : https://github.com/gavlyukovskiy/spring-boot-data-source-decorator
   - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ ì¶”ê°€í•´ì£¼ë©´ ë¨
   - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´í•˜
```gradle
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'
```
   - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ 1.9.0 ì´ìƒ ì‚¬ìš©
```gradle
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0'
```
```
2024-08-21T12:56:05.457+09:00  INFO 5688 --- [jpashop] [    Test worker] p6spy : #1724212565457 | took 1ms | statement | connection 3| url jdbc:h2:tcp://localhost/~/jpashop
insert into member (username,id) values (?,?)
insert into member (username,id) values ('memberA',1);
```

  - ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì‹œìŠ¤í…œ ìì› ì‚¬ìš©í•˜ë¯€ë¡œ, ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” í¸í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
  - í•˜ì§€ë§Œ, ìš´ì˜ ì‹œìŠ¤í…œì— ì ìš©í•˜ë ¤ë©´ ê¼­ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
