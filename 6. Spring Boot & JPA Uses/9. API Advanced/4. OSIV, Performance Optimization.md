-----
### OSIV(Open Session In View)ì™€ ì„±ëŠ¥ ìµœì í™”
-----
1. Open Session In View : Hibernate
2. Open EntityManager In View : JPA
3. ê´€ë¡€ìƒ OSIVë¼ê³  í•¨

-----
### ğŸ’¡ OSIV ON
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/1ed7681a-7f66-4e8a-be3a-94da73feb430">
</div>

1. spring.jpa.open-in-view: true (ê¸°ë³¸ê°’)
```
[jpashop] [  restartedMain] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
```

2. ì´ ê¸°ë³¸ê°’ì„ ë¿Œë¦¬ë©´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— warn ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì€ ì´ìœ ê°€ ìˆìŒ
3. ğŸ’¡ğŸ’¡ğŸ’¡ OSIV ì „ëµì€ íŠ¸ëœì­ì…˜ ì‹œì‘ì²˜ëŸ¼(ìµœì´ˆ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì‹œì‘ ì‹œì ë¶€í„°) API ì‘ë‹µì´ ëë‚  ë•Œ ê¹Œì§€ ì˜ì†ì„± ì»¨í…ŒìŠ¤íŠ¸ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ìœ ì§€
  - ğŸ’¡ ë”°ë¼ì„œ, ì§€ê¸ˆê¹Œì§€ View Templateì´ë‚˜ API ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§€ì—° ë¡œë”©ì´ ê°€ëŠ¥í–ˆë˜ ê²ƒ
  - ğŸ’¡ğŸ’¡ğŸ’¡ ì§€ì—° ë¡œë”©ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì‚´ì•„ìˆì–´ì•¼ ê°€ëŠ¥í•˜ê³ , ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ ìœ ì§€
  - ì¦‰, ì´ëŸ¬í•œ ì  ìì²´ê°€ í° ì¥ì ì„

4. ğŸ’¡ ê·¸ëŸ°ë°, ì´ ì „ëµì€ ë„ˆë¬´ ì˜¤ëœì‹œê°„ ë™ì•ˆ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ì‹¤ì‹œê°„ íŠ¸ë˜í”½ì´ ì¤‘ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì»¤ë„¥ì…˜ì´ ëª¨ìë¥¼ ìˆ˜ ìˆê³ , ì´ëŠ” ì¥ì• ë¡œ ì´ì–´ì§ (ì¹˜ëª…ì ì¸ ë‹¨ì )
5. ğŸ’¡ ì˜ˆë¥¼ ë“¤ì–´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ë©´ ì™¸ë¶€ API ëŒ€ê¸° ì‹œê°„ ë§Œí¼ ì»¤ë„¥ì…˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•˜ì§€ ëª»í•˜ê³ , ìœ ì§€í•´ì•¼ í•¨

-----
### ğŸ’¡ OSIV OFF
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/8c1707db-f1b7-43db-b8a9-89d85fdc718c">
</div>

1. spring.jpa.open-in-view: false (OSIV ì¢…ë£Œ)
2. ğŸ’¡ğŸ’¡ğŸ’¡ OSIVë¥¼ ë„ë©´, íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹«ê³ , ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ë„ ë°˜í™˜
3. ğŸ’¡ ë”°ë¼ì„œ, ì»¤ë„¥ì…˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë‚­ë¹„í•˜ì§€ ì•ŠìŒ
4. ğŸ’¡ğŸ’¡ğŸ’¡ OSIVë¥¼ ë„ë©´, ëª¨ë“  ì§€ì—° ë¡œë”©ì„ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨
   - ğŸ’¡ ë”°ë¼ì„œ, ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ë§ì€ ì§€ì—° ë¡œë”© ì½”ë“œë¥¼ íŠ¸ëœì­ì…˜ ì•ˆìœ¼ë¡œ ë„£ì–´ì•¼ í•˜ëŠ” ë‹¨ì  ì¡´ì¬
   - ğŸ’¡ ê·¸ë¦¬ê³  View Templateì— ì§€ì—°ë¡œë”©ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ
   - ğŸ’¡ğŸ’¡ğŸ’¡ ê²°ë¡ ì ìœ¼ë¡œ, íŠ¸ëœì­ì…˜ì´ ëë‚˜ê¸° ì „ì— ì§€ì—° ë¡œë”©ì„ ê°•ì œë¡œ í˜¸ì¶œí•´ë‘¬ì•¼ í•¨

-----
### ğŸ’¡ ì»¤ë©˜ë“œì™€ ì¿¼ë¦¬ ë¶„ë¦¬
-----
1. ğŸ’¡ ì‹¤ë¬´ì—ì„œ OSIVë¥¼ ëˆ ìƒíƒœë¡œ ë³µì¡ì„±ì„ ê´€ë¦¬í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì´ ì¡´ì¬ : Commandì™€ Queryë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒ
   - ì°¸ê³  : https://en.wikipedia.org/wiki/Commandâ€“query_separation

2. ë³´í†µ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ íŠ¹ì • ì—”í‹°í‹° ëª‡ ê°œë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ì„±ëŠ¥ì´ í¬ê²Œ ë¬¸ì œê°€ ë˜ì§€ ì•ŠìŒ
3. ğŸ’¡ ê·¸ëŸ°ë°, ë³µì¡í•œ í™”ë©´ì„ ì¶œë ¥í•˜ê¸° ìœ„í•œ ì¿¼ë¦¬ëŠ” í™”ë©´ì— ë§ì¶”ì–´ ì„±ëŠ¥ì„ ìµœì í™”í•˜ëŠ” ê²ƒì´ ì¤‘ìš”
4. í•˜ì§€ë§Œ, ê·¸ ë³µì¡ì„±ì— ë¹„í•´ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ì— í° ì˜í–¥ì„ ì£¼ëŠ” ê²ƒì€ ì•„ë‹˜
5. ê·¸ë˜ì„œ í¬ê³  ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•œë‹¤ë©´, ì´ ë‘˜ì˜ ê´€ì‹¬ì‚¬ë¥¼ ëª…í™•í•˜ê²Œ ë¶„ë¦¬í•˜ëŠ” ì„ íƒì€ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ì¶©ë¶„íˆ ì˜ë¯¸ê°€ ìˆìŒ
6. ì¦‰, ë‹¤ìŒì²˜ëŸ¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒ
  - ğŸ’¡ OrderService
    + ğŸ’¡ OrderService : í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    + ğŸ’¡ OrderQueryService : í™”ë©´ì—ì„œ APIì— ë§ì¶˜ ì„œë¹„ìŠ¤ (ì£¼ë¡œ ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ ì‚¬ìš©)

7. ğŸ’¡ ë³´í†µ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ íŠ¸ëœì­ì…˜ì„ ìœ ì§€
8. ğŸ’¡ ë‘ ì„œë¹„ìŠ¤ ëª¨ë‘ íŠ¸ëœì­ì…˜ì„ ìœ ì§€í•˜ë©´ì„œ ì§€ì—° ë¡œë”© ì‚¬ìš© ê°€ëŠ¥
9. ğŸ’¡ ë˜ë„ë¡ì´ë©´, ê³ ê° ì„œë²„ì˜ ì‹¤ì‹œê°„ APIëŠ” OSIVë¥¼ ë„ê³ , ADMINì²˜ëŸ¼ ì»¤ë„¥ì…˜ì„ ë§ì´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê³³ì€ OSIV ì‘ë™

10. ì˜ˆì‹œ
  - OrderApiController
```java
private final OrderQueryService orderQueryService;

...

@GetMapping("/api/v3/orders")
public List<OrderDto> ordersV3() {
    return orderQueryService.ordersV3();
}
```

  - OrderQueryService
```java
package jpabook.jpashop.service.query;

import jpabook.jpashop.domain.Order;
import jpabook.jpashop.repository.OrderRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class OrderQueryService {
    private final OrderRepository orderRepository;

    public List<OrderDto> ordersV3() {
        List<Order> orders = orderRepository.findAllWithItem();

        List<OrderDto> result = orders.stream()
                .map(OrderDto::new)
                .collect(Collectors.toList());

        return result;
    }
}
```

  - OrderDto
```java
package jpabook.jpashop.service.query;

import jpabook.jpashop.domain.Address;
import jpabook.jpashop.domain.Order;
import jpabook.jpashop.domain.OrderStatus;
import lombok.Getter;

import java.time.LocalDateTime;
import java.util.List;
import java.util.stream.Collectors;

@Getter
public class OrderDto {
    private Long orderId;
    private String name;
    private LocalDateTime orderDate;
    private OrderStatus orderStatus;
    private Address address;
    private List<OrderItemDto> orderItems;

    public OrderDto(Order order) {
        orderId = order.getId();
        name = order.getMember().getName();
        orderDate = order.getOrderDate();
        orderStatus = order.getStatus();
        address = order.getDelivery().getAddress();

        // order.getOrderItems().forEach(o -> o.getItem().getName());
        // orderItems = order.getOrderItems(); // Entity -> ì´ˆê¸°í™”ë¥¼ í†µí•´ í’€ì–´ì¤Œ

        orderItems = order.getOrderItems().stream()
                .map(OrderItemDto::new)
                .collect(Collectors.toList());
    }
}
```

  - OrderItemDto
```java
package jpabook.jpashop.service.query;

import jpabook.jpashop.domain.OrderItem;
import lombok.Getter;

@Getter
public class OrderItemDto {
    private String itemName; // ìƒí’ˆëª…
    private int orderPrice; // ì£¼ë¬¸ ê°€ê²©
    private int count; // ì£¼ë¬¸ ìˆ˜ëŸ‰

    public OrderItemDto(OrderItem orderItem) {
        itemName = orderItem.getItem().getName();
        orderPrice = orderItem.getOrderPrice();
        count = orderItem.getCount();
    }
}
```
