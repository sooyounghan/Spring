-----
### ğŸ’¡ API ê°œë°œ - ì§€ì—° ë¡œë”©ê³¼ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”
-----
1. ì£¼ë¬¸ + ë°°ì†¡ì •ë³´ + íšŒì›ì„ ì¡°íšŒí•˜ëŠ” API
2. ì§€ì—° ë¡œë”© ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ë¬¸ì œë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ í•´ê²°

-----
### ê°„ë‹¨í•œ ì£¼ë¬¸ ì¡°íšŒ V1 : ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë…¸ì¶œ
-----
1. OrderSimpleApiController
```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Order;
import jpabook.jpashop.repository.OrderRepository;
import jpabook.jpashop.repository.OrderSearch;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * xToOne (ManyToOne, OneToOne)
 * Order
 *   - Order -> Member (ManyToOne)
 *   - Order -> Delivery (OneToOne)
 */
@RestController
@RequiredArgsConstructor
public class OrderSimpleApiController {

    private final OrderRepository orderRepository;

    /**
     * V1 : ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ
     * - Hibernate5Module ëª¨ë“ˆ ë“±ë¡, LAZY = null ì²˜ë¦¬
     * - ì–‘ë°©í–¥ ê´€ê³„ ë¬¸ì œ ë°œìƒ -> @JsonIgnore
     */
    @GetMapping("/api/v1/simple-orders")
    public List<Order> ordersV1() {
        // í˜„ì¬ Loading ì „ëµ : LAZY -> Proxy ê°ì²´ ìƒì„± í›„ ì €ì¥ -> Member ê°ì²´ì— ì ‘ê·¼í•  ë•Œ, DBì— ì ‘ê·¼í•˜ì—¬ ì´ˆê¸°í™”
        // Proxy ê¸°ìˆ  : class org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor
        // JPA ì…ì¥ì—ì„œ ByteBuddyì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ ì˜ˆì™¸ ë°œìƒ -> HibernateModule ì„¤ì¹˜
        List<Order> all = orderRepository.findAllByString(new OrderSearch()); // Order <-> Member ë¬´í•œ ë£¨í”„ (ì–‘ë°©í–¥ ì—°ê²°ê´€ê³„)

        for (Order order : all) {
            order.getMember().getName(); // LAZY ê°•ì œ ì´ˆê¸°í™”
            order.getDelivery().getAddress(); // LAZY ê°•ì œ ì´ˆê¸°í™”
        }
        
        return all;
    }
}
```
```json
[
    {
        "id": 1,
        "member": {
            "id": 1,
            "name": "userA",
            "address": {
                "city": "ì„œìš¸",
                "street": "1",
                "zipcode": "1111"
            }
        },
        "orderItems": null,
        "delivery": {
            "id": 1,
            "address": {
                "city": "ì„œìš¸",
                "street": "1",
                "zipcode": "1111"
            },
            "status": null
        },
        "orderDate": "2024-08-27T13:14:40.294949",
        "status": "ORDER",
        "totalPrice": 50000
    },
    {
        "id": 2,
        "member": {
            "id": 2,
            "name": "userB",
            "address": {
                "city": "ì§„ì£¼",
                "street": "2",
                "zipcode": "2222"
            }
        },
        "orderItems": null,
        "delivery": {
            "id": 2,
            "address": {
                "city": "ì§„ì£¼",
                "street": "2",
                "zipcode": "2222"
            },
            "status": null
        },
        "orderDate": "2024-08-27T13:14:40.445548",
        "status": "ORDER",
        "totalPrice": 220000
    }
]
```
  - í˜„ì¬ Loading ì „ëµ : LAZY -> Proxy ê°ì²´ ìƒì„± í›„ ì €ì¥ -> Member ê°ì²´ì— ì ‘ê·¼í•  ë•Œ, DBì— ì ‘ê·¼í•˜ì—¬ ì´ˆê¸°í™”
  - Proxy ê¸°ìˆ  : class org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor
    + JPA ì…ì¥ì—ì„œ ByteBuddyì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ ì˜ˆì™¸ ë°œìƒ -> HibernateModule ì„¤ì¹˜

  - ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ
  - ğŸ’¡ order â†’ memberì™€ order â†’ delieryëŠ” ì§€ì—° ë¡œë”©ì´ë¯€ë¡œ, ì‹¤ì œ ì—”í‹°í‹° ëŒ€ì‹  í”„ë¡ì‹œ ì¡´ì¬
    + ğŸ’¡ jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì´ í”„ë¡ì‹œ ê°ì²´ë¥¼ jsonìœ¼ë¡œ ì–´ë–»ê²Œ ìƒì„±í•´ì•¼ í•˜ëŠ”ì§€ ëª¨ë¦„ (ì˜ˆì™¸ ë°œìƒ)
    + ğŸ’¡ Hibernate5Moduleì„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ í•´ê²° (ìŠ¤í”„ë§ ë¶€íŠ¸ ì‚¬ìš© ì¤‘) 
  - Hibernate5Module ëª¨ë“ˆ ë“±ë¡, LAZY = null ì²˜ë¦¬
  - ì–‘ë°©í–¥ ê´€ê³„ ë¬¸ì œ ë°œìƒ -> @JsonIgnore
    + Member, OrderItem, Delivery
```java
package jpabook.jpashop.domain;

import com.fasterxml.jackson.annotation.JsonIgnore;
import jakarta.persistence.*;
import lombok.Getter;
import lombok.Setter;

import java.util.ArrayList;
import java.util.List;

@Entity
@Getter @Setter
public class Member {

    ...

    @JsonIgnore // ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì œê±°
    @OneToMany(mappedBy = "member")
    private List<Order> orders = new ArrayList<>();

}
```
```java
package jpabook.jpashop.domain;

import com.fasterxml.jackson.annotation.JsonIgnore;
import jakarta.persistence.*;
import jpabook.jpashop.domain.item.Item;
import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Entity
@Table(name = "order_item")
@Getter @Setter
public class OrderItem {

    ...

    @JsonIgnore // ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì œê±°
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "order_id")
    private Order order;

    ...
}
```
```java
package jpabook.jpashop.domain;

import com.fasterxml.jackson.annotation.JsonIgnore;
import jakarta.persistence.*;
import lombok.Getter;
import lombok.Setter;

@Entity
@Getter @Setter
public class Delivery {

    ...

    @JsonIgnore // ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì œê±°
    @OneToOne(mappedBy = "delivery", fetch = FetchType.LAZY)
    private Order order;

    ...
}
```

-----
### í•˜ì´ë²„ë„¤ì´íŠ¸ ëª¨ë“ˆ ë“±ë¡
-----
1. ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ì— ë”°ë¼ ëª¨ë“ˆ ë°©ë²•ì´ ë‹¤ë¦„
2. ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0ë¶€í„°ëŠ” javax â†’ jakartaë¡œ ë³€ê²½ë˜ì–´ì„œ ì§€ì› ëª¨ë“ˆë„ ë‹¤ë¥¸ ëª¨ë“ˆì„ ë“±ë¡
3. ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0ë¯¸ë§Œ : Hiberante5Module ë“±ë¡
   - build.gradleì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
```gradle
implementation 'com.fasterxml.jackson.datatype:jackson-datatype-hibernate5'
```
  - JpashopApplicationì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```java
@Bean
Hibernate5Module hibernate5Module() { 
    return new Hibernate5Module();
}
```
  - ê¸°ë³¸ì ìœ¼ë¡œ ì´ˆê¸°í™” ëœ í”„ë¡ì‹œ ê°ì²´ë§Œ ë…¸ì¶œ, ì´ˆê¸°í™” ë˜ì§€ ì•Šì€ í”„ë¡ì‹œ ê°ì²´ëŠ” ë…¸ì¶œ ì•ˆí•¨
  - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì„ ì°¸ê³ í•´ì„œ ëª¨ë“ˆ ë³€ê²½ (ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ì˜ˆì™¸ ë°œìƒ)
```
java.lang.ClassNotFoundException: javax.persistence.Transient
```

4. ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : Hibernate5JakartaModule ë“±ë¡
  - build.gradleì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
```gradle
implementation 'com.fasterxml.jackson.datatype:jackson-datatype-hibernate5-jakarta'

// Hibernate ë²„ì „ 6
// Hibernate6Module
implementation 'com.fasterxml.jackson.datatype:jackson-datatype-hibernate6'
```
  - JpashopApplicationì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```java
@Bean
Hibernate5JakartaModule hibernate5JakartaModule() {
  return new Hibernate5JakartaModule();
}
```
  - Hibernate 6 ì´ìƒ
```java
@Bean
Hibernate6Module hibernate6Module() {
  return new Hibernate6Module();
}
```
  - ê¸°ë³¸ì ìœ¼ë¡œ ì´ˆê¸°í™” ëœ í”„ë¡ì‹œ ê°ì²´ë§Œ ë…¸ì¶œ, ì´ˆê¸°í™” ë˜ì§€ ì•Šì€ í”„ë¡ì‹œ ê°ì²´ëŠ” ë…¸ì¶œ ì•ˆí•¨

5. ì‹¤í–‰ ê²°ê³¼
   - OrderSimpleController
```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Order;
import jpabook.jpashop.repository.OrderRepository;
import jpabook.jpashop.repository.OrderSearch;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * xToOne (ManyToOne, OneToOne)
 * Order
 *   - Order -> Member (ManyToOne)
 *   - Order -> Delivery (OneToOne)
 */
@RestController
@RequiredArgsConstructor
public class OrderSimpleApiController {

    private final OrderRepository orderRepository;

    /**
     * V1 : ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ
     * - Hibernate5Module ëª¨ë“ˆ ë“±ë¡, LAZY = null ì²˜ë¦¬
     * - ì–‘ë°©í–¥ ê´€ê³„ ë¬¸ì œ ë°œìƒ -> @JsonIgnore
     */
    @GetMapping("/api/v1/simple-orders")
    public List<Order> ordersV1() {
        List<Order> all = orderRepository.findAllByString(new OrderSearch()); // Order <-> Member ë¬´í•œ ë£¨í”„ (ì–‘ë°©í–¥ ì—°ê²°ê´€ê³„)

        return all;
    }
}
```

```json
[
    {
        "id": 1,
        "member": null,
        "orderItems": null,
        "delivery": null,
        "orderDate": "2024-08-27T13:08:24.757907",
        "status": "ORDER",
        "totalPrice": 50000
    },
    {
        "id": 2,
        "member": null,
        "orderItems": null,
        "delivery": null,
        "orderDate": "2024-08-27T13:08:24.871603",
        "status": "ORDER",
        "totalPrice": 220000
    }
]
```

6. ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë©´ ê°•ì œë¡œ ì§€ì—° ë¡œë”© ê°€ëŠ¥
```java
@Bean
Hibernate5JakartaModule hibernate5Module() {
    Hibernate5JakartaModule hiberante5Module = new Hibernate5JakartaModule();

    // ê°•ì œ ì§€ì—° ë¡œë”© ì„¤ì •
    hibernate5Module.configure(Hibernate5JakartaModule.Feature.FORCE_LAZY_LOADING, true);

    return hibernate5Module;
```
  - Hibernate 6 ì´ìƒ
```java
@Bean
Hibernate6Module hibernate6Module() {
  Hibernate6Module hibernate6Module = new Hibernate6Module();

  // ê°•ì œ ì§€ì—° ë¡œë”© ì„¤ì •
  hibernate6Module.configure(Hibernate6Module.Feature.FORCE_LAZY_LOADING, true);

  return hibernate6Module;
}
```
  - OrderSimpleController
```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Order;
import jpabook.jpashop.repository.OrderRepository;
import jpabook.jpashop.repository.OrderSearch;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * xToOne (ManyToOne, OneToOne)
 * Order
 *   - Order -> Member (ManyToOne)
 *   - Order -> Delivery (OneToOne)
 */
@RestController
@RequiredArgsConstructor
public class OrderSimpleApiController {

    private final OrderRepository orderRepository;

    /**
     * V1 : ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ
     * - Hibernate5Module ëª¨ë“ˆ ë“±ë¡, LAZY = null ì²˜ë¦¬
     * - ì–‘ë°©í–¥ ê´€ê³„ ë¬¸ì œ ë°œìƒ -> @JsonIgnore
     */
    @GetMapping("/api/v1/simple-orders")
    public List<Order> ordersV1() {
        List<Order> all = orderRepository.findAllByString(new OrderSearch()); // Order <-> Member ë¬´í•œ ë£¨í”„ (ì–‘ë°©í–¥ ì—°ê²°ê´€ê³„)

        return all;
    }
}
```
```json
[
    {
        "id": 1,
        "member": {
            "id": 1,
            "name": "userA",
            "address": {
                "city": "ì„œìš¸",
                "street": "1",
                "zipcode": "1111"
            }
        },
        "orderItems": [
            {
                "id": 1,
                "item": {
                    "id": 1,
                    "name": "JPA BOOK1",
                    "price": 10000,
                    "stockQuantity": 99,
                    "categories": [],
                    "autor": null,
                    "isbn": null
                },
                "orderPrice": 10000,
                "count": 1,
                "totalPrice": 10000
            },
            {
                "id": 2,
                "item": {
                    "id": 2,
                    "name": "JPA BOOK2",
                    "price": 20000,
                    "stockQuantity": 98,
                    "categories": [],
                    "autor": null,
                    "isbn": null
                },
                "orderPrice": 20000,
                "count": 2,
                "totalPrice": 40000
            }
        ],
        "delivery": {
            "id": 1,
            "address": {
                "city": "ì„œìš¸",
                "street": "1",
                "zipcode": "1111"
            },
            "status": null
        },
        "orderDate": "2024-08-27T13:10:11.389949",
        "status": "ORDER",
        "totalPrice": 50000
    },
    {
        "id": 2,
        "member": {
            "id": 2,
            "name": "userB",
            "address": {
                "city": "ì§„ì£¼",
                "street": "2",
                "zipcode": "2222"
            }
        },
        "orderItems": [
            {
                "id": 3,
                "item": {
                    "id": 3,
                    "name": "SPRING BOOK1",
                    "price": 20000,
                    "stockQuantity": 197,
                    "categories": [],
                    "autor": null,
                    "isbn": null
                },
                "orderPrice": 20000,
                "count": 3,
                "totalPrice": 60000
            },
            {
                "id": 4,
                "item": {
                    "id": 4,
                    "name": "SRPING BOOK2",
                    "price": 40000,
                    "stockQuantity": 296,
                    "categories": [],
                    "autor": null,
                    "isbn": null
                },
                "orderPrice": 40000,
                "count": 4,
                "totalPrice": 160000
            }
        ],
        "delivery": {
            "id": 2,
            "address": {
                "city": "ì§„ì£¼",
                "street": "2",
                "zipcode": "2222"
            },
            "status": null
        },
        "orderDate": "2024-08-27T13:10:11.490681",
        "status": "ORDER",
        "totalPrice": 220000
    }
]
```
  - ì´ ì˜µì…˜ì„ í‚¤ë©´, order â†’ member, member â†’ orders ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ê³„ì† ë¡œë”©
  - ë”°ë¼ì„œ, @JsonIgnore ì˜µì…˜ì„ í•œ ê³³ì— ì¤˜ì•¼ í•¨

6. ì£¼ì˜ ì‚¬í•­
   - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : Hibernate5Module â†’ Hibernate5JakartaModule ì‚¬ìš©
   - ğŸ’¡ ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë…¸ì¶œí•  ë•ŒëŠ”, ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ê±¸ë¦° ê³³ì€ ğŸ’¡ ê¼­! í•œ ê³³ì€ @JsonIgnore ì²˜ë¦¬
     + ğŸ’¡ ê·¸ëŸ¬ì§€ ì•Šìœ¼ë©´, ì–‘ìª½ì„ ëª¨ë‘ í˜¸ì¶œí•˜ë©´ì„œ ë¬´í•œ ë£¨í”„ ë°œìƒ
   - ğŸ’¡ ì •ë§ ê°„ë‹¨í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë‹ˆë©´ ì—”í‹°í‹°ë¥¼ API ì‘ë‹µìœ¼ë¡œ ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ
   - ğŸ’¡ ë”°ë¼ì„œ, Hibernate5Moduleì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ DTOë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ë” ì¢‹ì€ ë°©ë²•
   - ğŸ’¡ ì§€ì—° ë¡œë”©(LAZY)ì„ í”¼í•˜ê¸° ìœ„í•´ ì¦‰ì‹œ ë¡œë”©(EAGER)ë¡œ ì„¤ì •í•˜ë©´ ì•ˆ ë¨!
     + ì¦‰ì‹œ ë¡œë”© ë•Œë¬¸ì— ì—°ê´€ê´€ê³„ê°€ í•„ìš” ì—†ëŠ” ê²½ìš°ì—ë„ ë°ì´í„°ë¥¼ í•­ìƒ ì¡°íšŒí•´ì„œ ì„±ëŠ¥ ë¬¸ì œ ë°œìƒ
     + ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì„±ëŠ¥ íŠœë‹ì´ ë§¤ìš° ì–´ë ¤ì›Œì§
     + ğŸ’¡ í•­ìƒ ì§€ì—° ë¡œë”©ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ê³ , ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•œ ê²½ìš° Fetch Joinì„ ì‚¬ìš©
     
