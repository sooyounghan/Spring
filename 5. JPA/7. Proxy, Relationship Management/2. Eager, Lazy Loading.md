-----
### ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©
-----
1. Memberë¥¼ ì¡°íšŒí•  ë•Œ, Teamë„ í•¨ê»˜ ì¡°íšŒë˜ì–´ì•¼ í• ê¹Œ?
  - ë‹¨ìˆœíˆ member ì •ë³´ë§Œ ì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ â†’ ì§€ì—° ë¡œë”© LAZY ì‚¬ìš©
```java
System.out.println(member.getName());
```
<div align="center">
<img src="https://github.com/user-attachments/assets/13028c87-d17a-4988-9875-dc47cded5a1a">
</div>

2. ì§€ì—° ë¡œë”© LAZYë¥¼ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ì¡°íšŒ
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member extends BaseEntity {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.LAZY) // ì§€ì—° ë¡œë”©
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    ...
}
```
```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Team team = new Team();
            team.setName("TeamA");
            em.persist(team);

            Member member1 = new Member();
            member1.setUsername("member1");
            member1.setTeam(team);
            em.persist(member1);

            em.flush();
            em.clear();

            Member member = em.find(Member.class, member1.getId()); // member1
            System.out.println("member = " + member.getTeam().getClass()); // team1 : Proxy

            System.out.println("=====");
            member.getTeam().getName(); // Proxy -> team (í”„ë¡ì‹œ ì´ˆê¸°í™”)
            System.out.println("=====");

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}

```
```
...
member = class hellojpa.Team$HibernateProxy$dhY6spRi
=====
Hibernate: 
    select
        t1_0.TEAM_ID,
        t1_0.createdBy,
        t1_0.createdDate,
        t1_0.lastModifiedBy,
        t1_0.lastModifiedDate,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.TEAM_ID=?
=====
```

<div align="center">
<img src="https://github.com/user-attachments/assets/79a85228-27e5-487f-8ffc-09fa9e4d4e9c">
</div>

```java
Member member = em.find(Member.class, member1.getId()); // member1 (1. ë¡œë”©)
System.out.println("member = " + member.getTeam().getClass()); // team1 : Proxy (2. ì§€ì—°ë¡œë”© LAZY) : í”„ë¡ì‹œ team1 ì—”í‹°í‹°
```

3. ì§€ì—° ë¡œë”© LAZYë¥¼ ì‚¬ìš©í•´ í”„ë¡ì‹œ ì¡°íšŒ
```java
Member member = em.find(Member.class, 1L); // memberëŠ” ì‹¤ì œ Entity, Teamì€ ê°€ì§œ Proxy Entity (LAZY)
```
<div align="center">
<img src="https://github.com/user-attachments/assets/772ef72c-36ec-4c58-8eee-6679d11bfc57">
</div>

```java
Team team = member.getTeam(); // teamì€ ê°€ì§œ Proxy Entity (LAZY)
team.getName(); // ì‹¤ì œ teamì„ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— ì´ˆê¸°í™” (DB ì¡°íšŒ)
```
<div align="center">
<img src="https://github.com/user-attachments/assets/5c015d3d-101c-49b4-95d2-1f467c4e6262">
</div>

4. Memberì™€ Teamì„ ìì£¼ í•¨ê»˜ ì‚¬ìš©í•œë‹¤ë©´? â†’ ì¦‰ì‹œ ë¡œë”© EAGER
<div align="center">
<img src="https://github.com/user-attachments/assets/5c015d3d-101c-49b4-95d2-1f467c4e6262">
</div>

5. ì¦‰ì‹œ ë¡œë”© EAGERë¥¼ ì‚¬ìš©í•´ì„œ í•¨ê»˜ ì¡°íšŒ
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member extends BaseEntity {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    ...
}
```
```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Team team = new Team();
            team.setName("TeamA");
            em.persist(team);

            Member member1 = new Member();
            member1.setUsername("member1");
            member1.setTeam(team);
            em.persist(member1);

            em.flush();
            em.clear();

            Member member = em.find(Member.class, member1.getId()); // ì‹¤ì œ member1 Entity (SQL ì‹¤í–‰)
            System.out.println("member = " + member.getTeam().getClass()); // ì‹¤ì œ team Entity (SQL ì‹¤í–‰)

            System.out.println("=====");
            System.out.println("teamName = " + member.getTeam().getName()); // ì‹¤ì œ Entityë¡œ ë¶ˆëŸ¬ì˜¨ ê°’ìœ¼ë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ, SQL ë¯¸ì‹¤í–‰
             System.out.println("=====");

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
Hibernate: 
    select
        m1_0.MEMBER_ID,
        m1_0.createdBy,
        m1_0.createdDate,
        m1_0.lastModifiedBy,
        m1_0.lastModifiedDate,
        t1_0.TEAM_ID,
        t1_0.createdBy,
        t1_0.createdDate,
        t1_0.lastModifiedBy,
        t1_0.lastModifiedDate,
        t1_0.name,
        m1_0.USERNAME 
    from
        Member m1_0 
    left join
        Team t1_0 
            on t1_0.TEAM_ID=m1_0.TEAM_ID 
    where
        m1_0.MEMBER_ID=?

member = class hellojpa.Team
=====
teamName = TeamA
=====
```
<div align="center">
<img src="https://github.com/user-attachments/assets/0c16bc88-3ea8-454b-963a-3ead9f3299d2">
</div>

6. ì¦‰ì‹œ ë¡œë”©(EAGER), Member ì¡°íšŒ ì‹œ í•­ìƒ Teamë„ ì¡°íšŒ
<div align="center">
<img src="https://github.com/user-attachments/assets/05e376cf-3f50-4f28-9b3d-1f29f1e4851a">
</div>

  - ğŸ’¡ JPA êµ¬í˜„ì²´ëŠ” ê°€ëŠ¥í•˜ë©´ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ SQL í•œë²ˆì— í•¨ê»˜ ì¡°íšŒ

-----
### í”„ë¡ì‹œì™€ ì¦‰ì‹œ ë¡œë”© ì£¼ì˜
-----
1. ğŸ’¡ íŠ¹íˆ ì‹¤ë¬´ì—ì„œ ê°€ê¸‰ì  ì§€ì—° ë¡œë”©ë§Œ ì‚¬ìš©
2. ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•˜ë©´ ì˜ˆìƒì¹˜ ëª»í•œ SQL ë°œìƒ
3. ğŸ’¡ğŸ’¡ğŸ’¡ ì¦‰ì‹œ ë¡œë”©ì€ JPQLì—ì„œ N + 1ë¬¸ì œë¥¼ ì¼ìœ¼í‚´
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member extends BaseEntity {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    ...
}
```
```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

import java.util.List;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Team team = new Team();
            team.setName("TeamA");
            em.persist(team);

            Member member1 = new Member();
            member1.setUsername("member1");
            member1.setTeam(team);
            em.persist(member1);

            em.flush();
            em.clear();

            List<Member> members = em.createQuery("SELECT m FROM Member m", Member.class)
                    .getResultList(); // N + 1ë¬¸ì œ ë°œìƒ

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
...

Hibernate: 
    /* SELECT
        m 
    FROM
        Member m */ select
            m1_0.MEMBER_ID,
            m1_0.createdBy,
            m1_0.createdDate,
            m1_0.lastModifiedBy,
            m1_0.lastModifiedDate,
            m1_0.TEAM_ID,
            m1_0.USERNAME 
        from
            Member m1_0

Hibernate: 
    select
        t1_0.TEAM_ID,
        t1_0.createdBy,
        t1_0.createdDate,
        t1_0.lastModifiedBy,
        t1_0.lastModifiedDate,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.TEAM_ID=?
```
  - ğŸ’¡ JPQLì´ SQLë¡œ ë²ˆì—­ (SQL : SELECT * FROM MEMBER)ë˜ì–´ DBì— SQL ì „ì†¡ (ìµœì´ˆ ì¿¼ë¦¬ : 1ë²ˆ)
  - ğŸ’¡ List<Member> members = em.createQuery(...) ì‹œì ì— Member ê°’ì´ ì¡´ì¬í•´ì•¼ ë˜ë¯€ë¡œ, Member ì¡°íšŒ 
    + ë˜í•œ, Member Entityì—ì„œ Teamì´ EAGERë¡œ ì„¤ì • : SELECT * FROM Membr WHERE TEAM_ID = xxx (ì¦‰ì‹œ ë¡œë”©ì´ë¯€ë¡œ Nê°œì˜ ë°ì´í„°ë¼ë©´, Në²ˆ ë§Œí¼ ì¡°íšŒ)
  - ì´ N + 1ë²ˆ ì¡°íšŒ
```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

import java.util.List;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Team teamA = new Team();
            teamA.setName("TeamA");
            em.persist(teamA);

            Team teamB = new Team();
            teamB.setName("TeamB");
            em.persist(teamB);

            Member member1 = new Member();
            member1.setUsername("member1");
            member1.setTeam(teamA);
            em.persist(member1); // member1 - teamA

            Member member2 = new Member();
            member2.setUsername("member2");
            member2.setTeam(teamB);
            em.persist(member2); // member2 - teamB

            em.flush();
            em.clear();

            List<Member> members = em.createQuery("SELECT m FROM Member m", Member.class)
                    .getResultList(); // N + 1ë¬¸ì œ ë°œìƒ

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
Hibernate: // Memberì— ëŒ€í•œ SQL (JPQLì´ SQLë¡œ ë²ˆì—­)
    /* SELECT
        m 
    FROM
        Member m */ select
            m1_0.MEMBER_ID,
            m1_0.createdBy,
            m1_0.createdDate,
            m1_0.lastModifiedBy,
            m1_0.lastModifiedDate,
            m1_0.TEAM_ID,
            m1_0.USERNAME 
        from
            Member m1_0

Hibernate: // teamAì— ëŒ€í•œ SQL ì‹¤í–‰ (Team : ì¦‰ì‹œ ë¡œë”©)
    select
        t1_0.TEAM_ID,
        t1_0.createdBy,
        t1_0.createdDate,
        t1_0.lastModifiedBy,
        t1_0.lastModifiedDate,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.TEAM_ID=?

Hibernate: // teamBì— ëŒ€í•œ SQL ì‹¤í–‰ (Team : ì¦‰ì‹œ ë¡œë”©)
    select
        t1_0.TEAM_ID,
        t1_0.createdBy,
        t1_0.createdDate,
        t1_0.lastModifiedBy,
        t1_0.lastModifiedDate,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.TEAM_ID=?
````
  - í•´ê²° ë°©ë²• : ëª¨ë“  ì—°ê´€ ê´€ê³„ë¥¼ LAZYë¡œ ë³€ê²½
    + Fetch Join
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member extends BaseEntity {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    ...
}
```
```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

import java.util.List;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Team teamA = new Team();
            teamA.setName("TeamA");
            em.persist(teamA);

            Team teamB = new Team();
            teamB.setName("TeamB");
            em.persist(teamB);

            Member member1 = new Member();
            member1.setUsername("member1");
            member1.setTeam(teamA);
            em.persist(member1);

            Member member2 = new Member();
            member2.setUsername("member2");
            member2.setTeam(teamB);
            em.persist(member2);

            em.flush();
            em.clear();

            List<Member> members = em.createQuery("SELECT m FROM Member m JOIN FETCH m.team", Member.class) // íŒ¨ì¹˜ ì¡°ì¸
                    .getResultList(); // N + 1ë¬¸ì œ ë°œìƒ

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
Hibernate: 
    /* SELECT
        m 
    FROM
        Member m 
    JOIN
        
    FETCH
        m.team */ select
            m1_0.MEMBER_ID,
            m1_0.createdBy,
            m1_0.createdDate,
            m1_0.lastModifiedBy,
            m1_0.lastModifiedDate,
            t1_0.TEAM_ID,
            t1_0.createdBy,
            t1_0.createdDate,
            t1_0.lastModifiedBy,
            t1_0.lastModifiedDate,
            t1_0.name,
            m1_0.USERNAME 
        from
            Member m1_0 
        join
            Team t1_0 
                on t1_0.TEAM_ID=m1_0.TEAM_ID
```
  + Entity Graph ì—ë„ˆí…Œì´ì…˜
  + Batch Size (1 + 1)
4. ğŸ’¡ğŸ’¡ğŸ’¡ @ManyToOne, @OneToOneì€ ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”©ì´ë¯€ë¡œ, LAZYë¡œ ì„¤ì •
5. ğŸ’¡ğŸ’¡ğŸ’¡ @OneToMany, @ManyToManyëŠ” ê¸°ë³¸ì´ ì§€ì—° ë¡œë”©

-----
### ì§€ì—° ë¡œë”© í™œìš©
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/e142c708-cc28-4acc-9b38-08798d688397">
</div>

1. Memberì™€ Teamì€ ìì£¼ í•¨ê»˜ ì‚¬ìš© : ì¦‰ì‹œ ë¡œë”©
2. Memberì™€ OrderëŠ” ê°€ë” ì‚¬ìš© : ì§€ì—° ë¡œë”©
3. Orderì™€ ProductëŠ” ìì£¼ í•¨ê»˜ ì‚¬ìš© : ì¦‰ì‹œ ë¡œë”©

<div align="center">
<img src="https://github.com/user-attachments/assets/fb1e73a7-1952-4238-97b8-4f05d000e136">
<img src="https://github.com/user-attachments/assets/d6274c7b-8962-41cd-81cf-8c1e52d53663">
</div>

4. ğŸ’¡ğŸ’¡ğŸ’¡ ëª¨ë“  ì—°ê´€ê´€ê³„ì— ì§€ì—° ë¡œë”© ì‚¬ìš©
5. ğŸ’¡ğŸ’¡ğŸ’¡ ì‹¤ë¬´ì—ì„œ ì¦‰ì‹œ ë¡œë”©ì„ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ
6. ğŸ’¡ğŸ’¡ğŸ’¡ JPQL Fetch Joinì´ë‚˜ Entity Graph ê¸°ëŠ¥ ì‚¬ìš©
7. ì¦‰ì‹œ ë¡œë”©ì€ ìƒìƒí•˜ì§€ ëª»í•œ ì¿¼ë¦¬ê°€ ë°œìƒ
