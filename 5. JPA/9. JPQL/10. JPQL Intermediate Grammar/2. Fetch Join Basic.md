-----
### í˜ì¹˜ ì¡°ì¸ (Fetch Join)
-----
1. ğŸ’¡ SQL ì¡°ì¸ ì¢…ë¥˜ê°€ ì•„ë‹˜
   - ğŸ’¡ JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
2. ğŸ’¡ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ SQLì— í•œ ë²ˆì— í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥
3. ğŸ’¡ JOIN FETCH ëª…ë ¹ì–´ ì‚¬ìš©
```java
Fetch Join :: =

[LEFT [OUTER] | INNER] JOIN FETCH ì¡°ì¸ê²½ë¡œ
```

-----
### ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸ (Entity Fetch Join)
-----
1. íšŒì›ì„ ì¡°íšŒí•˜ë©´ì„œ ì—°ê´€ëœ íŒ€ë„ í•¨ê»˜ ì¡°íšŒ (ì¦‰, SQLë¡œ í•œë²ˆì— ì¡°íšŒ)
2. ğŸ’¡ SQLì„ ë³´ë©´, íšŒì› ë¿ë§Œ ì•„ë‹ˆë¼ íŒ€(T.*)ë„ í•¨ê»˜ SELECT
3. JPQL
```java
SELECT m FROM Member m JOIN FETCH Team t
```
4. SQL
```java
SELECT M.*, T.* FROM Member M INNER JOIN TEAM T ON M.TEAM_ID = T.ID
```
<div align="center">
<img src="https://github.com/user-attachments/assets/00639d49-c046-45cb-b9fc-3abc318c9613">
</div>

5. Fetch Join ì‚¬ìš© ì½”ë“œ
```java
String jpql = "SELECT m FROM Member m JOIN FETCH m.team";

List<Member> members = em.createQuery(jpql, Member.class)
                          .getResultList();

for(Member member : members) {
    // ğŸ’¡ğŸ’¡ğŸ’¡ Fetch Joinìœ¼ë¡œ íšŒì›ê³¼ íƒì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë¯¸ë°œìƒ
    System.out.println("username = " + member.getUsername() + ", " + "teamname = " + member.getTeam.name());
}
```

  - username = íšŒì›1, teamname = íŒ€A
  - username = íšŒì›2, teamname = íŒ€A
  - username = íšŒì›3, teamname = íŒ€B

  - ì§€ì—° ë¡œë”©
```java
Team teamA = new Team();
teamA.setName("TeamA");
em.persist(teamA);

Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

Member member1 = new Member();
member1.setUsername("íšŒì›1");
member1.setAge(10);
member1.setTeam(teamA);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("íšŒì›2");
member2.setAge(20);
member2.setTeam(teamA);
em.persist(member2);

Member member3 = new Member();
member3.setUsername("íšŒì›3");
member3.setAge(30);
member3.setTeam(teamB);
em.persist(member3);

em.flush();
em.clear();

String query = "SELECT m FROM Member m";

List<Member> result = em.createQuery(query, Member.class).getResultList();

for (Member member : result) {
    System.out.println("username = " + member.getUsername() + ", " + "teamName = " + member.getTeam().getName());
    // ì§€ì—° ë¡œë”©
    // íšŒì›1, íŒ€A(SQL)
    // íšŒì›2, íŒ€A(1ì°¨ ìºì‹œ)
    // íšŒì›3, íŒ€B(SQL)

    // ğŸ’¡ğŸ’¡ğŸ’¡ ... Në²ˆ : N + 1 ë²ˆ (ì²˜ìŒ ì¿¼ë¦¬ SQL 1ë²ˆ + 100ë²ˆ ì¡°íšŒ Në²ˆ = N + 1ë²ˆ ë¬¸ì œ (í•´ê²° ë°©ë²• : FETCH JOIN)
}

tx.commit();
```
```
Hibernate: // ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì¸í•´ Member ì—”í‹°í‹°ë§Œ ì¡°íšŒ
    /* SELECT
        m 
    FROM
        Member m */ select
            m1_0.id,
            m1_0.age,
            m1_0.TEAM_ID,
            m1_0.type,
            m1_0.username 
        from
            Member m1_0
Hibernate: // Team ë‹¨ì¼ ì»¬ë ‰ì…˜ ê°’ SQL ì‹¤í–‰í•˜ì—¬ 1ì°¨ ìºì‹œ ì €ì¥
    select
        t1_0.id,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.id=?

username = íšŒì›1, teamName = TeamA // ë‹¨ì¼ ì»¬ë ‰ì…˜ ê°’ SQL ì‹¤í–‰
username = íšŒì›2, teamName = TeamA // 1ì°¨ ìºì‹œì— ì €ì¥ëœ ë‚´ì—­ ë°˜í™˜

Hibernate: 
    select
        t1_0.id,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.id=?

username = íšŒì›3, teamName = TeamB
```
```java
Team teamA = new Team();
teamA.setName("TeamA");
em.persist(teamA);

Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

Member member1 = new Member();
member1.setUsername("íšŒì›1");
member1.setAge(10);
member1.setTeam(teamA);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("íšŒì›2");
member2.setAge(20);
member2.setTeam(teamA);
em.persist(member2);

Member member3 = new Member();
member3.setUsername("íšŒì›3");
member3.setAge(30);
member3.setTeam(teamB);
em.persist(member3);

em.flush();
em.clear();

String query = "SELECT m FROM Member m JOIN FETCH m.team"; // Fetch Join

List<Member> result = em.createQuery(query, Member.class).getResultList(); // Fetch Joinìœ¼ë¡œ ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ëª¨ë“  ë°ì´í„°ê°€ 1ì°¨ ìºì‹œì— ì €ì¥

for (Member member : result) {
    System.out.println("username = " + member.getUsername() + ", " + "teamName = " + member.getTeam().getName()); // ì§€ì—° ë¡œë”©ì´ ì•„ë‹˜
}

tx.commit();
```
```
Hibernate: 
    /* SELECT
        m 
    FROM
        Member m 
    JOIN
        
    FETCH
        m.team */ select
            m1_0.id,
            m1_0.age,
            t1_0.id,
            t1_0.name,
            m1_0.type,
            m1_0.username 
        from
            Member m1_0 
        join
            Team t1_0 
                on t1_0.id=m1_0.TEAM_ID

username = íšŒì›1, teamName = TeamA
username = íšŒì›2, teamName = TeamA
username = íšŒì›3, teamName = TeamB
```
-----
### Collection Fetch Join
-----
1. ğŸ’¡ ì¼ëŒ€ë‹¤ ê´€ê³„ (Collection Fetch Join)
2. JPQL
```java
SELECT t FROM Team t JOIN FETCH t.members WEHRE t.name = 'íŒ€A'
```

3. SQL
```java
SELECT T.*, M.* FROM TEAM T INNER JOIN Member M ON T.ID = M.TEAM_ID
WHERE T.NAME = 'íŒ€A'
```
<div align="center">
<img src="https://github.com/user-attachments/assets/030d2d91-fb43-4089-9d9d-6b257cf56c26">
</div>

4. ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ ì‚¬ìš© ì½”ë“œ
```java
Team teamA = new Team();
teamA.setName("TeamA");
em.persist(teamA);

Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

Member member1 = new Member();
member1.setUsername("íšŒì›1");
member1.setAge(10);
member1.setTeam(teamA);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("íšŒì›2");
member2.setAge(20);
member2.setTeam(teamA);
em.persist(member2);

Member member3 = new Member();
member3.setUsername("íšŒì›3");
member3.setAge(30);
member3.setTeam(teamB);
em.persist(member3);

em.flush();
em.clear();

String query = "SELECT t FROM Team t JOIN FETCH t.members";

List<Team> result = em.createQuery(query, Team.class).getResultList();

for (Team team : result) {
    System.out.println("teamName = " + team.getName() + ", " + "size = " + team.getMembers().size()); // Hibernate 6 ì´ìƒë¶€í„°ëŠ” ìµœì í™”ë¡œ DISTINCT ìë™ ì ìš©
}
```
```
Hibernate: 
    /* SELECT
        t 
    FROM
        Team t 
    JOIN
        
    FETCH
        t.members  */ select
            t1_0.id,
            m1_0.TEAM_ID,
            m1_0.id,
            m1_0.age,
            m1_0.type,
            m1_0.username,
            t1_0.name 
        from
            Team t1_0 
        join
            Member m1_0 
                on t1_0.id=m1_0.TEAM_ID
teamName = TeamA, size = 2  // Hibernate 6 ì´ìƒë¶€í„°ëŠ” ìµœì í™”ë¡œ DISTINCT ìë™ ì ìš©
teamName = TeamB, size = 1
```

```java
String jpql = "SELECT t FROM Team t JOIN FETCH t.members WHERE t.name = 'íŒ€A'";

List<Team> teams = em.createQuery(jpql, Team.class).getResultList();

for(Team team : teams) {
    System.out.println("teamname = " + team.getName() + ", team = " + team);
    for(Member member : team.getMembers()) {
        // ğŸ’¡ í˜ì¹˜ ì¡°ì¸ì„ íŒ€ê³¼ íšŒì›ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë°œìƒ ì•ˆí•¨
        System.out.println(" -> username = " + member.getUsername() + ", member = " + member);
    }
}
```
```
teamName = TeamA, team = hellojpa.Team@1fc1c7e
-> userName = íšŒì›1, member = hellojpa.Member@5f3f3d00
-> userName = íšŒì›2, member = hellojpa.Member@6b8bdcc6
```

-----
### Fetch Joinê³¼ DISTINCT
-----
1. SQLì˜ DISTINCTëŠ” ì¤‘ë³µëœ ê²°ê³¼ë¥¼ ì œê³µí•˜ëŠ” ëª…ë ¹
2. JPQLì˜ DISTINCTëŠ” 2ê°€ì§€ ê¸°ëŠ¥ ì œê³µ
   - ğŸ’¡ SQLì— DISTINCT ì¶”ê°€
   - ğŸ’¡ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì—”í‹°í‹° ì¤‘ë³µ ì œê±°

3. ì˜ˆì‹œ
```java
SELECT DISTINCT t
FROM Team t JOIN FETCH t.members
WEHRE t.name = 'íŒ€A'
```
  - ğŸ’¡ SQLì— DISTINCTë¥¼ ì¶”ê°€í•˜ì§€ë§Œ, ë°ì´í„°ê°€ ë‹¤ë¥´ë¯€ë¡œ SQLì—ì„œ ì¤‘ë³µì œê±° ì‹¤íŒ¨
<div align="center">
<img src="https://github.com/user-attachments/assets/1b7ff59d-ec43-4662-a868-5f030cbcf744">
</div>

4. ğŸ’¡ DISTINCTê°€ ì¶”ê°€ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ë³µ ì œê±° ì‹œë„
   - ğŸ’¡ ê°™ì€ ì‹ë³„ìë¥¼ ê°€ì§„ Team ì—”í‹°í‹° ì œê±°
<div align="center">
<img src="https://github.com/user-attachments/assets/3866de89-7b11-461a-a32c-8c06745cb249">
</div>

  - DISTINCT ì¶”ê°€ ì‹œ ê²°ê³¼
  - teamname = íŒ€A, team = Team@0x1000
    + -> username = íšŒì›1, member = Member@0x200
    + -> username = íšŒì›2, member = Member@0x300

5. Hibernate ë³€ê²½ ì‚¬í•­
   - DISTINCT ì¶”ê°€ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ë³µ ì œê±° ì‹œë„
     + í•˜ì´ë²„ë„¤ì´íŠ¸6 ë¶€í„°ëŠ” DISTINCT ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¤‘ë³µ ì œê±°ê°€ ìë™ ì ìš©
   - ì°¸ê³  ë§í¬ : https://www.inï¬‚earn.com/questions/717679

-----
### í˜ì¹˜ ì¡°ì¸ê³¼ ì¼ë°˜ ì¡°ì¸ì˜ ì°¨ì´
-----
1. ğŸ’¡ ì¼ë°˜ ì¡°ì¸ ì‹¤í–‰ ì‹œ, ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ì§€ ì•ŠìŒ
2. JPQL
```java
SELECT t
FROM Team t JOIN t.members 
WHERE t.name = 'íŒ€A'
```
```java
String query = "SELECT t FROM Team t JOIN t.members";

List<Team> result = em.createQuery(query, Team.class).getResultList();

System.out.println("result = " + result.size());
for (Team team : result) {
    System.out.println("teamName = " + team.getName() + ", " + "team = " + team);
    for (Member member : team.getMembers()) {
        System.out.println("-> userName = " + member.getUsername() + ", member = " + member);
    }
}
```
```
Hibernate: // Team ê°ì²´ì˜ í•„ë“œ ê°’ë§Œ ì¡°íšŒ (Memberì™€ JOIN ë˜ì—ˆì„ì§€ë¼ë„)
    /* SELECT
        t 
    FROM
        Team t 
    JOIN
        t.members */ select
            t1_0.id,
            t1_0.name 
        from
            Team t1_0 
        join
            Member m1_0 
                on t1_0.id=m1_0.TEAM_ID

result = 2
teamName = TeamA, team = hellojpa.Team@394fb736

Hibernate: // t.members ì§€ì—° ë¡œë”©
    select
        m1_0.TEAM_ID,
        m1_0.id,
        m1_0.age,
        m1_0.type,
        m1_0.username 
    from
        Member m1_0 
    where
        m1_0.TEAM_ID=?
-> userName = íšŒì›1, member = hellojpa.Member@27358a19
-> userName = íšŒì›2, member = hellojpa.Member@22865072

teamName = TeamB, team = hellojpa.Team@4fc6e776
Hibernate: // t.members ì§€ì—° ë¡œë”©
    select
        m1_0.TEAM_ID,
        m1_0.id,
        m1_0.age,
        m1_0.type,
        m1_0.username 
    from
        Member m1_0 
    where
        m1_0.TEAM_ID=?
-> userName = íšŒì›3, member = hellojpa.Member@4601047
```

3. SQL
```java
SELECT T.*
FROM TEAM T
INNER JOIN MEMBER M ON T.ID = M.TEAM_ID
WHERE T.NAME = 'íŒ€A'
```

3. ğŸ’¡ğŸ’¡ JPQLì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ë•Œ ì—°ê´€ê´€ê³„ë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠìŒ
   - ğŸ’¡ğŸ’¡ğŸ’¡ ë‹¨ì§€, SELECT ì ˆì— ì§€ì •í•œ ì—”í‹°í‹°ë§Œ ì¡°íšŒ
   - ì—¬ê¸°ì„œëŠ” íŒ€ ì—”í‹°í‹°ë§Œ ì¡°íšŒí•˜ê³ , íšŒì› ì—”í‹°í‹°ëŠ” ì¡°íšŒí•˜ì§€ ì•ŠìŒ

4. ğŸ’¡ğŸ’¡ğŸ’¡ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•  ë•Œë§Œ, ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒ (ğŸ’¡ ì¦‰ì‹œ ë¡œë”©)
5. ğŸ’¡ í˜ì¹˜ ì¡°ì¸ì€ ê°ì²´ ê·¸ë˜í”„ë¥¼ SQL í•œë²ˆì— ì¡°íšŒí•˜ëŠ” ê°œë…

6. í˜ì¹˜ì¡°ì¸ ì‹¤í–‰ ì˜ˆì‹œ
  - JPQL
```java
SELECT t
FROM Team m JOIN FETCH t.members
WHERE t.name = 'íŒ€A'
```
```java
Team teamA = new Team();
teamA.setName("TeamA");
em.persist(teamA);

Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

Member member1 = new Member();
member1.setUsername("íšŒì›1");
member1.setAge(10);
member1.setTeam(teamA);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("íšŒì›2");
member2.setAge(20);
member2.setTeam(teamA);
em.persist(member2);

Member member3 = new Member();
member3.setUsername("íšŒì›3");
member3.setAge(30);
member3.setTeam(teamB);
em.persist(member3);

em.flush();
em.clear();

String query = "SELECT t FROM Team t JOIN FETCH t.members";

List<Team> result = em.createQuery(query, Team.class).getResultList();

System.out.println("result = " + result.size());
for (Team team : result) {
    System.out.println("teamName = " + team.getName() + ", " + "team = " + team);
    for (Member member : team.getMembers()) {
        System.out.println("-> userName = " + member.getUsername() + ", member = " + member);
    }
}
```

```
Hibernate: 
    /* SELECT
        t 
    FROM
        Team t 
    JOIN
        
    FETCH
        t.members */ select
            t1_0.id,
            m1_0.TEAM_ID,
            m1_0.id,
            m1_0.age,
            m1_0.type,
            m1_0.username,
            t1_0.name 
        from
            Team t1_0 
        join
            Member m1_0 
                on t1_0.id=m1_0.TEAM_ID

result = 2
teamName = TeamA, team = hellojpa.Team@11399548
-> userName = íšŒì›1, member = hellojpa.Member@64c25a62
-> userName = íšŒì›2, member = hellojpa.Member@16a6dc21
teamName = TeamB, team = hellojpa.Team@7871d261
-> userName = íšŒì›3, member = hellojpa.Member@59f45950
```

4. SQL
```java
SELECT T.*, M.* FROM TEAM T INNER JOIN MEMBER M ON T.ID = M.TEAM_ID
WHERE T.NAME = 'íŒ€A'
```
