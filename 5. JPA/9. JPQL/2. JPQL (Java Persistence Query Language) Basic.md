-----
### JPQL (Java Persistence Query Language)
-----
1. ğŸ’¡ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¡œ, í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
2. SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
3. ê²°êµ­, JPQLì€ SQLë¡œ ë³€í™˜

<div align="center">
<img src="https://github.com/user-attachments/assets/56967567-7389-4128-a71e-7fd44ad8454e">
</div>

  - Member
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member {

    @Id @GeneratedValue
    private Long id;

    private String username;
    private int age;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}
```

  - Team
```java
package hellojpa;

import jakarta.persistence.*;

import java.util.ArrayList;
import java.util.List;

@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> member = new ArrayList<>();

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

  - Order
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
@Table(name = "ORDERS")
public class Order {
    @Id @GeneratedValue
    private Long id;
    private int orderAmount;

    @Embedded
    private Address address;

    @ManyToOne
    @JoinColumn(name = "PRODUCT_ID")
    private Product product;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public int getOrderAmount() {
        return orderAmount;
    }

    public void setOrderAmount(int orderAmount) {
        this.orderAmount = orderAmount;
    }

    public Address getAddress() {
        return address;
    }

    public void setAddress(Address address) {
        this.address = address;
    }

    public Product getProduct() {
        return product;
    }

    public void setProduct(Product product) {
        this.product = product;
    }

}
```

  - Address
```java
package hellojpa;

import jakarta.persistence.Embeddable;

@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

    public String getStreet() {
        return street;
    }

    public void setStreet(String street) {
        this.street = street;
    }

    public String getZipcode() {
        return zipcode;
    }

    public void setZipcode(String zipcode) {
        this.zipcode = zipcode;
    }
}
```

  - Product
```java
package hellojpa;

import jakarta.persistence.*;

import java.util.ArrayList;
import java.util.List;

@Entity
public class Product {
    @Id @GeneratedValue
    private Long id;

    private String name;
    private int price;
    private String stockAmount;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getPrice() {
        return price;
    }

    public void setPrice(int price) {
        this.price = price;
    }

    public String getStockAmount() {
        return stockAmount;
    }

    public void setStockAmount(String stockAmount) {
        this.stockAmount = stockAmount;
    }
}
```

```
Hibernate: 
    create table Member (
        age integer not null,
        TEAM_ID bigint,
        id bigint not null,
        username varchar(255),
        primary key (id)
    )

Hibernate: 
    create table Team (
        id bigint not null,
        name varchar(255),
        primary key (id)
    )

Hibernate: 
    create table ORDERS (
        orderAmount integer not null,
        PRODUCT_ID bigint,
        id bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        primary key (id)
    )

Hibernate: 
    create table Product (
        price integer not null,
        id bigint not null,
        name varchar(255),
        stockAmount varchar(255),
        primary key (id)
    )
```

4. JPQL ë¬¸ë²•
```java
select_ë¬¸ :: =
  select_ì ˆ
  from_ì ˆ
  [where_ì ˆ]
  [groupby_ì ˆ]
  [having_ì ˆ]
  [orderby_ì ˆ]

// ë²Œí¬ ì—°ì‚°
update_ë¬¸ :: = update_ì ˆ [where_ì ˆ]
delete_ë¬¸ :: = delete_ì ˆ [where_ì ˆ]
```
```java
SELECT m FROM Member AS m WHERE m.age > 18
```
  - ğŸ’¡ ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•´ì•¼ í•¨(Member, age)
  - ğŸ’¡ JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•Šì•„ë„ ë¨ (SELECT, FROM, WHERE)
  - ğŸ’¡ ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ (í…Œì´ë¸” ì´ë¦„ì´ ì•„ë‹˜ (Member))
  - ğŸ’¡ ë³„ì¹­ì€ í•„ìˆ˜(m) (AS ìƒëµ ê°€ëŠ¥)

5. ì§‘í•©ê³¼ ì •ë ¬ ê¸°ëŠ¥ ì œê³µ
```java
SELECT
  COUNT(m), // íšŒì›ìˆ˜
  SUM(m.age), // ë‚˜ì´ í•©
  AVG(m.age), // í‰ê·  ë‚˜ì´
  MIN(m.age), // ìµœì†Œ ë‚˜ì´
  MAX(m.age) // ìµœëŒ€ ë‚˜ì´
FROM Member m
```
  - GROUP BY, HAVING ì œê³µ
  - ORDER BY ì œê³µ

-----
### TypedQuery, Query
-----
1. TypedQuery : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m", Member.class);
```
```java
TypedQuery<String> query = em.createQuery("SELEC m.username FROM Member m", String.class);
```
  - ğŸ’¡ m.username : ë°˜í™˜ íƒ€ì…ì´ String ì´ë¯€ë¡œ ê°€ëŠ¥
    
2. Query : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©
```java
Query query = em.createQuery("SELECT m.username, m.age FROM Member m");
```
  - ğŸ’¡ m.usernameëŠ” String, m.ageëŠ” Integer íƒ€ì…ì´ë¯€ë¡œ ëª…í™•í•˜ì§€ ì•ŠìŒ
    
-----
### ê²°ê³¼ ì¡°íšŒ API
-----
1. ğŸ’¡ query.getResultList() : ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒ ì¼ ë–„, ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
   - ğŸ’¡ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m", Member.class);
List<Member> members = query.getResultList();
```

2. ğŸ’¡ query.getSingleResult() : ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜, ë‹¨ì¼ ê°ì²´ ë°˜í™˜
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m", Member.class);
Member singleResult = query.getSingleResult();
```
   - ğŸ’¡ ê²°ê³¼ê°€ ì—†ìŒ : jakarta.persistence.NoResultException ì˜ˆì™¸ ë°œìƒ
   - ğŸ’¡ ë‘˜ ì´ìƒ : jakarta.persistence.NonUniqueResultException ì˜ˆì™¸ ë°œìƒ

-----
### íŒŒë¼ë¯¸í„° ë°”ì¸ë”© - ì´ë¦„ ê¸°ì¤€, ìœ„ì¹˜ ê¸°ì¤€
-----
1. íŒŒë¼ë¯¸í„° ë°”ì¸ë”© - ì´ë¦„ ê¸°ì¤€ (ê¶Œì¥)
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m WHERE m.username = :username", Member.class)

query.setParamter("username", usernameParam);
```
```java
package hellojpa;

import jakarta.persistence.*;
import jakarta.persistence.criteria.CriteriaBuilder;
import jakarta.persistence.criteria.CriteriaQuery;
import jakarta.persistence.criteria.Root;

import java.util.List;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Member member = new Member();
            member.setUsername("member1");
            member.setAge(10);
            em.persist(member);


            Member singleResult = em.createQuery("SELECT m FROM Member m WHERE m.username = :username", Member.class)
                                    .setParameter("username", "member1")
                                    .getSingleResult();
            System.out.println("singleResult = " + singleResult);

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
Hibernate: 
    /* SELECT
        m 
    FROM
        Member m 
    WHERE
        m.username = :username */ select
            m1_0.id,
            m1_0.age,
            m1_0.TEAM_ID,
            m1_0.username 
        from
            Member m1_0 
        where
            m1_0.username=?
singleResult = hellojpa.Member@3c952a33
```

2. íŒŒë¼ë¯¸í„° ë°”ì¸ë”© - ìœ„ì¹˜ ê¸°ì¤€ (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m WHERE m.username = ?1", Member.class);

query.setParamter(1, usernameParam);
```
