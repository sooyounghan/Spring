-----
### ì„ë² ë””ë“œ íƒ€ì…
-----
1. ìƒˆë¡œìš´ ê°’ íƒ€ì…ì„ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆìŒ
  - JPAëŠ” ì„ë² ë””ë“œ íƒ€ì…(Embedded Type)ì´ë¼ í•¨
2. ì£¼ë¡œ ê¸°ë³¸ ê°’ íƒ€ì…ì„ ëª¨ì•„ ë§Œë“¤ì–´ì„œ ë³µí•© ê°’ íƒ€ì…ì´ë¼ê³  í•¨
  - ğŸ’¡ ì„ë² ë””ë“œ íƒ€ì… ì—­ì‹œ int, Stringê³¼ ê°™ì€ ê°’ íƒ€ì…
3. ì˜ˆì‹œ
  - íšŒì› ì—”í‹°í‹°ëŠ” ì´ë¦„, ê·¼ë¬´ ì‹œì‘ì¼, ê·¼ë¬´ ì¢…ë£Œì¼, ì£¼ì†Œ ë„ì‹œ, ì£¼ì†Œ ë²ˆì§€, ì£¼ì†Œ ìš°í¸ ë²ˆí˜¸ë¥¼ ê°€ì§
    + ê·¼ë¬´ ì‹œì‘ì¼ / ê·¼ë¬´ ì¢…ë£Œì¼ê³¼ ì£¼ì†Œ ë„ì‹œ / ì£¼ì†Œ ë²ˆì§€ / ì£¼ì†Œ ìš°í¸ ë²ˆí˜¸ë¥¼ ë¬¶ì„ ìˆ˜ ìˆìŒ
<div align="center">
<img src="https://github.com/user-attachments/assets/1712d20f-8dec-4c41-93fa-58e1d55b18b0">
</div>

  - íšŒì› ì—”í‹°í‹°ëŠ” ì´ë¦„, ê·¼ë¬´ ê¸°ê°„, ì§‘ ì£¼ì†Œë¥¼ ê°€ì§ (ì¶”ìƒí™” ê°€ëŠ¥) â†’ ì„ë² ë””ë“œ íƒ€ì…
<div align="center">
<img src="https://github.com/user-attachments/assets/89802091-e456-4e93-a45e-f663df79bd04">
</div>

<div align="center">
<img src="https://github.com/user-attachments/assets/89001ee9-fc76-4040-8942-58fa439e841c">
</div>

4. ì‚¬ìš©ë²•
   - ğŸ’¡ @Embeddedable : ê°’ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ê³³ì— í‘œì‹œ
   - ğŸ’¡ @Embedded : ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— í‘œì‹œ
   - ğŸ’¡ ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜

5. ì¥ì 
   - ì¬ì‚¬ìš©
   - ë†’ì€ ì‘ì§‘ë„
   - Period.isWork()ì²˜ëŸ¼ í•´ë‹¹ ê°’ íƒ€ì…ë§Œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ ìˆëŠ” ë©”ì†Œë“œ ì œì‘ ê°€ëŠ¥
   - ğŸ’¡ ì„ë² ë””ë“œ íƒ€ì…ì„ í¬í•¨í•œ ëª¨ë“  ê°’ íƒ€ì…ì€, ê°’ íƒ€ì…ì„ ì†Œìœ í•œ ì—”í‹°í‹°ì— ìƒëª…ì£¼ê¸° ì˜ì¡´

6. ì„ë² ë””ë“œ íƒ€ì…ê³¼ í…Œì´ë¸” ë§¤í•‘
<div align="center">
<img src="https://github.com/user-attachments/assets/0f55fa2d-03a6-4736-b58a-1e7cad7c18aa">
</div>

  - Member
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    // Period
    @Embedded
    private Period workPeriod;

    // Address
    @Embedded
    private Address homeAddress;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public Period getWorkPeriod() {
        return workPeriod;
    }

    public void setWorkPeriod(Period workPeriod) {
        this.workPeriod = workPeriod;
    }

    public Address getHomeAddress() {
        return homeAddress;
    }

    public void setHomeAddress(Address homeAddress) {
        this.homeAddress = homeAddress;
    }
}
```

  - Period
```java
package hellojpa;

import jakarta.persistence.Embeddable;

import java.time.LocalDateTime;

@Embeddable
public class Period {
    private LocalDateTime startDate;
    private LocalDateTime endDate;

    public Period() { // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    }

    public Period(LocalDateTime startDate, LocalDateTime endDate) {
        this.startDate = startDate;
        this.endDate = endDate;
    }

    public LocalDateTime getStartDate() {
        return startDate;
    }

    public void setStartDate(LocalDateTime startDate) {
        this.startDate = startDate;
    }

    public LocalDateTime getEndDate() {
        return endDate;
    }

    public void setEndDate(LocalDateTime endDate) {
        this.endDate = endDate;
    }
}
```

  - Address
```java
package hellojpa;

import jakarta.persistence.Embeddable;

@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;

    public Address() { // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    }

    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

    public String getStreet() {
        return street;
    }

    public void setStreet(String street) {
        this.street = street;
    }

    public String getZipcode() {
        return zipcode;
    }

    public void setZipcode(String zipcode) {
        this.zipcode = zipcode;
    }
}
```

```java
package hellojpa;

import jakarta.persistence.*;
import org.hibernate.Hibernate;

import java.time.LocalDateTime;
import java.util.List;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜
        tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

        try {
            Member member = new Member();
            member.setUsername("hello");
            member.setHomeAddress(new Address("city", "street", "zipcode"));
            member.setWorkPeriod(new Period(LocalDateTime.now(), LocalDateTime.now()));

            em.persist(member);

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
            e.printStackTrace();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
```
Hibernate: 
    create table Member (
        MEMBER_ID bigint not null,
        endDate timestamp(6),
        startDate timestamp(6),
        USERNAME varchar(255),
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        primary key (MEMBER_ID)
    )

...

Hibernate: 
    /* insert for
        hellojpa.Member */insert 
    into
        Member (city, street, zipcode, USERNAME, endDate, startDate, MEMBER_ID) 
    values
        (?, ?, ?, ?, ?, ?, ?)
```
  - ğŸ’¡ ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹°ì˜ ê°’ì¼ ë¿ì„
  - ğŸ’¡ ì„ë² ë””ë“œ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— ğŸ’¡ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ê°™ìŒ
  - ê°ì²´ì™€ í…Œì´ë¸”ì„ ì•„ì£¼ ì„¸ë°€í•˜ê²Œ (find-grained) ë§¤í•‘í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥
  - ì˜ ì„¤ê³„í•œ ORM ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë§¤í•‘í•œ í…Œì´ë¸” ìˆ˜ë³´ë‹¤ í´ë˜ìŠ¤ì˜ ìˆ˜ê°€ ë” ë§ìŒ

7. ì„ë² ë””ë“œ íƒ€ì…ê³¼ ì—°ê´€ê´€ê³„
<div align="center">
<img src="https://github.com/user-attachments/assets/33c58c32-eced-4bb9-82c1-139c8a99e830">
</div>

  - ì„ë² ë””ë“œ íƒ€ì…ì€ ì…ë² ë””ë“œ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ (Address - Zipcode)
  - ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° íƒ€ì… ê°€ì§ˆ ìˆ˜ ìˆìŒ (PhoneNumber - PhoneEntity)
```java
public class Address {
    private String city;
    private String street;
    private String zipcode;

    private PhoneEntity phoneEntity; // PhoneEnity : Entity

    ...
}
```

8. @AttritubeOverride : ì†ì„± ì¬ì •ì˜
   - í•œ ì—”í‹°í‹°ì—ì„œ ê°™ì€ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´?
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    // Period
    @Embedded
    private Period workPeriod;

    // Address
    @Embedded
    private Address homeAddress;

    // Address
    @Embedded
    private Address workAddress; // ì¤‘ë³µ
}
```
```
Exception in thread "main" jakarta.persistence.PersistenceException: [PersistenceUnit: hello] Unable to build Hibernate SessionFactory
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.persistenceException(EntityManagerFactoryBuilderImpl.java:1591)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1512)
	at org.hibernate.jpa.HibernatePersistenceProvider.createEntityManagerFactory(HibernatePersistenceProvider.java:55)
	at jakarta.persistence.Persistence.createEntityManagerFactory(Persistence.java:80)
	at jakarta.persistence.Persistence.createEntityManagerFactory(Persistence.java:55)
	at hellojpa.JpaMain.main(JpaMain.java:11)
Caused by: org.hibernate.MappingException: Column 'city' is duplicated in mapping for entity 'hellojpa.Member' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
	at org.hibernate.mapping.Value.checkColumnDuplication(Value.java:197)
	at org.hibernate.mapping.MappingHelper.checkPropertyColumnDuplication(MappingHelper.java:249)
	at org.hibernate.mapping.Component.checkColumnDuplication(Component.java:278)
	at org.hibernate.mapping.MappingHelper.checkPropertyColumnDuplication(MappingHelper.java:249)
	at org.hibernate.mapping.PersistentClass.checkColumnDuplication(PersistentClass.java:935)
	at org.hibernate.mapping.PersistentClass.validate(PersistentClass.java:678)
	at org.hibernate.mapping.RootClass.validate(RootClass.java:273)
	at org.hibernate.boot.internal.MetadataImpl.validate(MetadataImpl.java:497)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:273)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507)
	... 4 more
```
   - ì»¬ëŸ¼ëª…ì´ ì¤‘ë³µë¨
   - ğŸ’¡ @AttributeOverride (í•˜ë‚˜), @AttributeOverrides (ë‹¤ìˆ˜)ë¥¼ ì‚¬ìš©í•´ì„œ ì»¬ëŸ¼ ëª… ì†ì„±ì„ ì¬ì •ì˜
```
@Embedded
@AttributeOverrides({
        @AttributeOverride(name="startDate", column=@Column(name = "EMP_START")),
	@AttributeOverride(name="endDate", column=@Column(name = "EMP_END"))
})
```
```java
package hellojpa;

import jakarta.persistence.*;

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    // Period
    @Embedded
    private Period workPeriod;

    // Address
    @Embedded
    private Address homeAddress;

    // Address
    @Embedded
    @AttributeOverrides(value = {@AttributeOverride(name = "city", column = @Column(name = "WORK_CITY")),
                                @AttributeOverride(name = "street", column = @Column(name = "WORK_STREET")),
                                @AttributeOverride(name = "zipcode", column = @Column(name = "WORK_ZIPCODE"))
    })
    private Address workAddress;

    ...
}
```
```
Hibernate: 
    create table Member (
        MEMBER_ID bigint not null,
        endDate timestamp(6),
        startDate timestamp(6),
        USERNAME varchar(255),
        WORK_CITY varchar(255),
        WORK_STREET varchar(255),
        WORK_ZIPCODE varchar(255),
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        primary key (MEMBER_ID)
    )
```

9. ì„ë² ë””ë“œ íƒ€ì…ì˜ ê°’ì´ nullì´ë©´, ë§¤í•‘í•œ ì»¬ëŸ¼ ê°’ì€ ëª¨ë‘ null
```java
// Period
@Embedded
private Period workPeriod = null;
```
  - ê´€ë ¨ëœ ë§¤í•‘ ì»¬ëŸ¼ ê°’ ëª¨ë‘ null ê°’ ì…ë ¥
