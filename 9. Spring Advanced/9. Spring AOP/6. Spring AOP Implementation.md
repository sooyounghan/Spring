-----
### ìŠ¤í”„ë§ AOP êµ¬í˜„ 1
-----
1. ìŠ¤í”„ë§ AOPë¥¼ êµ¬í˜„í•˜ëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ì€ @Aspect
2. AspectV1
```java
package hello.aop.order.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;

@Slf4j
@Aspect
public class AspectV1 {
    
    @Around("execution(* hello.aop.order..*(..)")
    public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
        log.info("[log] {}", joinPoint.getSignature()); // Join Point ì‹œê·¸ë‹ˆì²˜
        return joinPoint.proceed();
    }
}
```

  - @Around ì• ë„ˆí…Œì´ì…˜ ê°’ì¸ execution(* hello.aop.order..*(..)) : í¬ì¸íŠ¸ì»·
  - @Around ì• ë„ˆí…Œì´ì…˜ì˜ ë©”ì„œë“œì¸ doLog : ì–´ë“œë°”ì´ìŠ¤(Advice)
  - execution(* hello.aop.order..*(..))
    + hello.aop.order íŒ¨í‚¤ì§€ì™€ ê·¸ í•˜ìœ„ íŒ¨í‚¤ì§€(..)ë¥¼ ì§€ì •í•˜ëŠ” AspectJ í¬ì¸íŠ¸ì»· í‘œí˜„ì‹
  - ë”°ë¼ì„œ, OrderService, OrderRepositoryì˜ ëª¨ë“  ë©”ì„œë“œëŠ” AOP ì ìš© ëŒ€ìƒ
  - ğŸ’¡ ì°¸ê³ ë¡œ, ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ ë°©ì‹ì˜ AOPë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ í”„ë¡ì‹œë¥¼ í†µí•˜ëŠ” ë©”ì„œë“œë§Œ ì ìš© ëŒ€ìƒ

  - ğŸ’¡ ìŠ¤í”„ë§ AOPëŠ” AspectJ ë¬¸ë²•ì„ ì°¨ìš©í•˜ê³ , í”„ë¡ì‹œ ë°©ì‹ì˜ AOPë¥¼ ì œê³µ (ì¦‰, AspectJë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹˜)
  - ìŠ¤í”„ë§ AOPë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” @Aspect ì• ë„ˆí…Œì´ì…˜ì„ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ì• ë„ˆí…Œì´ì…˜ë„ AspectJê°€ ì œê³µí•˜ëŠ” ì• ë„ˆí…Œì´ì…˜

  - @Aspectë¥¼ í¬í•¨í•œ org.aspectj íŒ¨í‚¤ì§€ ê´€ë ¨ ê¸°ëŠ¥ì€ aspectjweaver.jar ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
    + ğŸ’¡ build.gradleì— spring-boot-starter-aopë¥¼ í¬í•¨í–ˆëŠ”ë°, ì´ëŠ” ìŠ¤í”„ë§ì˜ AOP ê´€ë ¨ ê¸°ëŠ¥ê³¼ í•¨ê»˜ aspectjweaver.jarë„ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì˜ì¡´ ê´€ê³„ í¬í•¨
    + ğŸ’¡ ê·¸ëŸ°ë°, ìŠ¤í”„ë§ì—ì„œëŠ” AsepctJê°€ ì œê³µí•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë‚˜ ê´€ë ¨ ì¸í„°í˜ì´ìŠ¤ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ê³ , ì‹¤ì œ AspectJê°€ ì œê³µí•˜ëŠ” ì»´íŒŒì¼, ë¡œë“œíƒ€ì„ ìœ„ë²„ ë“± ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹˜
    + ğŸ’¡ ì¦‰, ìŠ¤í”„ë§ì—ì„œëŠ” í”„ë¡ì‹œ ë°©ì‹ì˜ AOPë§Œì„ ì‚¬ìš©

3. AopTest
```java
package hello.aop;

import hello.aop.order.OrderRepository;
import hello.aop.order.OrderService;
import hello.aop.order.aop.AspectV1;
import lombok.extern.slf4j.Slf4j;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.aop.support.AopUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

@Slf4j
@SpringBootTest
@Import(AspectV1.class)
public class AopTest {

    @Autowired OrderRepository orderRepository;
    @Autowired OrderService orderService;

    @Test
    void aopInfo() {
        log.info("isAopProxy, orderService = {}", AopUtils.isAopProxy(orderService));
        log.info("isAopProxy, orderRepository = {}", AopUtils.isAopProxy(orderRepository));
    }

    @Test
    void success() {
        orderService.orderItem("itemA");
    }

    @Test
    void exception() {
        Assertions.assertThatThrownBy(() -> orderService.orderItem("ex"))
                .isInstanceOf(IllegalStateException.class);
    }
}
```
  - ğŸ’¡ @AspectëŠ” ì—ìŠ¤í™íŠ¸ë¼ëŠ” í‘œì‹ì´ì§€ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì´ ë˜ëŠ” ê²ƒì´ ì•„ë‹˜
  - ğŸ’¡ ë”°ë¼ì„œ, AsepctV1ì„ AOPë¡œ ì‚¬ìš©í•˜ë ¤ë©´ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•´ì•¼ í•¨
  - ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•˜ëŠ” ë°©ë²•
    + @Bean ì‚¬ìš© : ì§ì ‘ ë“±ë¡
    + @Component : ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•´ ìë™ ë“±ë¡
    + @Import : ì£¼ë¡œ ì„¤ì •íŒŒì¼ì„ ì¶”ê°€í•  ë•Œ ì‚¬ìš© (@Configuration)
    + @ImportëŠ” ì£¼ë¡œ ì„¤ì • íŒŒì¼ì„ ì¶”ê°€í•  ë•Œ ì‚¬ìš©í•˜ì§€ë§Œ, ì´ ê¸°ëŠ¥ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆë„ ë“±ë¡ ê°€ëŠ¥
    + í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë²„ì „ì„ ì˜¬ë ¤ê°€ë©´ì„œ ë³€ê²½í•  ì˜ˆì •ì´ì–´ì„œ ê°„ë‹¨í•˜ê²Œ @Import ê¸°ëŠ¥ ì‚¬ìš© ì˜ˆì •
  - AopTestì— @Import(AspectV1.class)ë¡œ ìŠ¤í”„ë§ ë¹ˆ ì¶”ê°€
  - AopUtils.isAopProxy(...)ë„ í”„ë¡ì‹œê°€ ì ìš©ë˜ì—ˆìœ¼ë¯€ë¡œ true ë°˜í™˜
```
[aop] [    Test worker] hello.aop.order.aop.AspectV1             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV1             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderService = true
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderRepository = true
```

  - ì‹¤í–‰ - sucess()
```
[aop] [    Test worker] hello.aop.order.aop.AspectV1             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV1             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
```

<div align="center">
<img src="https://github.com/user-attachments/assets/00f59ffc-6df2-488c-b700-402da15b1658">
</div>

-----
### ìŠ¤í”„ë§ AOP êµ¬í˜„2 - í¬ì¸íŠ¸ì»· ë¶„ë¦¬
-----
1. @Aroundì— í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ì„ ì§ì ‘ ë„£ì„ ìˆ˜ ìˆì§€ë§Œ, @Pointcut ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•´ ë³„ë„ë¡œ ë¶„ë¦¬ ê°€ëŠ¥
2. AspectV2
```java
package hello.aop.order.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;

@Slf4j
@Aspect
public class AspectV2 {

    // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€
    @Pointcut("execution(* hello.aop.order..*(..))") // Pointcut Expression
    private void allOrder() {} // Pointcut Signature

    @Around("allOrder()")
    public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
        log.info("[log] {}", joinPoint.getSignature()); // Join Point ì‹œê·¸ë‹ˆì³
        return joinPoint.proceed();
    }
}
```

3. @Pointcut
   - @Pointcutì— í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ ì‚¬ìš©
   - ğŸ’¡ ë©”ì„œë“œ ì´ë¦„ê³¼ íŒŒë¼ë¯¸í„°ë¥¼ í•©ì³ì„œ í¬ì¸íŠ¸ì»· ì‹œê·¸ë‹ˆì²˜(Signature)
   - ğŸ’¡ ë©”ì„œë“œì˜ ë°˜í™˜ íƒ€ì…ì€ void
   - ğŸ’¡ ì½”ë“œ ë‚´ìš©ì€ ë¹„ì›Œë‘ 
   - ìœ„ì˜ í¬ì¸íŠ¸ì»· ì‹œê·¸ë‹ˆì²˜ëŠ” allOrder()
     + ì´ë¦„ ê·¸ëŒ€ë¡œ ì£¼ë¬¸ê³¼ ê´€ë ¨ëœ ëª¨ë“  ê¸°ëŠ¥ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” í¬ì¸íŠ¸ì»·
   - @Around ì–´ë“œë°”ì´ìŠ¤ì—ì„œëŠ” í¬ì¸íŠ¸ì»·ì„ ì§ì ‘ ì§€ì •í•´ë„ ë˜ì§€ë§Œ, í¬ì¸íŠ¸ì»· ì‹œê·¸ë‹ˆì²˜ë¥¼ ì‚¬ìš©í•´ë„ ë¨
   - ğŸ’¡ ì—¬ê¸°ì„œëŠ” @Around("allOrder()") ì‚¬ìš©
   - ğŸ’¡ private, public ê°™ì€ ì ‘ê·¼ ì œì–´ìëŠ” ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ë©´ privateë¥¼ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ, ë‹¤ë¥¸ ì—ìŠ¤í™íŠ¸ì—ì„œ ì°¸ê³ í•˜ë©´ public ì‚¬ìš©

4. ê²°ê³¼ì ìœ¼ë¡œ AspectV1ê³¼ ê°™ì€ ê¸°ëŠ¥ ìˆ˜í–‰í•˜ë‚˜, ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ í•˜ë‚˜ì˜ í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ì„ ì—¬ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ì— í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
5. ğŸ’¡ ë˜í•œ, ë‹¤ë¥¸ í´ë˜ìŠ¤ì— ìˆëŠ” ì™¸ë¶€ ì–´ë“œë°”ì´ìŠ¤ì—ì„œë„ í¬ì¸íŠ¸ì»·ì„ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
6. AopTest ìˆ˜ì •
```java
@Slf4j
@SpringBootTest
// @Import(AspectV1.class)
@Import(AspectV2.class)
public class AopTest {

    ...

}
```
  - @Import(AspectV1.class) ì£¼ì„ ì²˜ë¦¬
  - @Import(AspectV2.class) ì¶”ê°€
  - ì‹¤í–‰
```
[aop] [    Test worker] hello.aop.order.aop.AspectV2             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV2             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderService = true
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderRepository = true

[aop] [    Test worker] hello.aop.order.aop.AspectV2             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV2             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
```

-----
### ìŠ¤í”„ë§ AOP êµ¬í˜„3 - ì–´ë“œë°”ì´ìŠ¤ ì¶”ê°€
-----
1. ì•ì„œ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” ê¸°ëŠ¥ì— ì¶”ê°€ë¡œ íŠ¸ëœì­ì…˜ ì ìš©í•˜ëŠ” ì½”ë“œ ì¶”ê°€
2. íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘
   - í•µì‹¬ ë¡œì§ ì‹¤í–‰ ì§ì „ íŠ¸ëœì­ì…˜ ì‹œì‘
   - í•µì‹¬ ë¡œì§ ì‹¤í–‰
   - í•µì‹¬ ë¡œì§ ì‹¤í–‰ì— ë¬¸ì œê°€ ì—†ìœ¼ë©´ ì»¤ë°‹
   - í•µì‹¬ ë¡œì§ ì‹¤í–‰ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë¡¤ë°±

3. AspectV3
```java
package hello.aop.order.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;

@Slf4j
@Aspect
public class AspectV3 {

    // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€
    @Pointcut("execution(* hello.aop.order..*(..))") // Pointcut Expression
    private void allOrder() {} // Pointcut Signature

    // í´ë˜ìŠ¤ ì´ë¦„ íŒ¨í„´ì´ *Service
    @Pointcut("execution(* *..*Service.*(..))")
    private void allService() {}

    @Around("allOrder()")
    public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
        log.info("[log] {}", joinPoint.getSignature()); // Join Point ì‹œê·¸ë‹ˆì³
        return joinPoint.proceed();
    }

    // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€ ì´ë©´ì„œ í´ë˜ìŠ¤ ì´ë¦„ íŒ¨í„´ì´ *Service
    @Around("allOrder() && allService()")
    public Object doTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
        try {
            log.info("[íŠ¸ëœì­ì…˜ ì‹œì‘] {}", joinPoint.getSignature());
            Object result = joinPoint.proceed();
            log.info("[íŠ¸ëœì­ì…˜ ì»¤ë°‹] {}", joinPoint.getSignature());
            return result;
        } catch (Exception e) {
            log.info("[íŠ¸ëœì­ì…˜ ë¡¤ë°±] {}", joinPoint.getSignature());
            throw e;
        } finally {
            log.info("[ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] {}", joinPoint.getSignature());
        }
    }
}
```
  - allOrder() í¬ì¸íŠ¸ì»·ì€ hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•¨
  - allService() í¬ì¸íŠ¸ì»·ì€ íƒ€ì… ì´ë¦„ íŒ¨í„´ì´ *Serviceë¥¼ ëŒ€ìƒìœ¼ë¡œ í•¨
    + ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ, XxxServiceì²˜ëŸ¼ Serviceë¡œ ëë‚˜ëŠ” ê²ƒì„ ëŒ€ìƒ (```*Servi*```ê³¼ ê°™ì€ íŒ¨í„´ë„ ê°€ëŠ¥)
  - ğŸ’¡ ì—¬ê¸°ì„œ íƒ€ì… ì´ë¦„ íŒ¨í„´ì´ë¼ í•œ ì´ìœ ëŠ”, í´ë˜ìŠ¤ / ì¸í„°í˜ì´ìŠ¤ ëª¨ë‘ ì ìš©ë¨

  - @Around("allOrder() && allService()")
    + í¬ì¸íŠ¸ì»·ì€ ì¡°í•© ê°€ëŠ¥ (&&(AND), ||(OR), !(NOT) 3ê°€ì§€ ì¡°í•© ê°€ëŠ¥)
    + hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€ì´ë©´ì„œ íƒ€ì… ì´ë¦„ íŒ¨í„´ì´ *Serviceì¸ ê²ƒì„ ëŒ€ìƒìœ¼ë¡œ í•¨
    + ê²°ê³¼ì ìœ¼ë¡œ doTransaction() ì–´ë“œë°”ì´ìŠ¤ëŠ” OrderServiceì—ë§Œ ì ìš©
    + doLog() ì–´ë“œë°”ì´ìŠ¤ëŠ” OrderService, OrderRepositoryì— ëª¨ë‘ ì ìš©

4. í¬ì¸íŠ¸ì»·ì´ ì ìš©ëœ AOP ê²°ê³¼
   - orderService : doLog(), doTransaction() ì–´ë“œë°”ì´ìŠ¤ ì ìš©
   - orderRepository : doLog() ì–´ë“œë°”ì´ìŠ¤ ì ìš©

5. AopTest ìˆ˜ì •
```java
@Slf4j
@SpringBootTest
// @Import(AspectV1.class)
// @Import(AspectV2.class)
@Import(AspectV3.class)
public class AopTest {

    ...

}
```
  - @Import(AspectV2.class) ì£¼ì„ ì²˜ë¦¬
  - @Import(AspectV3.class) ì¶”ê°€
  - ì‹¤í–‰
```java
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderService = true
[aop] [    Test worker] hello.aop.AopTest                        : isAopProxy, orderRepository = true
```
  - ì‹¤í–‰ - success()
```
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [íŠ¸ëœì­ì…˜ ì‹œì‘] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [íŠ¸ëœì­ì…˜ ì»¤ë°‹] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] void hello.aop.order.OrderService.orderItem(String)
```
<div align="center">
<img src="https://github.com/user-attachments/assets/09ec6c69-6fb0-46f6-a4a1-8f6d17710eaa">
</div>

6. ì§„í–‰ ìˆœì„œ ë¶„ì„
   - AOP ì ìš© ì „ : í´ë¼ì´ì–¸íŠ¸ â†’ orderService.orderItem() â†’ orderRepository.save()
   - AOP ì ìš© í›„ : í´ë¼ì´ì–¸íŠ¸ â†’ [doLog() â†’ doTransaction()] â†’ orderService.orderItem() â†’ [doLog()] â†’ orderRepository.save()
   - orderServiceì—ëŠ” doLog(), doTransaction() ë‘ ê°€ì§€ ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©, orderRepositoryì—ëŠ” doLog() í•˜ë‚˜ì˜ ì–´ë“œë°”ì´ìŠ¤ë§Œ ì ìš©

7. ì‹¤í–‰ - exception()
```
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [íŠ¸ëœì­ì…˜ ì‹œì‘] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [íŠ¸ëœì­ì…˜ ë¡¤ë°±] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV3             : [ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] void hello.aop.order.OrderService.orderItem(String)
```
  - ì˜ˆì™¸ ìƒí™©ì—ì„œëŠ” íŠ¸ëœì­ì…˜ ì»¤ë°‹ ëŒ€ì‹  íŠ¸ëœì­ì…˜ ë¡¤ë°± í˜¸ì¶œ

8. ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìˆœì„œê°€ [doLog() â†’ doTransaction()] ìˆœì„œë¡œ ì‘ë™
   - ë§Œì•½ ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ë˜ëŠ” ìˆœì„œë¥¼ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´?
   - ì˜ˆë¥¼ ë“¤ì–´, ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•´ì•¼ í•˜ëŠ”ë°, íŠ¸ëœì­ì…˜ê³¼ ê´€ë ¨ëœ ì‹œê°„ì„ ì œì™¸í•˜ê³  ì‹¶ë‹¤ë©´, [doTransaction() â†’ doLog()] ì´ë ‡ê²Œ íŠ¸ëœì­ì…˜ ì´í›„ ë¡œê·¸ë¥¼ ë‚¨ê²¨ì•¼ í•¨

-----
### ìŠ¤í”„ë§ AOP êµ¬í˜„4 - í¬ì¸íŠ¸ì»· ì°¸ì¡°
-----
1. í¬ì¸íŠ¸ì»·ì„ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì™¸ë¶€ í´ë˜ìŠ¤ì— ëª¨ì•„ë‘ì–´ë„ ë¨
2. ì°¸ê³ ë¡œ, ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ë•ŒëŠ” í¬ì¸íŠ¸ì»·ì˜ ì ‘ê·¼ ì œì–´ìë¥¼ publicìœ¼ë¡œ ì—´ì–´ë‘¬ì•¼ í•¨
3. Pointcuts
```java
package hello.aop.order.aop;

import org.aspectj.lang.annotation.Pointcut;

public class Pointcuts {

    // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€
    @Pointcut("execution(* hello.aop.order..*(..))") // Pointcut Expression
    public void allOrder() {} // Pointcut Signature

    // í´ë˜ìŠ¤ ì´ë¦„ íŒ¨í„´ì´ *Service
    @Pointcut("execution(* *..*Service.*(..))")
    public void allService() {}

    // allOrder && allService
    @Pointcut("allOrder() && allService()")
    public void orderAndService() {}
}
```
   - orderAndService() : allOrder() í¬ì¸íŠ¸ì»·ê³¼ allService() í¬ì¸íŠ¸ì»·ì„ ì¡°í•©í•´ ìƒˆë¡œìš´ í¬ì¸íŠ¸ì»·ì„ ë§Œë“¬

4. AspectV4Pointcut
```java
package hello.aop.order.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;

@Slf4j
@Aspect
public class AspectV4Pointcut {

    @Around("hello.aop.order.aop.Pointcuts.allOrder()")
    public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
        log.info("[log] {}", joinPoint.getSignature()); // Join Point ì‹œê·¸ë‹ˆì³
        return joinPoint.proceed();
    }

    // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€ ì´ë©´ì„œ í´ë˜ìŠ¤ ì´ë¦„ íŒ¨í„´ì´ *Service
    @Around("hello.aop.order.aop.Pointcuts.orderAndService()")
    public Object doTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
        try {
            log.info("[íŠ¸ëœì­ì…˜ ì‹œì‘] {}", joinPoint.getSignature());
            Object result = joinPoint.proceed();
            log.info("[íŠ¸ëœì­ì…˜ ì»¤ë°‹] {}", joinPoint.getSignature());
            return result;
        } catch (Exception e) {
            log.info("[íŠ¸ëœì­ì…˜ ë¡¤ë°±] {}", joinPoint.getSignature());
            throw e;
        } finally {
            log.info("[ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] {}", joinPoint.getSignature());
        }
    }
}
```
   - ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ í´ë˜ìŠ¤ ì´ë¦„ê³¼ í¬ì¸íŠ¸ì»· ì‹œê·¸ë‹ˆì²˜ë¥¼ ëª¨ë‘ ì§€ì •
   - í¬ì¸íŠ¸ì»·ì„ ì—¬ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ íš¨ê³¼ì 

5. AopTest - ìˆ˜ì •
```java
@Slf4j
@SpringBootTest
// @Import(AspectV1.class)
// @Import(AspectV2.class)
// @Import(AspectV3.class)
@Import(AspectV4Pointcut.class)
public class AopTest {

        ...

}
```
   - @Import(AspectV3.class) ì£¼ì„ ì²˜ë¦¬
   - @Import(AspectV4Pointcut.class) ì¶”ê°€

-----
### ìŠ¤í”„ë§ AOP êµ¬í˜„5 - ì–´ë“œë°”ì´ìŠ¤ ìˆœì„œ
-----
1. ì–´ë“œë°”ì´ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìˆœì„œë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŒ
2. ğŸ’¡ ìˆœì„œë¥¼ ì§€ì •í•˜ê³  ì‹¶ìœ¼ë©´ @Aspect ì ìš© ë‹¨ìœ„ë¡œ org.springframework.core.annotation.@Order ì• ë„ˆí…Œì´ì…˜ ì ìš©
   - ğŸ’¡ ë¬¸ì œëŠ” ì–´ë“œë°”ì´ìŠ¤ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ ì ìš©í•  ìˆ˜ ìˆìŒ
   - ğŸ’¡ ë”°ë¼ì„œ, í•˜ë‚˜ì˜ ì—ìŠ¤í™íŠ¸ì— ì—¬ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ê°€ ìˆë‹¤ë©´, ìˆœì„œë¥¼ ë³´ì¥ ë°›ì„ ìˆ˜ ì—†ìŒ
3. ğŸ’¡ ë”°ë¼ì„œ, ì—ìŠ¤í™íŠ¸ë¥¼ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•´ì•¼ í•¨
4. í˜„ì¬ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìˆœì„œ : [doLog() â†’ doTransaction()]ì´ ìˆœì„œë¡œ ë‚¨ìŒ (JVMì´ë‚˜ ì‹¤í–‰ í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
   - ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìˆœì„œë¥¼ ë°”ê¾¸ì–´ì„œ [doTransaction() â†’ doLog()] íŠ¸ëœì­ì…˜ì´ ë¨¼ì € ì²˜ë¦¬ë˜ê³ , ì´í›„ ë¡œê·¸ê°€ ë‚¨ê¸°ë„ë¡ ë³€ê²½

7. AspectV5Order
```java
package hello.aop.order.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.springframework.core.annotation.Order;

@Slf4j
@Aspect
public class AspectV5Order {

    @Aspect
    @Order(2)
    public static class LogAspect {
        @Around("hello.aop.order.aop.Pointcuts.allOrder()")
        public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
            log.info("[log] {}", joinPoint.getSignature()); // Join Point ì‹œê·¸ë‹ˆì³
            return joinPoint.proceed();
        }
    }

    @Aspect
    @Order(1)
    public static class TxAspect {
        // hello.aop.order íŒ¨í‚¤ì§€ì™€ í•˜ìœ„ íŒ¨í‚¤ì§€ ì´ë©´ì„œ í´ë˜ìŠ¤ ì´ë¦„ íŒ¨í„´ì´ *Service
        @Around("hello.aop.order.aop.Pointcuts.orderAndService()")
        public Object doTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
            try {
                log.info("[íŠ¸ëœì­ì…˜ ì‹œì‘] {}", joinPoint.getSignature());
                Object result = joinPoint.proceed();
                log.info("[íŠ¸ëœì­ì…˜ ì»¤ë°‹] {}", joinPoint.getSignature());
                return result;
            } catch (Exception e) {
                log.info("[íŠ¸ëœì­ì…˜ ë¡¤ë°±] {}", joinPoint.getSignature());
                throw e;
            } finally {
                log.info("[ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] {}", joinPoint.getSignature());
            }
        }
    }
}
```
   - í•˜ë‚˜ì˜ ì—ìŠ¤í™íŠ¸ ì•ˆì— ìˆë˜ ì–´ë“œë°”ì´ìŠ¤ë¥¼ LogAspect, TxAspect ì—ìŠ¤í™íŠ¸ë¡œ ê°ê° ë¶„ë¦¬
   - ê° ì—ìŠ¤í™íŠ¸ì— @Order ì• ë„ˆí…Œì´ì…˜ì„ í†µí•´ ì‹¤í–‰ ìˆœì„œ ì ìš©
   - ì°¸ê³ ë¡œ, ìˆ«ìê°€ ì‘ì„ ìˆ˜ë¡ ë¨¼ì € ì‹¤í–‰

8. AopTest - ë³€ê²½
```java
@Slf4j
@SpringBootTest
// @Import(AspectV1.class)
// @Import(AspectV2.class)
// @Import(AspectV3.class)
// @Import(AspectV4Pointcut.class)
@Import({AspectV5Order.LogAspect.class, AspectV5Order.TxAspect.class})
public class AopTest {

    ...

}
```
   - @Import(AspectV4Pointcut.class) ì£¼ì„ ì²˜ë¦¬
   - @Import({AspectV5Order.LogAspect.class, AspectV5Order.TxAspect.class}) ì¶”ê°€

9. ì‹¤í–‰
```
[aop] [    Test worker] hello.aop.order.aop.AspectV5Order        : [íŠ¸ëœì­ì…˜ ì‹œì‘] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV5Order        : [log] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.OrderService             : [orderService] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV5Order        : [log] String hello.aop.order.OrderRepository.save(String)
[aop] [    Test worker] hello.aop.order.OrderRepository          : [orderRepository] ì‹¤í–‰
[aop] [    Test worker] hello.aop.order.aop.AspectV5Order        : [íŠ¸ëœì­ì…˜ ì»¤ë°‹] void hello.aop.order.OrderService.orderItem(String)
[aop] [    Test worker] hello.aop.order.aop.AspectV5Order        : [ë¦¬ì†ŒìŠ¤ ë¦´ë¦¬ì¦ˆ] void hello.aop.order.OrderService.orderItem(String)
```
<div align="center">
<img src="https://github.com/user-attachments/assets/142d8b39-a2f4-42e5-8e36-92f0ddc8efa2">
</div>
