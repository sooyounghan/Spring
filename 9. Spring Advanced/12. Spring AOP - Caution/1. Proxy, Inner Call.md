-----
### í”„ë¡ì‹œì™€ ë‚´ë¶€ í˜¸ì¶œ - ë¬¸ì œ
-----
1. ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ ë°©ì‹ì˜ AOPë¥¼ ì‚¬ìš©
   - ë”°ë¼ì„œ, AOPë¥¼ ì ìš©í•˜ë ¤ë©´ í•­ìƒ í”„ë¡ì‹œë¥¼ í†µí•´ì„œ ëŒ€ìƒ ê°ì²´(target)ì„ í˜¸ì¶œí•´ì•¼ í•¨
   - ì´ë ‡ê²Œ í•´ì•¼ í”„ë¡ì‹œì—ì„œ ë¨¼ì € ì–´ë“œë°”ì´ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³ , ì´í›„ ëŒ€ìƒ ê°ì²´ë¥¼ í˜¸ì¶œ
   - ë§Œì•½, í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³ , ëŒ€ìƒ ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ê²Œ ë˜ë©´, AOPê°€ ì ìš©ë˜ì§€ ì•Šê³ , ì–´ë“œë°”ì´ìŠ¤ë„ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

2. AOPë¥¼ ì ìš©í•˜ë©´ ëŒ€ìƒ ê°ì²´ì— ëŒ€ì‹ ì— í”„ë¡ì‹œë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
   - ë”°ë¼ì„œ, ìŠ¤í”„ë§ì€ ì˜ì¡´ê´€ê³„ ì£¼ì… ì‹œ í•­ìƒ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì£¼ì…
   - í”„ë¡ì‹œ ê°ì²´ê°€ ì£¼ì…ë˜ê¸° ë•Œë¬¸ì—, ëŒ€ìƒ ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë¬¸ì œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë°œìƒí•˜ì§€ ì•ŠìŒ
   - ğŸ’¡ í•˜ì§€ë§Œ, ëŒ€ìƒ ê°ì²´ì˜ ë‚´ë¶€ì—ì„œ ë©”ì„œë“œ í˜¸ì¶œì´ ë°œìƒí•˜ë©´, í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ëŒ€ìƒ ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë¬¸ì œ ë°œìƒ

3. ë‚´ë¶€ í˜¸ì¶œì´ ë°œìƒí•˜ëŠ” ì˜ˆì œ
   - CallServiceV0
```java
package hello.aop.exam.internalcall;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class CallServiceV0 {
    public void external() {
        log.info("call external");
        internal(); // ë‚´ë¶€ ë©”ì„¸ì§€ í˜¸ì¶œ (this.internal())
    }
    
    public void internal() {
        log.info("call internal");
    }
}
```
  - CallServiceV0.external()ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œ internal()ì´ë¼ëŠ” ìê¸° ìì‹ ì˜ ë©”ì„œë“œ í˜¸ì¶œ
  - ìë°” ì–¸ì–´ì—ì„œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ, ëŒ€ìƒì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•ì— ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëœ»í•˜ëŠ” thisê°€ ë¶™ìŒ
  - ì—¬ê¸°ì„œëŠ” this.internal()ë¡œ ì´í•´
  
  - CallLogAspect : CallServiceV0ì— AOPë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ Aspect
```java
package hello.aop.internalcall.aop;

import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;

@Slf4j
@Aspect
public class CallLogAspect {
    @Before("execution(* hello.aop.internalcall..*.*(..))")
    public void doLog(JoinPoint joinPoint) {
        log.info("aop = {}", joinPoint.getSignature());
    }
}

```

  - CallServiceV0Test
```java
package hello.aop.internalcall;

import hello.aop.internalcall.aop.CallLogAspect;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import static org.junit.jupiter.api.Assertions.*;

@Slf4j
@Import(CallLogAspect.class)
@SpringBootTest
class CallServiceV0Test {

    @Autowired CallServiceV0 callServiceV0;

    @Test
    void external() {
        callServiceV0.external();
    }

    @Test
    void internal() {
        callServiceV0.internal();
    }
}
```
  - @Import(CallLogAspect.class) : Aspectë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
    + ë”°ë¼ì„œ, CallServiceV0ì— AOP í”„ë¡ì‹œë¥¼ ì ìš©
  - @SpringBootTest : ë‚´ë¶€ì— ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” í¬í•¨
    + ë”°ë¼ì„œ, CallServiceV0ì— @Componentê°€ ë¶™ì–´ìˆìœ¼ë¯€ë¡œ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡ ëŒ€ìƒ
  - callServiceV0.external()
```
// í”„ë¡ì‹œ í˜¸ì¶œ
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV0.external()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV0     : call external
[aop] [    Test worker] hello.aop.internalcall.CallServiceV0     : call internal
```

<div align="center">
<img src="https://github.com/user-attachments/assets/54e93357-cf61-49e4-a73a-0949206ee750">
</div>

  - ì‹¤ì œ ì‹¤í–‰í•´ë³´ë©´ callServiceV0.external()ì„ ì‹¤í–‰í•  ë•ŒëŠ” í”„ë¡ì‹œ í˜¸ì¶œ
  - ë”°ë¼ì„œ, CallLogAspect ì–´ë“œë°”ì´ìŠ¤ê°€ í˜¸ì¶œëœ ê²ƒ í™•ì¸ ê°€ëŠ¥
  - ê·¸ë¦¬ê³  AOP ProxyëŠ” target.external()ì„ í˜¸ì¶œ
  - ğŸ’¡ í•˜ì§€ë§Œ ë¬¸ì œëŠ” ì—¬ê¸°ì„œ, callServiceV0.external() ì•ˆì—ì„œ internal()ì„ í˜¸ì¶œí•  ë•Œ ë°œìƒ
    + ğŸ’¡ ì´ ë•ŒëŠ”, CallLogAsepct ì–´ë“œë°”ì´ìŠ¤ê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
  - ìë°” ì–¸ì–´ì—ì„œ ë©”ì„œë“œ ì•ì— ë³„ë„ ì°¸ì¡°ê°€ ì—†ìœ¼ë©´ thisë¼ëŠ” ëœ»ìœ¼ë¡œ ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ë¦¬í‚´
    + ğŸ’¡ğŸ’¡ğŸ’¡ ê²°ê³¼ì ìœ¼ë¡œ ìê¸° ìì‹ ì˜ ë‚´ë¶€ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” this.internal()ì´ ë˜ëŠ”ë°, ì—¬ê¸°ì„œëŠ” thisëŠ” ì‹¤ì œ ëŒ€ìƒ ê°ì²´(target)ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëœ»í•¨
    + ğŸ’¡ ê²°ê³¼ì ìœ¼ë¡œ ì´ëŸ¬í•œ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•ŠìŒ
    + ğŸ’¡ ë”°ë¼ì„œ, ì–´ë“œë°”ì´ìŠ¤ë„ ì ìš©í•  ìˆ˜ ì—†ìŒ

  - callServiceV0.internal()
```
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV0.internal()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV0     : call internal
```
<div align="center">
<img src="https://github.com/user-attachments/assets/404e0b68-3e5a-4999-ab6a-34a2e592028e">
</div>

  - ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ìš° í”„ë¡ì‹œë¥¼ ê±°ì¹˜ê¸° ë•Œë¬¸ì— internal()ë„ CallLogAspect ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥

4. ğŸ’¡ ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ ë°©ì‹ì˜ AOP ì‚¬ìš© : ë©”ì„œë“œ ë‚´ë¶€ í˜¸ì¶œì— í”„ë¡ì‹œë¥¼ ì ìš©í•  ìˆ˜ ì—†ìŒ
5. ì°¸ê³ 
   - ì‹¤ì œ ì½”ë“œì— AOPë¥¼ ì ìš©í•˜ëŠ” AspectJë¥¼ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ
   - í”„ë¡ì‹œë¥¼ í†µí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•´ë‹¹ ì½”ë“œì— ì§ì ‘ AOP ì ìš© ì½”ë“œê°€ ë¶™ì–´ìˆê¸° ë•Œë¬¸ì—, ë‚´ë¶€ í˜¸ì¶œê³¼ ë¬´ê´€í•˜ê²Œ AOPë¥¼ ì ìš© ê°€ëŠ¥
   - í•˜ì§€ë§Œ, ë¡œë“œ íƒ€ì„ ìœ„ë¹™ ë“±ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë°, ì„¤ì •ì´ ë³µì¡í•˜ê³  JVM ì˜µì…˜ì„ ì£¼ì–´ì•¼ í•˜ëŠ” ë¶€ë‹´ ì¡´ì¬
   - í”„ë¡ì‹œ ë°©ì‹ì˜ AOPì—ì„œ ë‚´ë¶€ í˜¸ì¶œì— ëŒ€ì‘í•  ìˆ˜ ìˆëŠ” ëŒ€ì•ˆ ì¡´ì¬
   - ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ AspectJë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì‹¤ë¬´ì—ì„œ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
   - ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í•¨ê»˜ ì§ì ‘ AspectJë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• : https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-using-aspectj

-----
### í”„ë¡ì‹œì™€ ë‚´ë¶€ í˜¸ì¶œ - ëŒ€ì•ˆ 1 : ìê¸° ìì‹  ì£¼ì…
-----
1. ë‚´ë¶€ í˜¸ì¶œì„ í•´ê²°í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²• : ìê¸° ìì‹ ì„ ì˜ì¡´ ê´€ê³„ ì£¼ì… ë°›ëŠ” ê²ƒ
2. CallServiceV1
```java
package hello.aop.internalcall;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class CallServiceV1 {

    private CallServiceV1 callServiceV1; // ìê¸° ìì‹ ì„ ê°€ì§


    /**
     * ì°¸ê³  : ìƒì„±ì ì£¼ì…ì€ ìˆœí™˜ ì‚¬ì´í´ì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— ì‹¤íŒ¨
     */
    /*
    @Autowired
    public CallServiceV1(CallServiceV1 callServiceV1) {
        this.callServiceV1 = callServiceV1;
    }
    */

    /**
     * Setter ì£¼ì…
     */
    @Autowired
    public void setCallServiceV1(CallServiceV1 callServiceV1) {
        // ìˆ˜ì •ì ì£¼ì… ì‹œì ì—ì„œ callServiceV1ì€ í”„ë¡ì‹œ ì£¼ì…
        this.callServiceV1 = callServiceV1; 
    }

    public void external() {
        log.info("call external");
        callServiceV1.internal(); // ì™¸ë¶€ ë©”ì„œë“œ í˜¸ì¶œ
    }

    public void internal() {
        log.info("call internal");
    }
}
```
  - callServiceV1ë¥¼ ìˆ˜ì •ìë¥¼ í†µí•´ì„œ ì£¼ì…
    + ğŸ’¡ ìŠ¤í”„ë§ì—ì„œ AOPê°€ ì ìš©ëœ ëŒ€ìƒì„ ì˜ì¡´ ê´€ê³„ ì£¼ì…ì„ ë°›ìœ¼ë©´ ì£¼ì… ë°›ì€ ëŒ€ìƒì€ ì‹¤ì œ ìì‹ ì´ ì•„ë‹ˆë¼ í”„ë¡ì‹œ
  - external()ì„ í˜¸ì¶œí•˜ë©´ callServiceV1.internal()ë¥¼ í˜¸ì¶œ
    + ì£¼ì…ë°›ì€ callServiceV1ì€ í”„ë¡ì‹œì´ë©°, ë”°ë¼ì„œ í”„ë¡ì‹œë¥¼ í†µí•´ AOP í˜¸ì¶œ ì ìš© ê°€ëŠ¥
  - ğŸ’¡ ì°¸ê³ ë¡œ, ì´ ê²½ìš° ìƒì„±ì ì£¼ì… ì‹œ ì˜¤ë¥˜ ë°œìƒ
    + ğŸ’¡ ë³¸ì¸ì„ ìƒì„±í•˜ë©´ì„œ ì£¼ì…í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ìˆœí™˜ ì‚¬ì´í´ì´ ë§Œë“¤ì–´ì§
    + ğŸ’¡ ë°˜ë©´ì—, ìˆ˜ì •ì ì£¼ì…ì€ ìŠ¤í”„ë§ì´ ìƒì„±ëœ ì´í›„ ì£¼ì…í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ ë°œì…í•˜ì§€ ì•ŠìŒ

3. CallServiceV1Test
```java
package hello.aop.internalcall;

import hello.aop.internalcall.aop.CallLogAspect;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

@Slf4j
@Import(CallLogAspect.class)
// ìˆœí™˜ ì°¸ì¡°ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤í”„ë§ 2.6ë¶€í„° ê¸ˆì§€ (í•´ê²° ë°©ë²•)
@SpringBootTest(properties = "spring.main.allow-circular-references=true")
class CallServiceV1Test {

    @Autowired CallServiceV1 callServiceV1;

    @Test
    void external() {
        callServiceV1.external();
    }

    @Test
    void internal() {
        callServiceV1.internal();
    }
}
```
  - ì‹¤í–‰ ë¡œê·¸
```
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV1.external()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV1     : call external
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV1.internal()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV1     : call internal

[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV1.internal()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV1     : call internal
```
<div align="center">
<img src="https://github.com/user-attachments/assets/5315f1a1-b039-4760-8fd3-3f4732021a02">
</div>

  - ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ internal()ì„ í˜¸ì¶œí•  ë•Œ ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ í˜¸ì¶œí•˜ëŠ” ê²ƒ í™•ì¸ ê°€ëŠ¥
  - AOPë„ ì˜ ì ìš©

4. ì£¼ì˜
   - ìŠ¤í”„ë§ 2.6ë¶€í„°ëŠ” ìˆœí™˜ ì°¸ì¡°ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ê¸ˆì§€
   - ë”°ë¼ì„œ ìŠ¤í”„ë§ ë¶€íŠ¸ 2.6 ì´ìƒ ë²„ì „ì— ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ ë©”ì„¸ì§€ë¡œ ì •ìƒ ì‹¤í–‰ ì œí•œ
```
Error creating bean with name 'callServiceV1': Requested bean is currently in creation: Is there an unresolvable circular reference?
```

  - ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ application.propertiesì— ë‹¤ìŒ ì¶”ê°€
```properties
spring.main.allow-circular-references=true
```

-----
### í”„ë¡ì‹œì™€ ë‚´ë¶€ í˜¸ì¶œ - ëŒ€ì•ˆ 2 : ì§€ì—° ì¡°íšŒ
-----
1. ì•ì„œ ìƒì„±ì ì£¼ì…ì´ ì‹¤íŒ¨í•˜ëŠ” ì´ìœ ëŠ” ìê¸° ìì‹ ì„ ìƒì„±í•˜ë©´ì„œ ì£¼ì…í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì„
2. ì´ ê²½ìš°, ìˆ˜ì •ì ì£¼ì…ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ì§€ì—° ì¡°íšŒë¥¼ ì‚¬ìš©
3. ğŸ’¡ ìŠ¤í”„ë§ ë¹ˆì„ ì§€ì—°í•´ì„œ ì¡°íšŒ : ObjectProvider(Provider), ApplicationContextë¥¼ ì‚¬ìš©
4. CallServiceV2
   - ApplicationContext
```java
package hello.aop.internalcall;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class CallServiceV2 {

    private ApplicationContext applicationContext;

    public CallServiceV2(ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
    }

    public void external() {
        log.info("call external");
        CallServiceV2 callServiceV2 = applicationContext.getBean(CallServiceV2.class);
        callServiceV2.internal(); // ì™¸ë¶€ ë©”ì„œë“œ í˜¸ì¶œ
    }

    public void internal() {
        log.info("call internal");
    }
}
```
  - ApplicationContextëŠ” ë„ˆë¬´ ë§ì€ ê¸°ëŠ¥ ì œê³µ
  - ObjectProvider ì‚¬ìš©
```java
package hello.aop.internalcall;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class CallServiceV2 {

    // private ApplicationContext applicationContext;
    private ObjectProvider<CallServiceV2> callServiceProvider;
    
    /*
    public CallServiceV2(ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
    }
    */

    public CallServiceV2(ObjectProvider<CallServiceV2> callServiceProvider) {
        this.callServiceProvider = callServiceProvider;
    }

    public void external() {
        log.info("call external");
        // CallServiceV2 callServiceV2 = applicationContext.getBean(CallServiceV2.class);
        CallServiceV2 callServiceV2 = callServiceProvider.getObject();
        callServiceV2.internal(); // ì™¸ë¶€ ë©”ì„œë“œ í˜¸ì¶œ
    }

    public void internal() {
        log.info("call internal");
    }
}
```
  - ğŸ’¡ ObjectProviderëŠ” ê°ì²´ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì¡°íšŒí•˜ëŠ” ê²ƒì„ ìŠ¤í”„ë§ ë¹ˆ ìƒì„± ì‹œì ì´ ì•„ë‹ˆë¼ ì‹¤ì œ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œì ìœ¼ë¡œ ì§€ì—°
  - callServiceProvider.getObject()ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆì„ ì¡°íšŒ
  - ì—¬ê¸°ì„œëŠ” ìê¸° ìì‹ ì„ ì£¼ì… ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ ìˆœí™˜ ì‚¬ì´í´ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ

5. CallServiceV2Test
```java
package hello.aop.internalcall;

import hello.aop.internalcall.aop.CallLogAspect;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import static org.junit.jupiter.api.Assertions.*;

@Slf4j
@Import(CallLogAspect.class)
@SpringBootTest
class CallServiceV2Test {

    @Autowired CallServiceV2 callServiceV2;

    @Test
    void external() {
        callServiceV2.external();
    }

    @Test
    void internal() {
        callServiceV2.internal();
    }
}
```
```
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV2.external()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV2     : call external
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV2.internal()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV2     : call internal

[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV2.internal()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV2     : call internal
```

-----
### í”„ë¡ì‹œì™€ ë‚´ë¶€ í˜¸ì¶œ - ëŒ€ì•ˆ 3 : êµ¬ì¡° ë³€ê²½
-----
1. ê°€ì¥ ë‚˜ì€ ëŒ€ì•ˆ : ë‚´ë¶€ í˜¸ì¶œì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ êµ¬ì¡°ë¥¼ ë³€ê²½ (ì‹¤ì œ ì´ ë°©ë²• ê¶Œì¥)
2. CallServiceV3
```java
package hello.aop.internalcall;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.stereotype.Component;

/**
 * êµ¬ì¡° ë³€ê²½ (ë¶„ë¦¬)
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class CallServiceV3 {

    private final InternalService internalService;
    
    public void external() {
        log.info("call external");
        internalService.internal(); // ì™¸ë¶€ í´ë˜ìŠ¤ì˜ ì™¸ë¶€ ë©”ì„œë“œ í˜¸ì¶œ
    }

}
```
  - ë‚´ë¶€ í˜¸ì¶œì„ InternalServiceë¼ëŠ” ë³„ë„ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬

3. InternalService
```java
package hello.aop.internalcall;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class InternalService {
    public void internal() {
        log.info("call internal");
    }
}
```

4. CallServiceV3Test
```java
package hello.aop.internalcall;

import hello.aop.internalcall.aop.CallLogAspect;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

@Slf4j
@Import(CallLogAspect.class)
@SpringBootTest
class CallServiceV3Test {

    @Autowired CallServiceV3 callServiceV3;

    @Test
    void external() {
        callServiceV3.external();
    }
    
}
```
```
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.CallServiceV3.external()
[aop] [    Test worker] hello.aop.internalcall.CallServiceV3     : call external
[aop] [    Test worker] h.aop.internalcall.aop.CallLogAspect     : aop = void hello.aop.internalcall.InternalService.internal()
[aop] [    Test worker] hello.aop.internalcall.InternalService   : call internal
```
<div align="center">
<img src="https://github.com/user-attachments/assets/e2f1f2b4-b75e-4158-a55a-7f0264d7563e">
</div>

  - ë‚´ë¶€ í˜¸ì¶œ ìì²´ê°€ ì‚¬ë¼ì§€ê³ , callService â†’ internalServiceë¥¼ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ë¡œ ë³€ê²½
  - ë•ë¶„ì— ìì—°ìŠ¤ëŸ½ê²Œ AOPê°€ ì ìš©
  - ğŸ’¡ ì—¬ê¸°ì„œ êµ¬ì¡°ë¥¼ ë³€ê²½í•œë‹¤ëŠ” ê²ƒ : ë‹¨ìˆœíˆ ë¶„ë¦¬í•˜ëŠ” ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ë°©ë²• ì¡´ì¬
    + ì˜ˆ) í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‘˜ ë‹¤ í˜¸ì¶œ
      * í´ë¼ì´ì–¸íŠ¸ â†’ external()
      * í´ë¼ì´ì–¸íŠ¸ â†’ internal()
    + ë¬¼ë¡ , ì´ê²½ìš° external()ì—ì„œ internal()ì„ ë‚´ë¶€ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ ì½”ë“œ ë³€ê²½
    + ê·¸ë¦¬ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ external(), internal()ì„ ëª¨ë‘ í˜¸ì¶œí•˜ë„ë¡ êµ¬ì¡° ë³€ê²½ (ê°€ëŠ¥í•œ ê²½ìš°ì— í•œí•´ì„œ)

5. ì°¸ê³ 
   - AOPëŠ” ì£¼ë¡œ íŠ¸ëœì­ì…˜ ì ìš©ì´ë‚˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ì˜ ë¡œê·¸ ì¶œë ¥ ê¸°ëŠ¥ì—ì„œ ì‚¬ìš©
   - ğŸ’¡ ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ, ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œê°€ ë‚˜ì˜¬ ì •ë„ì˜ ê·œëª¨ì— AOPë¥¼ ì ìš©í•˜ëŠ” ê²ƒì´ ì ë‹¹
     + ğŸ’¡ AOPëŠ” publicë©”ì„œë“œì—ë§Œ ì ìš©
     + ğŸ’¡ private ë©”ì„œë“œì²˜ëŸ¼ ì‘ì€ ë‹¨ìœ„ëŠ” AOPë¥¼ ì ìš©í•˜ì§€ ì•ŠìŒ
   - AOP ì ìš©ì„ ìœ„í•´ private ë©”ì„œë“œë¥¼ ì™¸ë¶€ í´ë˜ìŠ¤ë¡œ ë³€ê²½í•˜ê³  publicìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ì¼ì€ ê±°ì˜ ì—†ìŒ
   - ğŸ’¡ ê·¸ëŸ¬ë‚˜, ìœ„ ì˜ˆì œ ê°™ì´ public ë©”ì„œë“œì—ì„œ public ë©”ì„œë“œë¥¼ ë‚´ë¶€ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ” ë¬¸ì œ ë°œìƒ
  
