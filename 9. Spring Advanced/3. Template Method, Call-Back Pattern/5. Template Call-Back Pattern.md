-----
### ì½œë°± (Callback)
-----
1. ContextV2ëŠ” ë³€í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ ì—­í• ì„ í•¨
2. ê·¸ë¦¬ê³  ë³€í•˜ëŠ” ë¶€ë¶„ì€ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ Strategyì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì„œ ì²˜ë¦¬
3. ğŸ’¡ ì´ì²˜ëŸ¼ ë‹¤ë¥¸ ì½”ë“œì˜ ì¸ìˆ˜ë¡œì„œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì½œë°±(Callback)ì´ë¼ í•¨
4. ğŸ’¡ ì½œë°±
   - í”„ë¡œê·¸ë˜ë°ì—ì„œ ì½œë°±(Callback) ë˜ëŠ” ì½œì• í”„í„° í•¨ìˆ˜(Call-After Function)ëŠ” ë‹¤ë¥¸ ì½”ë“œì˜ ì¸ìˆ˜ë¡œì„œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œ
   - ì½œë°±ì„ ë„˜ê²¨ë°›ëŠ” ì½”ë“œëŠ” ì´ ì½œë°±ì„ í•„ìš”ì— ë”°ë¼ ì¦‰ì‹œ ì‹¤í–‰í•  ìˆ˜ ìˆê³ , ì•„ë‹ˆë©´ ë‚˜ì¤‘ì— ì‹¤í–‰í•  ìˆ˜ ìˆìŒ

5. ğŸ’¡ ì¦‰, ì‰½ê²Œ ë§í•´ ì½œë°±ì€ ì½”ë“œê°€ í˜¸ì¶œ(call)ë˜ëŠ”ë° ì½”ë“œë¥¼ ë„˜ê²¨ì¤€ ê³³ì˜ ë’¤(back)ì—ì„œ ì‹¤í–‰ëœë‹¤ëŠ” ëœ»
   - ContextV2 ì˜ˆì œì—ì„œ ì½œë°±ì€ Strategy
   - ğŸ’¡ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ Strategyë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í´ë¼ì´ì–¸íŠ¸ê°€ ContextV2.execute(...)ë¥¼ ì‹¤í–‰í•  ë•Œ, Streategyë¥¼ ë„˜ê²¨ì£¼ê³ , ContextV2 ë’¤ì—ì„œ Strategyê°€ ì‹¤í–‰

6. ğŸ’¡ ìë°” ì–¸ì–´ì—ì„œ ì½œë°±
   - ìë°” ì–¸ì–´ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì¸ìˆ˜ë¡œ ë„˜ê¸°ë ¤ë©´ ê°ì²´ê°€ í•„ìš”
   - ìë°” 8ë¶€í„°ëŠ” ëŒë‹¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
   - ìë°” 8ì´ì „ì—ëŠ” ë³´í†µ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , ì£¼ë¡œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©
   - ìµœê·¼ì—ëŠ” ì£¼ë¡œ ëŒë‹¤ ì‚¬ìš©

-----
### í…œí”Œë¦¿ ì½œë°± íŒ¨í„´
-----
1. ìŠ¤í”„ë§ì—ì„œ ContextV2ì™€ ê°™ì€ ë°©ì‹ì˜ ì „ëµ íŒ¨í„´ì„ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì´ë¼ í•¨
2. ì „ëµ íŒ¨í„´ì—ì„œ Contextê°€ í…œí”Œë¦¿ ì—­í• , Strategy ë¶€ë¶„ì´ ì½œë°±ìœ¼ë¡œ ë„˜ì–´ì˜¨ë‹¤ê³  ìƒê°í•˜ë©´ ë¨
3. ğŸ’¡ ì°¸ê³ ë¡œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì€ GOF íŒ¨í„´ì€ ì•„ë‹ˆê³ , ìŠ¤í”„ë§ ë‚´ë¶€ì—ì„œ ì´ëŸ° ë°©ì‹ì„ ìì£¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ìŠ¤í”„ë§ ì•ˆì—ì„œë§Œ ì´ë ‡ê²Œ ë¶€ë¦„
   - ğŸ’¡ ì „ëµ íŒ¨í„´ì—ì„œ í…œí”Œë¦¿ê³¼ ì½œë°± ë¶€ë¶„ì´ ê°•ì¡°ëœ íŒ¨í„´ì´ë¼ ìƒê°
4. ìŠ¤í”„ë§ì—ì„œëŠ” JdbcTemplate, RestTemplate, TransactionTemplate, RedisTemplateì²˜ëŸ¼ ë‹¤ì–‘í•¨ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ ì‚¬ìš©
   - ìŠ¤í”„ë§ì—ì„œ ì´ë¦„ì— XxxTemplateì´ ìˆë‹¤ë©´, í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ê²ƒìœ¼ë¡œ ë³´ë©´ ë¨
<div align="center">
<img src="https://github.com/user-attachments/assets/8d600443-45a4-4c15-9f43-cb74207efffe">
</div>

-----
### ì˜ˆì œ
-----
1. í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ êµ¬í˜„ (ContextV2ì™€ ë‚´ìš©ì€ ê°™ê³ , ì´ë¦„ë§Œ ë‹¤ë¦„)
   - Context â†’ Template
   - Strategy â†’ Callback

2. Callback ì¸í„°í˜ì´ìŠ¤ (í…ŒìŠ¤íŠ¸ ì½”ë“œ(src/test)ì— ìœ„ì¹˜)
```java
package hello.advanced.trace.strategy.code.template;

public interface Callback {
    void call();
}
```
  - ì½œë°± ë¡œì§ì„ ì „ë‹¬í•  ì¸í„°í˜ì´ìŠ¤

3. TimeLogTemplate (í…ŒìŠ¤íŠ¸ ì½”ë“œ(src/test)ì— ìœ„ì¹˜)
```java
package hello.advanced.trace.strategy.code.template;

import lombok.extern.slf4j.Slf4j;

@Slf4j
public class TimeLogTemplate {
    public void execute(Callback callback) {
        long startTime = System.currentTimeMillis();

        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
        callback.call();
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¢…ë£Œ

        long endTime = System.currentTimeMillis();
        long resultTime = endTime - startTime;

        log.info("resultTime = {}", resultTime);
    }
}
```

4. TemplateCallbackTest
```java
package hello.advanced.trace.strategy;

import hello.advanced.trace.strategy.code.template.Callback;
import hello.advanced.trace.strategy.code.template.TimeLogTemplate;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;

@Slf4j
public class TemplateCallbackTest {
    /**
     * í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ - ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
     */
    @Test
    void callbackV1() {
        TimeLogTemplate template = new TimeLogTemplate();
        template.execute(new Callback() {
            @Override
            public void call() {
                log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰");
            }
        });
        
        template.execute(new Callback() {
            @Override
            public void call() {
                log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰");
            }
        });
    }

    /**
     * í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ - ëŒë‹¤
     */
    @Test
    void callbackV2() {
        TimeLogTemplate template = new TimeLogTemplate();
        template.execute(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰"));
        template.execute(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰"));
    }
}
```
  - ë³„ë„ì˜ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•´ë„ ë˜ì§€ë§Œ, ì½œë°±ì„ ì‚¬ìš©í•  ê²½ìš° ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë‚˜ ëŒë‹¤ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬
  - ë¬¼ë¡  ì—¬ëŸ¬ ê³³ì—ì„œ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ì—ëŠ” ì¬ì‚¬ìš©ì„ ìœ„í•´ ì½œë°±ì„ ë³„ë„ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë„ ë¨

-----
### ì ìš©
-----
1. TraceCallback ì¸í„°í˜ì´ìŠ¤
```java
package hello.advanced.trace.callback;

public interface TraceCallback<T> {
    T call();
}
```
  - ì½œë°±ì„ ì „ë‹¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
  - ```<T>``` ì œë„¤ë¦­ì„ ì‚¬ìš© : ì½œë°±ì˜ ë°˜í™˜ íƒ€ì… ì •ì˜

2. TraceTemplate
```java
package hello.advanced.trace.callback;

import hello.advanced.trace.TraceStatus;
import hello.advanced.trace.logtrace.LogTrace;

public class TraceTemplate {
    private final LogTrace logTrace;

    public TraceTemplate(LogTrace logTrace) {
        this.logTrace = logTrace;
    }

    public <T> T execute(String message, TraceCallback<T> callback) {
    // ğŸ’¡ ì§€ë„¤ë¦­ ë©”ì„œë“œ ì œë„¤ë¦­ <T>(ë©”ì„œë“œ ë‚´ ì‘ìš©)ì™€ ë§¤ê°œë³€ìˆ˜ TraceCallback<T> callback (callbackì˜ íƒ€ì…ì´ TraceCallback<T>)ì˜ ì œë„¤ë¦­ì€ ì„œë¡œ ë‹¤ë¥¸ ì œë„¤ë¦­
        TraceStatus status = null;

        try {
            status = logTrace.begin(message);

            // ë¡œì§ í˜¸ì¶œ
            T result = callback.call();

            logTrace.end(status);
            return result;
        } catch (Exception e) {
            logTrace.exception(status, e);
            throw e;
        }
    }
}
```
  - TraceTemplateëŠ” í…œí”Œë¦¿ ì—­í• 
  - execute(...)ë¥¼ ë³´ë©´ message ë°ì´í„°ì™€ ì½œë°±ì¸ TraceCallback callbackì„ ì „ë‹¬ ë°›ìŒ
  - ```<T>``` ì œë„¤ë¦­ ì‚¬ìš© : ë°˜í™˜ íƒ€ì… ì •ì˜

3. v4 â†’ v5 ë³µì‚¬
  - hello.advanced.app.v5 íŒ¨í‚¤ì§€ ìƒì„± 
  - ë³µì‚¬
    + v4.OrderControllerV4 â†’ v5.OrderControllerV5 
    + v4.OrderServiceV4 â†’ v5.OrderServiceV5
    + v4.OrderRepositoryV4 â†’ v5.OrderRepositoryV5 

  - ì½”ë“œ ë‚´ë¶€ ì˜ì¡´ê´€ê³„ë¥¼ í´ë˜ìŠ¤ë¥¼ V5ìœ¼ë¡œ ë³€ê²½
    + OrderControllerV5 : OrderServiceV4 â†’ OrderServiceV5
    + OrderServiceV5 : OrderRepositoryV4 â†’ OrderRepositoryV5 
  
  - OrderControllerV5 ë§¤í•‘ ì •ë³´ ë³€ê²½
    + @GetMapping("/v5/request")

  - TraceTemplate ì„ ì‚¬ìš©í•˜ë„ë¡ ì½”ë“œ ë³€ê²½

6. OrderControllerV5
```java
package hello.advanced.app.v5;

import hello.advanced.trace.callback.TraceCallback;
import hello.advanced.trace.callback.TraceTemplate;
import hello.advanced.trace.logtrace.LogTrace;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class OrderControllerV5 {
    private final OrderServiceV5 orderService;
    private final TraceTemplate traceTemplate;

    public OrderControllerV5(OrderServiceV5 orderService, LogTrace trace) {
        this.orderService = orderService;
        this.traceTemplate = new TraceTemplate(trace);
    }

    @GetMapping("/v5/request")
    public String request(String itemId) {

        return traceTemplate.execute("OrderController.request()", new TraceCallback<String>() {
            @Override
            public String call() {
                orderService.orderItem(itemId);
                return "OK";
            }
        });
    }
}
```
```java
private final TraceTemplate traceTemplate;

...
// @RequiredArgsConstructor ì‚¬ìš©í•˜ì§€ ì•Šê³ , ìƒì„±ìë¡œ ì£¼ì… (í•˜ë‚˜ì´ë¯€ë¡œ @Autowired ì ìš©)
public OrderControllerV5(OrderServiceV5 orderService, LogTrace trace) {
    this.orderService = orderService;
    this.traceTemplate = new TraceTemplate(trace);
}
```
  - this.traceTemplate = new TraceTemplate(trace) : traceì˜ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ìœ¼ë©´ì„œ í•„ìš”í•œ TraceTemplate í…œí”Œë¦¿ ìƒì„±
  - ì°¸ê³ ë¡œ TraceTemplateë¥¼ ì²˜ìŒë¶€í„° ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ì£¼ì…ë°›ì•„ë„ ë¨ (ì„ íƒì ì¸ ë¶€ë¶„)
  - template.execute(..., new TraceCallback() {...}) : í…œí”Œë¦¿ì„ ì‹¤í–‰í•˜ë©´ì„œ ì½œë°± ì „ë‹¬ (ì—¬ê¸°ì„œëŠ” ì½œë°±ìœ¼ë¡œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì‚¬ìš©)
    
7. OrderServiceV5
```java
package hello.advanced.app.v5;

import hello.advanced.trace.callback.TraceTemplate;
import hello.advanced.trace.logtrace.LogTrace;
import org.springframework.stereotype.Service;

@Service
public class OrderServiceV5 {
    private final OrderRepositoryV5 orderRepository;
    private final TraceTemplate traceTemplate;

    public OrderServiceV5(OrderRepositoryV5 orderRepository, LogTrace trace) {
        this.orderRepository = orderRepository;
        this.traceTemplate = new TraceTemplate(trace);
    }

    public void orderItem(String itemId) {
        traceTemplate.execute("OrderService.orderItem()", () -> {
                orderRepository.save(itemId);
                return null;
            }
        );
    }
}
```
  - template.execute(..., new TraceCallback(){...}) : í…œí”Œë¦¿ì„ ì‹¤í–‰í•˜ë©´ì„œ ì½œë°± ì „ë‹¬. ì—¬ê¸°ì„œëŠ” ì½œë°±ìœ¼ë¡œ ëŒë‹¤ ì „ë‹¬

8. OrderRepositoryV5
```java
package hello.advanced.app.v5;

import hello.advanced.trace.callback.TraceTemplate;
import hello.advanced.trace.logtrace.LogTrace;
import org.springframework.stereotype.Repository;

@Repository
public class OrderRepositoryV5 {
    private final TraceTemplate traceTemplate;

    public OrderRepositoryV5(LogTrace trace) {
        this.traceTemplate = new TraceTemplate(trace);
    }

    public void save(String itemId) {

        traceTemplate.execute("OrderRepository.save()", () -> {
            // ì €ì¥ ë¡œì§
            if (itemId.equals("ex")) {
                throw new IllegalStateException("ì˜ˆì™¸ ë°œìƒ");
            }
            sleep(1000);
            return null;
        });
    }

    private void sleep(int millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

9. ì‹¤í–‰ ë¡œê·¸
```
[09f720d5] OrderController.request()
[09f720d5] |-->OrderService.orderItem()
[09f720d5] |   |-->OrderRepository.save()
[09f720d5] |   |<--OrderRepository.save() time = 1010ms
[09f720d5] |<--OrderService.orderItem() time = 1014ms
[09f720d5] OrderController.request() time = 1026ms
```

-----
### ì •ë¦¬
-----
1. í…œí”Œë¦¿ ë©”ì„œë“œ, ì „ëµ íŒ¨í„´, í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì§„í–‰í•˜ë©´ì„œ ë³€í•˜ëŠ” ì½”ë“œì™€ ë³€í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬
2. ìµœì¢…ì ìœ¼ë¡œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì ìš©í•˜ê³  ì½œë°±ìœ¼ë¡œ ëŒë‹¤ë¥¼ ì‚¬ìš©í•´ ì½”ë“œ ì‚¬ìš© ìµœì†Œí™”
3. í•œê³„
   - í˜„ì¬ê¹Œì§€ ë°©ì‹ì€ ì•„ë¬´ë¦¬ ìµœì í™”ë¥¼ í•´ë„ ê²°êµ­ ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ì›ë³¸ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼í•¨
   - í´ë˜ìŠ¤ê°€ ìˆ˜ë°±ê°œì´ë©´ ìˆ˜ë°±ê°œë¥¼ ë” í˜ë“¤ê²Œ ìˆ˜ì •í•˜ëŠ”ê°€, ì¡°ê¸ˆ ëœ í˜ë“¤ê²Œ ìˆ˜ì •í•˜ëŠ”ê°€ì˜ ì°¨ì´ê°€ ìˆì„ ë¿, ë³¸ì§ˆì ìœ¼ë¡œëŠ” ì½”ë“œë¥¼ ë‹¤ ìˆ˜ì •í•´ì•¼ë¨
  
