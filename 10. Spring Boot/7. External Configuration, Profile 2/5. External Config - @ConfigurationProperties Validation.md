-----
### ì™¸ë¶€ ì„¤ì • ì‚¬ìš© - @ConfigurationProperties ê²€ì¦
-----
1. @ConfigurationPropertiesë¥¼ í†µí•´ ìˆ«ìê°€ ë“¤ì–´ê°€ì•¼ í•˜ëŠ” ë¶€ë¶„ì— ë¬¸ìê°€ ì…ë ¥ë˜ëŠ” ë¬¸ì œì™€ ê°™ì€ íƒ€ì…ì´ ë§ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì…ë ¥í•˜ëŠ” ë¬¸ì œëŠ” ì˜ˆë°© ê°€ëŠ¥
2. ê·¸ëŸ°ë°, ìˆ«ìì˜ ë²”ìœ„ë¼ë˜ê°€, ë¬¸ìì˜ ê¸¸ì´ ê°™ì€ ë¶€ë¶„ì€ ê²€ì¦ì´ ì–´ë ¤ì›€
   - ì˜ˆ) ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ«ìëŠ” ìµœì†Œ 1 ~ ìµœëŒ€ 999ê¹Œì§€ë¼ëŠ” ë²”ìœ„ë¥¼ ê°€ì ¸ì•¼ í•œë‹¤ë©´ ì–´ë–»ê²Œ ê²€ì¦?
   - ì˜ˆ) ì´ë©”ì¼ì„ ì™¸ë¶€ ì„¤ì •ì— ì…ë ¥í–ˆëŠ”ë°, ë§Œì•½ ì´ë©”ì¼ í˜•ì‹ì´ ë§ì§€ ì•Šë‹¤ë©´ ì–´ë–»ê²Œ ê²€ì¦?
3. ì§ì ‘ í•˜ë‚˜í•˜ë‚˜ ê²€ì¦ ì½”ë“œë¥¼ ì‘ì„±í•´ë„ ë˜ì§€ë§Œ, ìë°”ì—ëŠ” ìë°” ë¹ˆ ê²€ì¦ê¸°(Java Bean Validation)ì´ë¼ëŠ” í›Œë¥­í•œ í‘œì¤€ ê²€ì¦ê¸° ì œê³µ
4. ğŸ’¡ @ConfigurationPropertiesëŠ” ìë°” ê°ì²´ì´ë¯€ë¡œ, ìŠ¤í”„ë§ì´ ìë°” ë¹ˆ ê²€ì¦ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›
5. ìë°” ë¹ˆ ê²€ì¦ê¸° ì‚¬ìš©ì„ ìœ„í•´ spring-boot-starter-validation í•„ìš” - build.graldeì— ì¶”ê°€
```gradle
implementation 'org.springframework.boot:spring-boot-starter-validation' // ì¶”ê°€
```

6. MyDataSourcePropertiesV3
```java
package hello.datasource;

import jakarta.validation.constraints.Max;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotEmpty;
import lombok.Getter;
import org.springframework.validation.annotation.Valided;
import org.hibernate.validator.constraints.time.DurationMax;
import org.hibernate.validator.constraints.time.DurationMin;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.context.properties.bind.DefaultValue;

import java.time.Duration;
import java.util.ArrayList;
import java.util.List;

@Getter
@ConfigurationProperties("my.datasource")
@Validated // ğŸ’¡ ìë°” ë¹ˆ ê²€ì¦ê¸°
public class MyDataSourcePropertiesV3 {

    @NotEmpty
    private String url;
    @NotEmpty
    private String username;
    @NotEmpty
    private String password;
    private Etc etc;

    public MyDataSourcePropertiesV3(String url, String username, String password, Etc etc) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.etc = etc;
    }

    @Getter
    public static class Etc {
        @Min(1)
        @Max(999)
        private int maxConnection;
        @DurationMin(seconds = 1)
        @DurationMax(seconds = 60)
        private Duration timeout;
        private List<String> options = new ArrayList<>();

        public Etc(int maxConnection, Duration timeout, List<String> options) {
            this.maxConnection = maxConnection;
            this.timeout = timeout;
            this.options = options;
        }
    }
}
```
  - ğŸ’¡ @NotEmpty private String url / username / password : í•­ìƒ ê°’ì´ ìˆì–´ì•¼ í•¨ (í•„ìˆ˜ê°’)
  - ğŸ’¡ @Min(1) @Max(999) private int maxConnection : ìµœì†Œ 1, ìµœëŒ€ 999ì˜ ê°’ í—ˆìš©
    + ğŸ’¡ jakarta.validation.constraints.Max / Min : íŒ¨í‚¤ì§€ ì´ë¦„ì— jakarta.validationìœ¼ë¡œ ì‹œì‘ : ìë°” í‘œì¤€ ê²€ì¦ê¸°ì—ì„œ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥
  - ğŸ’¡ @DurationMin(seconds = 1) @DurationMax(seconds = 60) private Duration timeout : ìµœì†Œ 1ì´ˆ, ìµœëŒ€ 60ì´ˆ í—ˆìš©
    + ğŸ’¡ org.hibernate.validator.constraints.time.DurationMax / DurationMin : íŒ¨í‚¤ì§€ ì´ë¦„ì— org.hibernate.validatorë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì€ ìë°” í‘œì¤€ ê²€ì¦ê¸°ì—ì„œ ì•„ì§ í‘œì¤€í™”ê°€ ëœ ê¸°ëŠ¥ì´ ì•„ë‹˜
    + í•˜ì´ë²„ë„¤ì´íŠ¸ ê²€ì¦ê¸°ë¼ëŠ” í‘œì¤€ ê²€ì¦ê¸°ì˜ êµ¬í˜„ì²´ì—ì„œ ì§ì ‘ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
    + ëŒ€ë¶€ë¶„ í•˜ì´ë²„ë„¤ì´íŠ¸ ê²€ì¦ê¸°ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ í¬ê²Œ ë¬¸ì œê°€ ë˜ì§€ ì•ŠìŒ

7. MyDataSourceConfigV3
```java
package hello.config;

import hello.datasource.MyDataSource;
import hello.datasource.MyDataSourcePropertiesV3;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;

@Slf4j
@EnableConfigurationProperties(MyDataSourcePropertiesV3.class)
public class MyDataSourceConfigV3 {

    private final MyDataSourcePropertiesV3 properties;

    public MyDataSourceConfigV3(MyDataSourcePropertiesV3 properties) {
        this.properties = properties;
    }

    @Bean
    public MyDataSource myDataSource() {
        return new MyDataSource(
                properties.getUrl(),
                properties.getUsername(),
                properties.getPassword(),
                properties.getEtc().getMaxConnection(),
                properties.getEtc().getTimeout(),
                properties.getEtc().getOptions()
        );
    }
}
```
8. ExternalReadApplication - ìˆ˜ì •
```java
package hello;

import hello.config.*;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Import;

// @Import(MyDataSourceEnvConfig.class)
// @Import(MyDataSourceValueConfig.class)
// @Import(MyDataSourceConfigV1.class)
// @Import(MyDataSourceConfigV2.class)
@Import(MyDataSourceConfigV3.class)
@SpringBootApplication(scanBasePackages = "hello.datasource")
public class ExternalReadApplication {

    public static void main(String[] args) {
        SpringApplication.run(ExternalReadApplication.class, args);
    }

}
```
9. ê°’ì´ ê²€ì¦ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œê²Œ ì„¤ì •
    - ê·¸ëŸ¬ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°œìƒ
```
Binding to target org.springframework.boot.context.properties.bind.BindException: Failed to bind properties under 'my.datasource' to hello.datasource.MyDataSourcePropertiesV3 failed:

    Property: my.datasource.etc.maxConnection
    Value: "0"
    Origin: class path resource [application.properties] - 5:34
    Reason: 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤
```
10. ì •ìƒ ì‹¤í–‰ ê²°ê³¼
```
2024-09-16T02:24:11.297+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : url = local.db.com
2024-09-16T02:24:11.299+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : username = username
2024-09-16T02:24:11.299+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : password = password
2024-09-16T02:24:11.299+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : maxConnection = 1
2024-09-16T02:24:11.299+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : timeout = PT3.5S
2024-09-16T02:24:11.299+09:00  INFO 2660 --- [           main] hello.datasource.MyDataSource            : options = [CACHE, ADMIN]
```

11. ì •ë¦¬
    - ConfigurationProperties ë•ë¶„ì— íƒ€ì… ì•ˆì „í•˜ê³ , ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì™¸ë¶€ ì„¤ì • ê°€ëŠ¥
    - ê·¸ë¦¬ê³  ê²€ì¦ê¸° ë•ë¶„ì— ì‰½ê³  í¸ë¦¬í•˜ê²Œ ì„¤ì • ì •ë³´ ê²€ì¦ ê°€ëŠ¥
    - ê°€ì¥ ì¢‹ì€ ì˜ˆì™¸ëŠ” ì»´íŒŒì¼ ì˜ˆì™¸, ê·¸ë¦¬ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì´ë©°, ê°€ì¥ ë‚˜ìœ ì˜ˆì™¸ëŠ” ê³ ê° ì„œë¹„ìŠ¤ ì¤‘ ë°œìƒí•˜ëŠ” ëŸ°íƒ€ì„ ì˜ˆì™¸

12. ConfigurationProperties ì¥ì 
    - ì™¸ë¶€ ì„¤ì •ì„ ê°ì²´ë¡œ í¸ë¦¬í•˜ê²Œ ë³€í™˜í•´ì„œ ì‚¬ìš© ê°€ëŠ¥
    - ì™¸ë¶€ ì„¤ì •ì˜ ê³„ì¸µì„ ê°ì²´ë¡œ í¸ë¦¬í•˜ê²Œ í‘œí˜„ ê°€ëŠ¥
    - ì™¸ë¶€ ì„¤ì •ì„ íƒ€ì… ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
    - ê²€ì¦ê¸° ì ìš© ê°€ëŠ¥
