-----
### í”„ë¡œë©”í…Œìš°ìŠ¤ - ì„¤ì¹˜
-----
1. https://prometheus.io/download/
   - MAC OS : drawin ì„ íƒ

2. ë‹¤ìš´ë¡œë“œ - ìœˆë„ìš° ì‚¬ìš©ì (windows-amd64 ì„ íƒ)
   - https://github.com/prometheus/prometheus/releases/download/v2.42.0/prometheus-2.42.0.windows-amd64.zip

3. ë‹¤ìš´ë¡œë“œ - MAC ì‚¬ìš©ì (drawin-amd64 ì„ íƒ)
   - https://github.com/prometheus/prometheus/releases/download/v2.42.0/prometheus-2.42.0.darwin-amd64.tar.gz


4. ì‹¤í–‰ - ìœˆë„ìš° : prometheus.exe ì‹¤í–‰
   - ìœˆë„ìš°ëŠ” ì²˜ìŒ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„¸ì§€ í™•ì¸ ê°€ëŠ¥
<div align="center">
<img src="https://github.com/user-attachments/assets/fc68bde5-beb0-47d2-ae62-3cd0892e8d00">
</div>

   - ì¶”ê°€ ì •ë³´ë¥¼ ì„ íƒí•˜ë©´, ë‹¤ìŒ í™”ë©´ì—ì„œ ë³´ì´ëŠ” ê²ƒ ì²˜ëŸ¼ ì‹¤í–‰ì´ ë‚˜ì˜´
<div align="center">
<img src="https://github.com/user-attachments/assets/1e2e97cd-9bc9-46b3-bd17-fe88f22cc59f">
</div>

   - ì‹¤í–‰ ë²„íŠ¼ì´ ë‚˜ì˜¤ë©´, ì‹¤í–‰ ë²„íŠ¼ ì„ íƒ


5. ì‹¤í–‰ - MAC : ./prometheus
   - MACì€ ì²˜ìŒ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„¸ì§€ í™•ì¸ ê°€ëŠ¥
<div align="center">
<img src="https://github.com/user-attachments/assets/8b44b8d6-b2c2-4052-9831-25a1759912ce">
</div>

   - ì‹œìŠ¤í…œ í™˜ê²½ ì„¤ì • â†’ ë³´ì•ˆ ë° ê°œì¸ ì •ë³´ ë³´í˜¸ â†’ ì¼ë°˜
<div align="center">
<img src="https://github.com/user-attachments/assets/39ccb035-ab8c-4afa-8ebb-edaaf332615d">
</div>

   - ì•„ë˜ì— ë³´ë©´ í™•ì¸ëœ ê°œë°œìê°€ ... prometheus ì‚¬ìš©ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤. ë¼ëŠ” ë©”ì„¸ì§€ê°€ ë³´ì„
   - ì˜¤ë¥¸ìª½ì— ìˆëŠ” í™•ì¸ ì—†ì´ í—ˆìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ìŠ¹ì¸
   - ì´í›„ ë‹¤ì‹œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ í”„ë¡œë©”í…Œìš°ìŠ¤ ì‹¤í–‰ : ./prometheus

6. ì‹¤í–‰ : http://localhost:9090 (ê¸°ë³¸ í¬íŠ¸ : 9090)
     - í”„ë¡œë©”í…Œìš°ìŠ¤ ì‹¤í–‰ í™”ë©´
<div align="center">
<img src="https://github.com/user-attachments/assets/b5c2844e-5a06-469b-ae21-7bd9f568910f">
</div>

7. ì°¸ê³  - Mackbook Apple Slicon M1 ì´ìƒ ì‚¬ìš©
   - Osettaê°€ ì„¤ì¹˜ë˜ì§€ ì•Šìœ¼ë©´ Bad CPU type in executable ì˜¤ë¥˜ê°€ ë°œìƒ ê°€ëŠ¥
     + Osettaë¥¼ ì„¤ì¹˜
   - Grafanaì˜ ê²½ìš° Darwin arm64 ì§€ì›ì´ ì—†ì–´ì„œ Rosetta 2  ì„¤ì¹˜í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥
   - Apple Silicon M1 ì´ìƒì„ ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ë“¤ì€ Amd64ê°€ ì•„ë‹Œ Arm64ìœ¼ë¡œ ì„¤ì¹˜í•˜ì‹œë©´ ë³´ì•ˆ í—ˆìš© ì—†ì´ ì§„í–‰ ê°€ëŠ¥

-----
### í”„ë¡œë©”í…Œìš°ìŠ¤ - ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
-----
1. í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³  ë³´ê´€í•˜ëŠ” DB
2. 2ê°€ì§€ ì‘ì—…ì´ í•„ìš”
   - ğŸ’¡ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • : í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”íŠ¸ë¦­ì„ ê°€ì ¸ê°ˆ ìˆ˜ ìˆë„ë¡ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í”„ë¡œë©”í…Œìš°ìŠ¤ í¬ë§·ì— ë§ì¶”ì–´ ë©”íŠ¸ë¦­ ë§Œë“¤ê¸°
   - ğŸ’¡ í”„ë¡œë©”í…Œìš°ìŠ¤ ì„¤ì • : í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ë„ë¡ ì„¤ì •

3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
   - ğŸ’¡ í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” /actuator/metricsì—ì„œ ë³´ì•˜ë˜ í¬ë§·(JSON)ì€ ì´í•´í•˜ì§€ ëª»í•¨
   - ë§ˆì´í¬ë¡œë¯¸í„°ê°€ ì´ ë¶€ë¶„ì„ í•´ê²°
<div align="center">
<img src="https://github.com/user-attachments/assets/424f2676-770a-4934-a1c6-5c7ed3ea0960">
</div>

   - ğŸ’¡ ê° ë©”íŠ¸ë¦­ë“¤ì€ ë‚´ë¶€ì—ì„œ ë§ˆì´í¬ë¡œë¯¸í„° í‘œì¤€ ë°©ì‹ìœ¼ë¡œ ì¸¡ì •ë˜ê³  ìˆìŒ
   - ë”°ë¼ì„œ, ì–´ë–¤ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í• ì§€ ì§€ì •ë§Œ í•´ì£¼ë©´ ë¨

4. build.gradle ì¶”ê°€
```gradle
implementation 'io.micrometer:micrometer-registry-prometheus' // ì¶”ê°€
```
  - ë§ˆì´í¬ë¡œë¯¸í„° í”„ë¡œë©”í…Œìš°ìŠ¤ êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
  - ğŸ’¡ ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ ì•¡ì¸„ì—ì´í„°ê°€ ìë™ìœ¼ë¡œ ë§ˆì´í¬ë¡œë¯¸í„° í”„ë¡œë©”í…Œìš°ìŠ¤ êµ¬í˜„ì²´ë¥¼ ë“±ë¡í•´ì„œ ë™ì‘í•˜ë„ë¡ ì„¤ì •
  - ğŸ’¡ ì•¡ì¸„ì—ì´í„°ì— í”„ë¡œë©”í…Œìš°ìŠ¤ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì—”ë“œí¬ì¸íŠ¸ê°€ ìë™ ì¶”ê°€
    + /actuator/prometheus
```
# HELP tomcat_threads_config_max_threads  
# TYPE tomcat_threads_config_max_threads gauge
tomcat_threads_config_max_threads{name="http-nio-8080",} 200.0

# HELP tomcat_sessions_alive_max_seconds  
# TYPE tomcat_sessions_alive_max_seconds gauge
tomcat_sessions_alive_max_seconds 0.0

# HELP tomcat_cache_access_total  
# TYPE tomcat_cache_access_total counter
tomcat_cache_access_total 0.0

# HELP jvm_info JVM version info # TYPE jvm_info gauge
jvm_info{runtime="OpenJDK Runtime Environment",vendor="JetBrains
s.r.o.",version="17.0.3+7-b469.37",} 1.0

# HELP logback_events_total Number of events that made it to the logs
# TYPE logback_events_total counter
logback_events_total{level="warn",} 0.0
logback_events_total{level="debug",} 0.0
logback_events_total{level="error",} 2.0
logback_events_total{level="trace",} 0.0
logback_events_total{level="info",} 47.0
...
```

  - ëª¨ë“  ë©”íŠ¸ë¦­ì´ í”„ë¡œë©”í…Œìš°ìŠ¤ í¬ë§·ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒ í™•ì¸ ê°€ëŠ¥
  - /actuator/metricsì™€ ë¹„êµí•´ì„œ í”„ë¡œë©”í…Œìš°ìŠ¤ì— ë§ì¶”ì–´ ë³€í™˜ëœ ëª‡ê°€ì§€ ë¶€ë¶„ í™•ì¸
```
jvm_info{runtime="OpenJDK Runtime Environment",vendor="JetBrains
s.r.o.",version="17.0.3+7-b469.37",} 1.0
...
logback_events_total{level="warn",} 0.0
logback_events_total{level="debug",} 0.0
logback_events_total{level="error",} 2.0
logback_events_total{level="trace",} 0.0
logback_events_total{level="info",} 47.0
```
  - {key="VALUE" } : tag filter
  - { } Value : ë’¤ì˜ ValueëŠ” íƒœê·¸ì— í•´ë‹¹í•˜ëŠ” ê°’

5. í¬ë§· ì°¨ì´
  - ğŸ’¡ jvm.info â†’ jvm_info : í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” . ëŒ€ì‹ ì— _ í¬ë§· ì‚¬ìš© (. ëŒ€ì‹ ì— _ í¬ë§·ìœ¼ë¡œ ë³€í™˜ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥)
  - ğŸ’¡ logback.events â†’ logback_events_total : ğŸ’¡ ë¡œê·¸ìˆ˜ ì²˜ëŸ¼ ì§€ì†í•´ì„œ ìˆ«ìê°€ ì¦ê°€í•˜ëŠ” ë©”íŠ¸ë¦­ì„ ì¹´ìš´í„°ë¼ í•¨
    + ğŸ’¡ í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ì¹´ìš´í„° ë©”íŠ¸ë¦­ì˜ ë§ˆì§€ë§‰ì—ëŠ” ê´€ë¡€ìƒ _totalì„ ë¶™ì„
```json
{
    "name": "logback.events",
    "description": "Number of events that made it to the logs",
    "baseUnit": "events",
    "measurements": [
        {
        "statistic": "COUNT",
        "value": 5
        }
    ],
    "availableTags": [
        {
        "tag": "level",
        "values": [
                "warn",
                "trace",
                "debug",
                "error",
                "info"
        ]
        }
    ]
}
```
```
logback_events_total{level="warn",} 0.0
logback_events_total{level="debug",} 0.0
logback_events_total{level="error",} 2.0
logback_events_total{level="trace",} 0.0
logback_events_total{level="info",} 47.0
```
  - ğŸ’¡ http.server.requests â†’ ì´ ë©”íŠ¸ë¦­ì€ ë‚´ë¶€ì— ìš”ì²­ ìˆ˜, ì‹œê°„ í•©, ìµœëŒ€ ì‹œê°„ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŒ
    + í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ë‹¤ìŒ 3ê°€ì§€ë¡œ ë¶„ë¥˜
    + ğŸ’¡ http_server_requests_seconds_count : ìš”ì²­ ìˆ˜
    + ğŸ’¡ http_server_requests_seconds_sum : ì‹œê°„ í•© (ìš”ì²­ ìˆ˜ì˜ ì‹œê°„ í•©)
    + ğŸ’¡ http_server_requests_seconds_max : ìµœëŒ€ ì‹œê°„ (ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ìš”ì²­ ìˆ˜)
  - ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ í¬ë§·ë“¤ì´ ë³€ê²½ë¨

-----
### í”„ë¡œë©”í…Œìš°ìŠ¤ - ìˆ˜ì§‘ ì„¤ì •
-----
1. í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ /actuator/prometheusë¥¼ í˜¸ì¶œí•´ì„œ ë©”íŠ¸ë¦­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ë„ë¡ ì„¤ì •
2. í”„ë¡œë©”í…Œìš°ìŠ¤ í´ë”ì— ìˆëŠ” prometheus.yml íŒŒì¼ ìˆ˜ì •
  - prometheus.yml
```yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # ì¶”ê°€
  - job_name: "spring-actuator"
    metrics_path: '/actuator/prometheus'
    scrape_interval: 1s
    static_configs:
      - targets: ['localhost:7070']
```
   - ì¶”ê°€í•œ ë¶€ë¶„
```yml
  # ì¶”ê°€
  - job_name: "spring-actuator"
    metrics_path: '/actuator/prometheus'
    scrape_interval: 1s
    static_configs:
      - targets: ['localhost:7070']
```
  - ë„ì–´ì“°ê¸° 2ì¹¸ì— ìœ ì˜
  - ğŸ’¡ job_name : ìˆ˜ì§‘í•˜ëŠ” ì´ë¦„ (ì„ì˜ì˜ ì´ë¦„ ì‚¬ìš©í•˜ë©´ ë¨)
  - ğŸ’¡ metrics_path : ìˆ˜ì§‘í•œ ê²½ë¡œ ì§€ì •
  - ğŸ’¡ scrape_interval : ìˆ˜ì§‘í•  ì£¼ê¸° ì„¤ì •
  - ğŸ’¡ targets : ìˆ˜ì§‘í•  ì„œë²„ì˜ IP, PORT ì§€ì •

  - ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´ í”„ë¡œëª¨í…Œìš°ìŠ¤ëŠ” ë‹¤ìŒ ê²½ë¡œë¥¼ 1ì´ˆì— í•œë²ˆì”© í˜¸ì¶œí•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
    + http://localhost:7070/actuator/prometheus

  - ğŸ’¡ ì£¼ì˜ : scrape_interval ì˜ ê²½ìš°, ì—¬ê¸°ì„œëŠ” ë¹ ë¥´ê²Œ í™•ì¸ì„ ìœ„í•´ ìˆ˜ì§‘ ì£¼ê¸°ë¥¼ 1s ì„ íƒ
    + ğŸ’¡ ìˆ˜ì§‘ ì£¼ê¸°ì˜ ê¸°ë³¸ ê°’ì€ 1m
    + ğŸ’¡ ìˆ˜ì§‘ ì£¼ê¸°ê°€ ë„ˆë¬´ ì§§ìœ¼ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìš´ì˜ì—ì„œëŠ” 10s ~ 1mì •ë„ ê¶Œì¥ (ì‹œìŠ¤í…œ ìƒí™©ì— ë”°ë¼ ë‹¤ë¦„)

3. ì„¤ì •ì´ ëë‚˜ë©´, í”„ë¡œë©”í…Œìš°ìŠ¤ ì„œë²„ ì¢…ë£Œ í›„ ì¬ì‹¤í–‰
4. í”„ë¡œë©”í…Œìš°ìŠ¤ ì—°ë™ í™•ì¸
   - í”„ë¡œë©”í…Œìš°ìŠ¤ ë©”ë‰´ â†’ Status â†’ Configurationì— ë“¤ì–´ê°€ì„œ prometheus.ymlì— ì…ë ¥í•œ ë¶€ë¶„ ì¶”ê°€ í™•ì¸
     + http://localhost:9090/config
   - í”„ë¡œë©”í…Œìš°ìŠ¤ ë©”ë‰´ â†’ Status â†’ Targersì— ë“¤ì–´ê°€ì„œ ì—°ë™ í™•ì¸
     + http://localhost:9090/targets
   - í”„ë¡œë©”í…Œìš°ìŠ¤ ì—°ë™ í™•ì¸ í™”ë©´
<div align="center">
<img src="https://github.com/user-attachments/assets/f1b2fa2c-0d58-4ac1-8fe3-9e5cfde7a68a">
</div>

   - ğŸ’¡ prometheus : í”„ë¡œë©”í…Œìš°ìŠ¤ ìì²´ì—ì„œ ì œê³µí•˜ëŠ” ë©”íŠ¸ë¦­ ì •ë³´ (í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ í”„ë¡œë©”í…Œìš°ìŠ¤ ìì‹  ë©”íŠ¸ë¦­ í™•ì¸)
   - spring-actuator : ìš°ë¦¬ê°€ ì—°ë™í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”íŠ¸ë¦­ ì •ë³´
   - ğŸ’¡ Stateê°€ UPì´ë©´ ì •ìƒ ì—°ë™, DOWNì´ë©´ ì—°ë™ì´ ì•ˆ ëœ ê²ƒ

5. í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í†µí•œ ë°ì´í„° ì¡°íšŒ
   - ì—°ë™í•œ ë©”íŠ¸ë¦­ ê°„ë‹¨íˆ ì¡°íšŒ
<div align="center">
<img src="https://github.com/user-attachments/assets/51c569e6-371c-4c72-86d6-4a3cd5b419ff">
</div>


  - jvm_infoë¥¼ ê²€ìƒ‰ì°½ì— ë„£ê³  ì‹¤í–‰í•˜ë©´ ìˆ˜ì§‘í•œ ë©”íŠ¸ë¦­ ì¡°íšŒ ê°€ëŠ¥
