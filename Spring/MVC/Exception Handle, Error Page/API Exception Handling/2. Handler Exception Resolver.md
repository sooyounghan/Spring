-----
### HandlerExceptionResolver
-----
1. ì˜ˆë¥¼ ë“¤ì–´, IllegalArgumentExceptionì„ ì²˜ë¦¬í•˜ì§€ ëª»í•´ ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ì¼ì´ ë°œìƒí•˜ë©´, HTTP ìƒíƒœ ì½”ë“œë¥¼ 400ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ ë°©ë²•?
2. ApiExceptionController - ìˆ˜ì •
```java
@GetMapping("/api/members/{id}")
public MemberDto getMember(@PathVariable String id) {
    if(id.equals("ex")) {
        throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
    }

    if(id.equals("bad")) {
        throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
    }

    return new MemberDto(id, "hello " + id);
}
```
  - ì‹¤í–‰í•´ë³´ë©´ ìƒíƒœ ì½”ë“œê°€ 500
```json
{
    "timestamp": "2024-07-18T05:33:28.716+00:00",
    "status": 500,
    "error": "Internal Server Error",
    "path": "/api/members/bad"
}
```

3. ìŠ¤í”„ë§ MVCëŠ” ì»¨íŠ¸ë¡¤ëŸ¬(í•¸ë“¤ëŸ¬) ë°–ìœ¼ë¡œ ì˜ˆì™¸ê°€ ë˜ì ¸ì§„ ê²½ìš° ì˜ˆì™¸ë¥¼ í•´ê²°í•˜ê³ , ë™ì‘ì„ ìƒˆë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” ë°©ë²• ì œê³µ
4. ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë˜ì ¸ì§„ ì˜ˆì™¸ë¥¼ í•´ê²°í•˜ê³ , ë™ì‘ ë°©ì‹ì„ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ HandlerExceptionResolverë¥¼ ì‚¬ìš©í•˜ë©´ ë¨ (ExceptionResolverë¼ê³  í•¨)
  - ExceptionResolver ì ìš© ì „
<div align="center">
<img src="https://github.com/user-attachments/assets/6d9cb609-0626-43bc-9b58-548f56e55880">
</div>

  - ExceptionResovler ì ìš© í›„
<div align="center">
<img src="https://github.com/user-attachments/assets/f563afa6-d476-44ea-a8f6-c435300e5bc8">
</div>

  - ExceptionResolverë¡œ ì˜ˆì™¸ë¥¼ í•´ê²°í•´ë„ postHandle()ì€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

5. HandlerExceptionResolver - ì¸í„°í˜ì´ìŠ¤
```java
public interface HandlerExceptionResolver {
    @Nullable
    ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response,
                                  @Nullable Object handler, Exception ex);
}
```
  - handler : í•¸ë“¤ëŸ¬ (ì»¨íŠ¸ë¡¤ëŸ¬) ì •ë³´
  - Exception ex : í•¸ë“¤ëŸ¬ (ì»¨íŠ¸ë¡¤ëŸ¬)ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸

6. MyHandlerExceptionResolver
```java
package hello.exception.resolver;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.servlet.HandlerExceptionResolver;
import org.springframework.web.servlet.ModelAndView;

import java.io.IOException;

@Slf4j
public class MyHandlerException implements HandlerExceptionResolver {
    @Override
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        
        try {
            if (ex instanceof IllegalArgumentException) {
                log.info("IllegalArgumentException Resolver to 400");

                response.sendError(HttpServletResponse.SC_BAD_REQUEST, ex.getMessage());
                
                return new ModelAndView();
            }
        } catch(IOException e) {
            log.error("Resolver Ex", e);
        }
        
        return null;
    }
}
```

  - ExceptionResolverê°€ ModelAndViewë¥¼ ë°˜í™˜í•˜ëŠ” ì´ìœ ëŠ” ë§ˆì¹˜ try-catchë¥¼ í•˜ë“¯, Exceptionì„ ì²˜ë¦¬í•´ì„œ ì •ìƒ íë¦„ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì´ ëª©ì 
  - ì´ë¦„ ê·¸ëŒ€ë¡œ Exceptionì„ Resolver(í•´ê²°)í•˜ëŠ” ê²ƒì´ ëª©ì 
  - ì—¬ê¸°ì„œ IllegalArgumentExceptionì´ ë°œìƒí•˜ë©´ response.sendError(400)ì„ í˜¸ì¶œí•´ HTTP ìƒíƒœ ì½”ë“œë¥¼ 400ìœ¼ë¡œ ì§€ì •í•˜ê³ , ë¹ˆ ModelAndViewë¥¼ ë°˜í™˜

7. ğŸ’¡ ë°˜í™˜ ê°’ì— ë”°ë¥¸ ë™ì‘ ë°©ì‹
   - HandlerExceptionResolverì˜ ë°˜í™˜ ê°’ì— ë”°ë¥¸ DispatcherServletì˜ ë™ì‘ ë°©ì‹
   - ë¹ˆ ModelAndView : new ModelAndView()ì²˜ëŸ¼ ë¹ˆ ModelAndViewë¥¼ ë°˜í™˜í•˜ë©´ ë·°ë¥¼ ë Œë”ë§ í•˜ì§€ ì•Šê³ , ì •ìƒ íë¦„ìœ¼ë¡œ ì„œë¸”ë¦¿ì´ Return
   - ModelAndView ì§€ì • : ModelAndViewì— View, Model ë“± ì •ë³´ë¥¼ ì§€ì •í•´ ë°˜í™˜í•˜ë©´ ë·°ë¥¼ ë Œë”ë§
   - null : nullì„ ë°˜í™˜í•˜ë©´, ë‹¤ìŒ ExceptionResolverë¥¼ ì°¾ì•„ì„œ ì‹¤í–‰
     + ë§Œì•½, ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ExceptionResolverê°€ ì—†ìœ¼ë©´ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì•ˆ ë˜ê³ , ê¸°ì¡´ì— ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì„œë¸”ë¦¿ ë°–ìœ¼ë¡œ ë˜ì§

8. ExceptionResolver í™œìš©
   - ì˜ˆì™¸ ìƒíƒœ ì½”ë“œ ë³€í™˜
     + ì˜ˆì™¸ë¥¼ response.sendError(xxx) í˜¸ì¶œë¡œ ë³€ê²½í•´ ì„œë¸”ë¦¿ì—ì„œ ìƒíƒœ ì½”ë“œì— ë”°ë¥¸ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ ìœ„ì„
     + ì´í›„ WASëŠ” ì„œë¸”ë¦¿ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì°¾ì•„ ë‚´ë¶€ í˜¸ì¸¨ (ì˜ˆ) ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•œ /error í˜¸ì¶œ)
   - ë·° í…œí”Œë¦¿ í˜¸ì¶œ
     + ModelAndViewì— ê°’ì„ ì±„ì›Œì„œ ì˜ˆì™¸ì— ë”°ë¥¸ ìƒˆë¡œìš´ ì˜¤ë¥˜ ë·° ë Œë”ë§ í•´ì„œ ê³ ê°ì—ê²Œ ì œê³µ
   - API ì‘ë‹µ ì²˜ë¦¬
     + response.getWriter().println("hello"); ì²˜ëŸ¼ HTTP ì‘ë‹µ ë°”ë””ì— ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒ ê°€ëŠ¥
     + ì—¬ê¸°ì— JSONìœ¼ë¡œ ì‘ë‹µí•˜ë©´ API ì²˜ë¦¬ ê°€ëŠ¥

9. WebConfig ìˆ˜ì •
```java
package hello.exception;

import hello.exception.interceptor.LogInterceptor;
import hello.exception.resolver.MyHandlerException;
import hello.login.web.filter.LogFilter;
import jakarta.servlet.DispatcherType;
import jakarta.servlet.Filter;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.HandlerExceptionResolver;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import java.util.List;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    ...

    @Override
    public void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {
        resolvers.add(new MyHandlerException());
    }

    ...
}
```
  - configureHandlerExceptionResolver(...) ì‚¬ìš© : ìŠ¤í”„ë§ì´ ê¸°ë³¸ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ExceptionHandlerê°€ ì œê±°
  - extendHandlerExceptionResolvers ì‚¬ìš©

-----
### HandlerExceptionResolver í™œìš©
-----
1. ì˜ˆì™¸ ë§ˆë¬´ë¦¬
   - ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ WASê¹Œì§€ ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ê³ , WASì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ ì •ë³´ë¥¼ ì°¾ì•„ì„œ /errorë¥¼ í˜¸ì¶œí•˜ëŠ” ê³¼ì •ì€ ë³µì¡í•¨
   - ExceptionResolverë¥¼ í™œìš©í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ, ì´ëŸ° ë³µì¡í•œ ê³¼ì • ì—†ì´ ì—¬ê¸°ì—ì„œ ë¬¸ì œ í•´ê²° ê°€ëŠ¥
2. ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í•˜ë‚˜ ì¶”ê°€ - UserException
```java
package hello.exception.exception;

public class UserException extends RuntimeException {
    public UserException() {
        super();
    }

    public UserException(String message) {
        super(message);
    }

    public UserException(String message, Throwable cause) {
        super(message, cause);
    }

    public UserException(Throwable cause) {
        super(cause);
    }

    protected UserException(String message, Throwable cause, boolean enableSuppression, boolean writableStackTrace) {
        super(message, cause, enableSuppression, writableStackTrace);
    }
}
```

3. ApiExceptionController - ì˜ˆì™¸ ì¶”ê°€
```java
package hello.exception.api;

import hello.exception.exception.UserException;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.HandlerExceptionResolver;

@Slf4j
@RestController
public class ApiExceptionController {
    @GetMapping("/api/members/{id}")
    public MemberDto getMember(@PathVariable String id) {
        if(id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }

        if(id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }

        if(id.equals("user-ex")) {
            throw new UserException("ì‚¬ìš©ì ì˜¤ë¥˜");
        }
        
        return new MemberDto(id, "hello " + id);
    }


    @Data
    @AllArgsConstructor
    static class MemberDto {
        private String memberId;
        private String name;
    }
}
```

4. UserHandlerExceptionResolver
```java
package hello.exception.resolver;

import com.fasterxml.jackson.databind.ObjectMapper;
import hello.exception.exception.UserException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.servlet.HandlerExceptionResolver;
import org.springframework.web.servlet.ModelAndView;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@Slf4j
public class UserHandlerExceptionResolver implements HandlerExceptionResolver {

    private final ObjectMapper obejctMapper = new ObjectMapper();

    @Override
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        try {
            if(ex instanceof UserException) {
                log.info("userException Resolver to 400");
                String acceptHeader = request.getHeader("accept");
                response.setStatus(HttpServletResponse.SC_BAD_REQUEST);

                if("application/json".equals(acceptHeader)) {
                    Map<String, Object> errorResult = new HashMap<>();
                    errorResult.put("ex", ex.getClass());
                    errorResult.put("message", ex.getMessage());

                    String result = obejctMapper.writeValueAsString(errorResult);

                    response.setContentType("application/json");
                    response.setCharacterEncoding("UTF-8");
                    response.getWriter().write(result);

                    return new ModelAndView();
                } else {
                    // text/html ë“±
                    return new ModelAndView("error/500");
                }
            }
        } catch(IOException e) {
            log.error("Resolver ex", e);
        }

        return null;
    }
}
```
  - HTTP ìš”ì²­ í—¤ë”ì˜ ê°’ì´ acceptì˜ ê°’ì´ application/jsonì´ë©´, JSONìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë‚´ë ¤ì¤Œ
  - ê·¸ ì™¸ì˜ ê²½ìš° error/500ì— ìˆëŠ” HTML ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤Œ

5. WebConfigì— UserHandlerExceptionResolver ì¶”ê°€
```java
@Override
public void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {
    resolvers.add(new MyHandlerException());
    resolvers.add(new UserHandlerExceptionResolver());
}
```

6. ì‹¤í–‰ ê²°ê³¼
   - accept : application/json
```json
{
    "ex": "hello.exception.exception.UserException",
    "message": "ì‚¬ìš©ì ì˜¤ë¥˜"
}
```

  - accept : text/html
```html
<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
</head>

<body>
    <div class="container" style="max-width: 600px">
        <div class="py-5 text-center">
            <h2>500 ì˜¤ë¥˜ í™”ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ ì œê³µ</h2>
        </div>
        <div>
            <p>ì˜¤ë¥˜ í™”ë©´ ì…ë‹ˆë‹¤.</p>
        </div>

        ...

        <hr class="my-4">
    </div> <!-- /container -->
</body>

</html>
```

7. ì •ë¦¬
   - ExceptionResolverë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ExceptionResolverì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬
   - ë”°ë¼ì„œ, ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê¹Œì§€ ì „ë‹¬ë˜ì§€ ì•Šê³ , ìŠ¤í”„ë§ MVCì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ëë‚¨
   - ê²°ê³¼ì ìœ¼ë¡œ WAS ì…ì¥ì—ì„œëŠ” ì •ìƒ ì²˜ë¦¬ê°€ ëœ ê²ƒ
