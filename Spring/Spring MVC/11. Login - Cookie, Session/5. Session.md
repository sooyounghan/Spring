-----
### ì„¸ì…˜ ë™ì‘ ë°©ì‹ - ë¡œê·¸ì¸
-----
1. ì‚¬ìš©ìê°€ loginId, password ì •ë³´ë¥¼ ì „ë‹¬í•˜ë©´ ì„œë²„ì—ì„œ í•´ë‹¹ ì‚¬ìš©ìê°€ ë§ëŠ”ì§€ í™•ì¸
<div align="center">
<img src="https://github.com/user-attachments/assets/940e0b8e-7b8c-4e5f-9814-b9e558b58d85">
</div>

2. ì„¸ì…˜ IDë¥¼ ìƒì„±í•˜ëŠ”ë° ì¶”ì • ë¶ˆê°€ëŠ¥í•´ì•¼ í•¨
<div align="center">
<img src="https://github.com/user-attachments/assets/29824763-7ba1-4b10-9ffb-023bb1e204d4">
</div>

  - UUIDëŠ” ì¶”ì • ë¶ˆê°€ëŠ¥
    + Cookie: mySessionId=zz0101xx-bab9-4b92-9b32-dadb280f4b61
  - ìƒì„±ëœ ì„¸ì…˜ IDì™€ ì„¸ì…˜ì— ë³´ê´€í•  ê°’(memberA)ì„ ì„œë²„ì˜ ì„¸ì…˜ ì €ì¥ì†Œì— ë³´ê´€

3. ì„¸ì…˜ IDë¥¼ ì¿ í‚¤ë¡œ ì „ë‹¬
<div align="center">
<img src="https://github.com/user-attachments/assets/2b84c49c-b339-4544-b6e8-2580ff38685f">
</div>

  - í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ëŠ” ê²°êµ­ ì¿ í‚¤ë¡œ ì—°ê²°ì´ ë˜ì–´ì•¼ í•¨
    + ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì— mySessionIdë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì„¸ì…˜ IDë§Œ ì¿ í‚¤ì— ë‹´ì•„ì„œ ì „ë‹¬
    + í´ë¼ì´ì–¸íŠ¸ëŠ” ì¿ í‚¤ ì €ì¥ì†Œì— mySessionId ì¿ í‚¤ë¥¼ ë³´ê´€

  - ğŸ’¡ ì—¬ê¸°ì„œ íšŒì›ê³¼ ê´€ë ¨ëœ ì •ë³´ëŠ” ì „í˜€ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•˜ì§€ ì•ŠìŒ
  - ğŸ’¡ ì˜¤ì§ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ì„¸ì…˜ IDë§Œ ì¿ í‚¤ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬

4. í´ë¼ì´ì–¸íŠ¸ì˜ ì„¸ì…˜ ID ì¿ í‚¤ ì „ë‹¬
<div align="center">
<img src="https://github.com/user-attachments/assets/10b695bc-f36b-41b7-a76e-584e1165ff71">
</div>

  - í´ë¼ì´ì–¸íŠ¸ëŠ” ìš”ì²­ ì‹œ í•­ìƒ mySessionID ì¿ í‚¤ë¥¼ ì „ë‹¬
  - ì„œë²„ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•œ mySessionId ì¿ í‚¤ ì •ë³´ë¡œ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ì¡°íšŒí•´ì„œ ë¡œê·¸ì¸ ì‹œ ë³´ê´€í•œ ì„¸ì…˜ ì •ë³´ ì‚¬ìš©

-----
### ì •ë¦¬
-----
1. ì„¸ì…˜ì„ ì‚¬ìš©í•´ ì„œë²„ì—ì„œ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê²Œ ë¨
2. ì¿ í‚¤ ê°’ ë³€ì¡° ê°€ëŠ¥í•œ ë¬¸ì œ : ì˜ˆìƒ ë¶ˆê°€ëŠ¥í•œ ë³µì¡í•œ ì„¸ì…˜ IDë¥¼ ì‚¬ìš©
3. ì¿ í‚¤ì— ë³´ê´€í•˜ëŠ” ì •ë³´ëŠ” í´ë¼ì´ì–¸íŠ¸ í•´í‚¹ ì‹œ í„¸ë¦´ ê°€ëŠ¥ì„±ì´ ìˆìŒ : ì„¸ì…˜ IDê°€ í„¸ë ¤ë„ ì—¬ê¸°ì—ëŠ” ì¤‘ìš”í•œ ì •ë³´ê°€ ì—†ìŒ
4. ì¿ í‚¤ íƒˆì·¨ í›„ ì‚¬ìš© : í•´ì»¤ê°€ í† í°ì„ í„¸ì–´ê°€ë„, ì‹œê°„ì´ ì§€ë‚˜ë©´ ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡ ì„œë²„ì—ì„œ ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ì„ ì§§ê²Œ(ì˜ˆ) 30ë¶„) ìœ ì§€
   + ë˜ëŠ” í•´í‚¹ì´ ì˜ì‹¬ë˜ëŠ” ê²½ìš° ì„œë²„ì—ì„œ í•´ë‹¹ ì„¸ì…˜ì„ ê°•ì œë¡œ ì œê±°í•˜ë©´ ë¨

-----
### ë¡œê·¸ì¸ ì²˜ë¦¬ - ì„¸ì…˜ ì´ìš© ê°œë°œ
-----
1. ì„¸ì…˜ ê´€ë¦¬ ê¸°ëŠ¥
   - ì„¸ì…˜ ìƒì„±
     + session ìƒì„± (ì„ì˜ì˜ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ëœë¤ ê°’)
     + ì„¸ì…˜ ì €ì¥ì†Œì— sessionIdì™€ ë³´ê´€í•  ê°’ ì €ì¥
     + sessionIdë¡œ ì‘ë‹µ ì¿ í‚¤ë¥¼ ìƒì„±í•´ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬

   - ì„¸ì…˜ ì¡°íšŒ
     + í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ sessionId ì¿ í‚¤ì˜ ê°’ìœ¼ë¡œ, ì„¸ì…˜ ì €ì¥ì†Œì— ë³´ê´€í•œ ê°’ ì¡°íšŒ

   - ì„¸ì…˜ ë§Œë£Œ
     + í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ sessionId ì¿ í‚¤ì˜ ê°’ìœ¼ë¡œ, ì„¸ì…˜ ì €ì¥ì†Œì— ë³´ê´€í•œ sessionIdì™€ ê°’ ì œê±°

2. SessionManager - ì„¸ì…˜ ê´€ë¦¬
```java
package hello.login.web.session;

import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.stereotype.Component;

import java.util.Arrays;
import java.util.Map;
import java.util.UUID;
import java.util.concurrent.ConcurrentHashMap;

/**
 * ì„¸ì…˜ ê´€ë¦¬
 */
@Component
public class SessionManager {
    private static final String SESSION_COOKIE_NAME = "mySessionId";
    private Map<String, Object> sessionStore = new ConcurrentHashMap<>();

    /**
     * ì„¸ì…˜ ìƒì„±
     * - sessionId ìƒì„± (ì„ì˜ì˜ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ëœë¤ ê°’)
     * - ì„¸ì…˜ ì €ì¥ì†Œì— sessionIdì™€ ë³´ê´€í•  ê°’ ì €ì¥
     * - sessionIdë¡œ ì‘ë‹µ ì¿ í‚¤ë¥¼ ìƒì„±í•´ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬
     */
    public void createSession(Object value, HttpServletResponse response) {
        // sessionId ìƒì„±í•˜ê³ , ê°’ì„ Sessionì— ì €ì¥
        String sessionId = UUID.randomUUID().toString();
        sessionStore.put(sessionId, value);

        // ì¿ í‚¤ ìƒì„±
        Cookie mySessionCookie = new Cookie(SESSION_COOKIE_NAME, sessionId);
        response.addCookie(mySessionCookie);
    }

    /**
     * ì„¸ì…˜ ì¡°íšŒ
     */
    public Object getSession(HttpServletRequest request) {
        Cookie sessionCookie = findCookie(request, SESSION_COOKIE_NAME);
        if(sessionCookie == null) {
            return null;
        }

        return sessionStore.get(sessionCookie.getValue());
    }

    /**
     * ì„¸ì…˜ ë§Œë£Œ
     */
    public void expire(HttpServletRequest request) {
        Cookie sessionCookie = findCookie(request, SESSION_COOKIE_NAME);
        if(sessionCookie != null) {
            sessionStore.remove(sessionCookie.getValue());
        }
    }
    
    public Cookie findCookie(HttpServletRequest request, String cookieName) {
        Cookie[] cookies = request.getCookies();
        if(cookies == null) {
            return null;
        }

        return Arrays.stream(cookies)
                .filter(cookie -> cookie.getName().equals(cookieName))
                .findAny()
                .orElse(null);
    }
}
```
  - @Component : ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡
  - ConcurrentHashMap : HashMapì€ ë™ì‹œ ìš”ì²­ì— ì•ˆì „í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë™ì‹œ ìš”ì²­ì— ì•ˆì „í•œ ConcurrentHashMap ì‚¬ìš©

3. SessionManagerTest - í…ŒìŠ¤íŠ¸
```java
package hello.login.web.session;

import hello.login.domain.member.Member;
import org.junit.jupiter.api.Test;
import org.springframework.mock.web.MockHttpServletRequest;
import org.springframework.mock.web.MockHttpServletResponse;

import static org.assertj.core.api.Assertions.*;

class SessionManagerTest {
    SessionManager sessionManager = new SessionManager();

    @Test
    void sessionTest() {
        MockHttpServletResponse response = new MockHttpServletResponse();

        // ì„¸ì…˜ ìƒì„±
        Member member = new Member();
        sessionManager.createSession(member, response);

        // ìš”ì²­ì— ì‘ë‹µ ì¿ í‚¤ê°€ ì €ì¥
        MockHttpServletRequest request = new MockHttpServletRequest();
        request.setCookies(response.getCookies());

        // ì„¸ì…˜ ì¡°íšŒ
        Object result = sessionManager.getSession(request);
        assertThat(result).isEqualTo(member);

        // ì„¸ì…˜ ë§Œë£Œ
        sessionManager.expire(request);
        Object expired = sessionManager.getSession(request);
        assertThat(expired).isNull();
    }
}
```
  - HttpServletRequest, HttpServletResponse ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í…ŒìŠ¤íŠ¸ì—ì„œ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ëŠ” ê°€ì§œ MockHttpServletRequest, MockHttpServletResponse ì‚¬ìš©

-----
### ë¡œê·¸ì¸ ì²˜ë¦¬ - ì„¸ì…˜ ì ìš©
-----
1. LoginController - loginV2()
```java
private final SessionManager sessionManager;

...

@PostMapping("/login")
public String login(@Valid @ModelAttribute("loginForm") LoginForm loginForm, BindingResult bindingResult, HttpServletResponse response) {
    if(bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    // ë¡œê·¸ì¸ ì‹œë„
    Member loginMember = loginService.login(loginForm.getLoginId(), loginForm.getPassword());

    // ë¡œê·¸ì¸í•œ íšŒì›ì˜ ì •ë³´ê°€ ì—†ì„ ë•Œ
    if(loginMember == null) {
        bindingResult.reject("loginFail", "ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "login/loginForm";
    }

    // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬

    // ì„¸ì…˜ ê´€ë¦¬ìë¥¼ í†µí•´ ì„¸ì…˜ ìƒì„± í›„, íšŒì› ë°ì´í„° ë³´ê´€
    sessionManager.createSession(loginMember, response);

    return "redirect:/";
}
```
  - private final SessionManager sessionManager; ì£¼ì…
  - sessionManager.createSession(loginMember, response);
  - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„¸ì…˜ ë“±ë¡, ì„¸ì…˜ì— loginMemberë¥¼ ì €ì¥í•´ë‘ê³ , ì¿ í‚¤ë„ í•¨ê»˜ ë°œí–‰

2. LoginController- logoutV2()
```java
@PostMapping("/logout")
public String logoutV2(HttpServletRequest request) {
    sessionManager.expire(request);

    return "redirect:/";
}
```
  - ë¡œê·¸ì•„ì›ƒ ì‹œ í•´ë‹¹ ì„¸ì…˜ ì •ë³´ ì œê±°

3. HomeController - homeLoginV2()
```java
package hello.login.web;

import hello.login.domain.member.Member;
import hello.login.domain.member.MemberRepository;
import hello.login.web.session.SessionManager;
import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.CookieValue;
import org.springframework.web.bind.annotation.GetMapping;

@Slf4j
@Controller
@RequiredArgsConstructor
public class HomeController {
    private final SessionManager sessionManager;

    @GetMapping("/")
    public String homeLogin(HttpServletRequest request, Model model) {
        // ì„¸ì…˜ ê´€ë¦¬ìì— ì €ì¥ëœ íšŒì› ì •ë³´ ì¡°íšŒ
        Member member = (Member)sessionManager.getSession(request);
        
        if(member == null) {
            return "home";
        }

        model.addAttribute("member", member);
        return "loginHome";
    }
}
```
  - private final SessionManager sessionManager; ì£¼ì…
  - ì„¸ì…˜ ê´€ë¦¬ìì—ì„œ ì €ì¥ëœ íšŒì› ì •ë³´ ì¡°íšŒ
  - ë§Œì•½ íšŒì› ì •ë³´ê°€ ì—†ìœ¼ë©´, ì¿ í‚¤ë‚˜ ì„¸ì…˜ì´ ì—†ëŠ” ê²ƒì´ë¯€ë¡œ ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
