-----
### QueryDSL ì ìš©
-----
1. JpaItemRepositoryV3
```java
package hello.itemservice.repository.jpa;

import com.querydsl.core.BooleanBuilder;
import com.querydsl.core.types.dsl.BooleanExpression;
import com.querydsl.jpa.impl.JPAQueryFactory;
import hello.itemservice.domain.Item;
import hello.itemservice.domain.QItem;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import javax.persistence.EntityManager;
import java.util.List;
import java.util.Optional;

import static hello.itemservice.domain.QItem.item;

@Repository
@Transactional
public class JpaItemRepositoryV3 implements ItemRepository {

    private final EntityManager em;
    private final JPAQueryFactory query;

    public JpaItemRepositoryV3(EntityManager em) {
        this.em = em;
        this.query = new JPAQueryFactory(em);
    }

    @Override
    public Item save(Item item) {
        em.persist(item);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        Item item = em.find(Item.class, itemId);
        item.setItemName(updateParam.getItemName());
        item.setPrice(updateParam.getPrice());
        item.setQuantity(updateParam.getQuantity());
    }

    @Override
    public Optional<Item> findById(Long id) {
        Item item = em.find(Item.class, id);
        return Optional.ofNullable(item);
    }

    public List<Item> findAllOld(ItemSearchCond cond) {

        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        QItem item = QItem.item;
        BooleanBuilder builder = new BooleanBuilder();

        if(StringUtils.hasText(itemName)) {
            builder.and(item.itemName.like("%" + itemName + "%"));
        }

        if (maxPrice != null) {
            builder.and(item.price.loe(maxPrice));
        }

        List<Item> result = query.select(item)
                            .from(item)
                            .where(builder)
                            .fetch();

        return result;
    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {

        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        List<Item> result = query.select(item)
                .from(item)
                .where(likeItemName(itemName), maxPrice(maxPrice))
                .fetch();

        return result;
    }

    private BooleanExpression likeItemName(String itemName) {
        if(StringUtils.hasText(itemName)) {
            return item.itemName.like("%" + itemName + "%");
        }

        return null;
    }

    private BooleanExpression maxPrice(Integer maxPrice) {
        if (maxPrice != null) {
           return item.price.loe(maxPrice);
        }

        return null;
    }
}
```

2. ê³µí†µ
   - ğŸ’¡ Querydslì„ ì‚¬ìš©í•˜ë ¤ë©´ JPAQueryFactoryê°€ í•„ìš”
   - ğŸ’¡ JPAQueryFactoryëŠ” JPA ì¿¼ë¦¬ì¸ JPQLì„ ë§Œë“¤ê¸° ë–„ë¬¸ì—, EntityManagerê°€ í•„ìš”
   - ì„¤ì • ë°©ì‹ì€ JdbcTemplateì„ ì„¤ì •í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬
   - ì°¸ê³ ë¡œ JpaQueryFactoryë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ì‚¬ìš©í•´ë„ ë¨

3. save(), update(), findById() : ê¸°ë³¸ ê¸°ëŠ¥ë“¤ì€ JPAê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê¸°ëŠ¥ ì‚¬ìš©

4. findAllOld : Querydslë¥¼ ì‚¬ìš©í•´ ë™ì  ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°
   - BooleanBuilderë¥¼ ì‚¬ìš©í•´ì„œ ì›í•˜ëŠ” where ì¡°ê±´ì„ ë„£ì–´ì¤Œ
   - ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ë¯€ë¡œ ë™ì  ì¿¼ë¦¬ ë§¤ìš° í¸í•˜ê²Œ ì‘ì„± ê°€ëŠ¥

5. findAll : findAllOld ì‘ì„± ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§
```java
@Override
public List<Item> findAll(ItemSearchCond cond) {

    String itemName = cond.getItemName();
    Integer maxPrice = cond.getMaxPrice();

    List<Item> result = query.select(item)
                              .from(item)
                              .where(likeItemName(itemName), maxPrice(maxPrice))
                              .fetch();

    return result;
}

private BooleanExpression likeItemName(String itemName) {
    if(StringUtils.hasText(itemName)) {
        return item.itemName.like("%" + itemName + "%");
    }

    return null;
}

private BooleanExpression maxPrice(Integer maxPrice) {
    if (maxPrice != null) {
       return item.price.loe(maxPrice);
    }

    return null;
}
```
  - ğŸ’¡ Querydslì—ì„œ where(A, B)ì— ë‹¤ì–‘í•œ ì¡°ê±´ë“¤ì„ ë„£ì„ ìˆ˜ ìˆëŠ”ë°, ì´ë ‡ê²Œ ë„£ìœ¼ë©´ AND ì¡°ê±´ìœ¼ë¡œ ì²˜ë¦¬
  - ğŸ’¡ ì°¸ê³ ë¡œ, where()ì— nullì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ ì¡°ê±´ ë¬´ì‹œ
  - ì´ ì½”ë“œì˜ ì¥ì ì€ likeItemName(), maxPrice()ë¥¼ ë‹¤ë¥¸ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ ì¬ì‚¬ìš© ê°€ëŠ¥
  - ì¦‰, ì¿¼ë¦¬ ì¡°ê±´ì„ ë¶€ë¶„ì ìœ¼ë¡œ ëª¨ë“ˆí™” (ì´ëŠ” ìë°” ì½”ë“œë¡œ ê°œë°œí•˜ê¸° ë•Œë¬¸ì— ì–»ì„ ìˆ˜ ì´ëŠ” í° ì¥ì )
    
-----
### QuerydslConfig
-----
```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jpa.JpaItemRepositoryV3;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;

@Configuration
@RequiredArgsConstructor
public class QuerydslConfig {

    private final EntityManager em;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JpaItemRepositoryV3(em);
    }
}
```

-----
### ItemServiceApplication ë³€ê²½
-----
```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;


// @Import(MemoryConfig.class)
// @Import(JdbcTemplateV1Config.class)
// @Import(JdbcTemplateV2Config.class)
// @Import(JdbcTemplateV3Config.class)
// @Import(MyBatisConfig.class)
// @Import(JpaConfig.class)
// @Import(SpringDataJpaConfig.class)
@Import(QuerydslConfig.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
@Slf4j
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

  ...
}
```
  - QuerydslConfigë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½

-----
### ì˜ˆì™¸ ë³€í™˜
-----
1. Querydslì€ ë³„ë„ì˜ ìŠ¤í”„ë§ ì˜ˆì™¸ ì¶”ìƒí™”ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
2. ğŸ’¡ ëŒ€ì‹  JPAì˜ @Repositoryì—ì„œ ìŠ¤í”„ë§ ì˜ˆì™€ ì¶”ìƒí™” ì²˜ë¦¬

-----
### ì •ë¦¬
-----
1. Querydsl ë•ë¶„ì— ë™ì  ì¿¼ë¦¬ë¥¼ ë§¤ìš° ê¹”ë”í•˜ê²Œ ì‘ì„±
```java
List<Item> result = query.select(item)
                          .from(item)
                          .where(likeItemName(itemName), maxPrice(maxPrice))
                          .fetch();
```
  - ì¿¼ë¦¬ ë¬¸ì¥ì— ì˜¤íƒ€ê°€ ìˆì–´ë„ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ë§‰ì„ ìˆ˜ ìˆìŒ
  - ë©”ì„œë“œ ì¶”ì¶œì„ í†µí•´ ì½”ë“œ ì¬ì‚¬ìš© ê°€ëŠ¥
  - ì—¬ê¸°ì„œ ë§Œë“  likeItemName(itemName), maxPrice(maxPrice) ë©”ì„œë“œë¥¼ ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œë„ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥

2. Querydslì€ ìµœì  ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ DTOë¡œ í¸ë¦¬í•˜ê²Œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì€ ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©
