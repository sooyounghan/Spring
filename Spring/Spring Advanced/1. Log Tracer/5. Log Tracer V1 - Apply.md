-----
### ë¡œê·¸ ì¶”ì ê¸° V1 - ì ìš©
-----
1. v0ì—ì„œ v1ìœ¼ë¡œ ë³µì‚¬
   - hello.advanced.app.v1 íŒ¨í‚¤ì§€ ìƒì„±
   - ë³µì‚¬
     + v0.OrderRepositoryV0 â†’ v1.OrderRepositoryV1
     + v0.OrderServiceV0 â†’ v1.OrderServiceV1
     + v0.OrderControllerV0 â†’ v1.OrderControllerV1
   - ì½”ë“œ ë‚´ë¶€ ì˜ì¡´ ê´€ê³„ë¥¼ í´ë˜ìŠ¤ V1ìœ¼ë¡œ ë³€ê²½
     + OrderControllerV1 : OrderServiceV0 â†’ OrderServiceV1
     + OrderServiceV1 : OrderRepositoryV0 â†’ OrderRepositoryV1
   - OrderControllerV1 ë§¤í•‘ ì •ë³´ ë³€ê²½
     + @GetMapping("/v1/request")

2. v1 ì ìš©í•˜ê¸°
   - OrderControllerV1, OrderServiceV1, OrderRepositoryV1ì— ë¡œê·¸ ì¶”ì ê¸° ì ìš©

3. OrderControllerV1
```java
package hello.advanced.app.v1;

import hello.advanced.trace.TraceStatus;
import hello.advanced.trace.hellotrace.HelloTraceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequiredArgsConstructor
public class OrderControllerV1 {
    private final OrderServiceV1 orderService;
    private final HelloTraceV1 trace;

    @GetMapping("/v1/request")
    public String request(String itemId) {

        TraceStatus status = null; // tryë¬¸ ì•ˆì˜ statusëŠ” tryë¬¸ ì•ˆì—ì„œë§Œ ìœ íš¨í•˜ë¯€ë¡œ, nullë¡œ ì´ˆê¸°í™”
        try {
            status = trace.begin("OrderController.request()"); // Trace ì‹œì‘í•  ë•Œ, ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ê°€ ìˆìœ¼ë¯€ë¡œ í¬í•¨
            orderService.orderItem(itemId); // ex ì…ë ¥ ì‹œ, ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ìœ„í•œ try-catch
            trace.end(status);
            return "OK";
        } catch (Exception e) {
            trace.exception(status, e);
            throw e; // ì˜ˆì™¸ë¥¼ ê¼­ ë‹¤ì‹œ ë˜ì ¸ì¤˜ì•¼ í•¨ (ì˜ˆì™¸ê°€ í„°ì§€ë©´, ì˜ˆì™¸ê°€ ë‚˜ê°€ë„ë¡ í•´ì¤˜ì•¼ í•¨) (TraceëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì— ì˜í–¥ì„ ë¯¸ì¹˜ë©´ ì•ˆ ë¨)
        }
    }
}
```
  - HelloTraceV1 trace : HelloTraceV1ì„ ì£¼ì… ë°›ìŒ (ì°¸ê³ ë¡œ, HelloTraceV1ì€ @Component ì• ë„ˆí…Œì´ì…˜ì„ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ, ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì˜ ëŒ€ìƒì´ë¯€ë¡œ, ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡)
  - trace.begin("OrderController.request()") : ë¡œê·¸ë¥¼ ì‹œì‘í•  ë•Œ ë©”ì„¸ì§€ ì´ë¦„ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ì´ë¦„ + ë©”ì„œë“œ ì´ë¦„ì„ ì œê³µ (ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ë¡œê·¸ë¡œ í¸ë¦¬í•˜ê²Œ í™•ì¸í•˜ê¸° ìœ„í•¨)
  - ğŸ’¡ ë‹¨ìˆœíˆ trace.begin(), trace.end() ì½”ë“œ ë‘ ì¤„ë§Œìœ¼ë¡œ ì ìš©í•˜ë©´ ë  ì¤„ ì•Œì•˜ì§€ë§Œ, trace.exception()ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ê¹Œì§€ í•´ì•¼ ë˜ë¯€ë¡œ try-catchë¬¸ ì¶”ê°€
  - ğŸ’¡ begin()ì˜ ê²°ê³¼ ê°’ìœ¼ë¡œ ë°›ì€ TraceStatus status ê°’ì„ end(), exception()ì— ë„˜ê²¨ì¤˜ì•¼ í•¨
    + ê²°êµ­, try, catch ë¸”ë¡ ëª¨ë‘ ì´ ê°’ì„ ë„˜ê²¨ì•¼ í•¨
    + ë”°ë¼ì„œ, try ìƒìœ„ì— TraceStatus status ì½”ë“œë¥¼ ì„ ì–¸í•´ì•¼ í•¨
    + ğŸ’¡ ë§Œì•½, try ì•ˆì—ì„œ TraceStatus statusë¥¼ ì„ ì–¸í•˜ë©´ try ë¸”ë¡ ì•ˆì—ì„œë§Œ í•´ë‹¹ ë³€ìˆ˜ê°€ ìœ íš¨í•˜ë¯€ë¡œ catch ë¸”ë¡ìœ¼ë¡œ ë„˜ê¸¸ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì»´íŒŒì¼ ì˜¤ë¥˜ ë°œìƒ
  - throw e : ì˜ˆì™¸ë¥¼ ê¼­ ë‹¤ì‹œ ë˜ì ¸ì¤˜ì•¼ í•¨
    + ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ì—¬ê¸°ì„œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê³ , ì´í›„ ì •ìƒ íë¦„ìœ¼ë¡œ ë™ì‘
    + ğŸ’¡ ë¡œê·¸ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ íë¦„ì— ì˜í–¥ì„ ì£¼ë©´ ì•ˆ ë˜ëŠ” ìš”êµ¬ì‚¬í•­ì´ ì¡´ì¬í•˜ë¯€ë¡œ, ë¡œê·¸ ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ì‚¬ë¼ì§€ë©´ ì•ˆ ë¨

4. OrderServiceV1
```java
package hello.advanced.app.v1;

import hello.advanced.trace.TraceStatus;
import hello.advanced.trace.hellotrace.HelloTraceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class OrderServiceV1 {
    private final OrderRepositoryV1 orderRepository;
    private final HelloTraceV1 trace;
    
    public void orderItem(String itemId) {
        TraceStatus status = null;
        
        try {
            status = trace.begin("OrderService.orderItem()");
            orderRepository.save(itemId);
            trace.end(status);
        } catch (Exception e) {
            trace.exception(status, e);
            throw e; 
        }
    }
}
```

5. OrderRepositoryV1
```java
package hello.advanced.app.v1;

import hello.advanced.trace.TraceStatus;
import hello.advanced.trace.hellotrace.HelloTraceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

@Repository
@RequiredArgsConstructor
public class OrderRepositoryV1 {
    private final HelloTraceV1 trace;
    
    public void save(String itemId) {

        TraceStatus status = null;
        
        try {
            status = trace.begin("OrderRepository.save()");

            // ì €ì¥ ë¡œì§
            if (itemId.equals("ex")) {
                throw new IllegalStateException("ì˜ˆì™¸ ë°œìƒ");
            }

            sleep(1000);
            
            trace.end(status);
        } catch (Exception e) {
            trace.exception(status, e);
            throw e;
        }
    }

    private void sleep(int millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

  - ì •ìƒ ì‹¤í–‰ ë¡œê·¸
```
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [9135f349] OrderController.request()
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [02174180] OrderService.orderItem()
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [196a3d15] OrderRepository.save()
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [196a3d15] OrderRepository.save() time = 1002ms
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [02174180] OrderService.orderItem() time = 1002ms
[advanced] [nio-9090-exec-2] h.a.trace.hellotrace.HelloTraceV1        : [9135f349] OrderController.request() time = 1004ms
```

<div align="center">
<img src="https://github.com/user-attachments/assets/adddaa41-aee2-44be-aa82-b08301575936">
</div>

  - level ê´€ë ¨ ê¸°ëŠ¥ì„ ê°œë°œí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ í•­ìƒ levelì˜ ê°’ì€ 0
  - íŠ¸ëœì­ì…˜ ID ê°’ë„ ë‹¤ë¥¸ë°, ì´ ë¶€ë¶„ë„ ì•„ì§ ê°œë°œí•˜ì§€ ì•ŠìŒ

  - ì˜ˆì™¸ ì‹¤í–‰ ë¡œê·¸
```
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [01787ca2] OrderController.request()
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [8f80664a] OrderService.orderItem()
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [328514f2] OrderRepository.save()
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [328514f2] OrderRepository.save() time = 1ms, ex=java.lang.IllegalStateException: ì˜ˆì™¸ ë°œìƒ
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [8f80664a] OrderService.orderItem() time = 4ms, ex=java.lang.IllegalStateException: ì˜ˆì™¸ ë°œìƒ
[advanced] [nio-9090-exec-5] h.a.trace.hellotrace.HelloTraceV1        : [01787ca2] OrderController.request() time = 7ms, ex=java.lang.IllegalStateException: ì˜ˆì™¸ ë°œìƒ
```

-----
### ë‚¨ì€ ë¬¸ì œ
-----
1. ë©”ì„œë“œ í˜¸ì¶œì˜ ê¹Šì´ í‘œí˜„
2. HTTP ìš”ì²­ì„ êµ¬ë¶„
  + HTTP ìš”ì²­ ë‹¨ìœ„ë¡œ íŠ¹ì • IDë¥¼ ë‚¨ê²¨ì„œ ì–´ë–¤ HTTP ìš”ì²­ì—ì„œ ì‹œì‘ëœ ê²ƒì¸ì§€ ëª…í™•í•˜ê²Œ êµ¬ë¶„ì´ ê°€ëŠ¥í•´ì•¼ í•¨ 
  + íŠ¸ëœì­ì…˜ ID (DB íŠ¸ëœì­ì…˜X)

3. ì˜ˆë¥¼ ë“¤ì–´, OrderController.request()ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ë•Œ, ì–´ë–¤ ê¹Šì´ì™€ ì–´ë–¤ íŠ¸ëœì­ì…˜ IDë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ë¥¼ ê·¸ ë‹¤ìŒì— ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” OrderService.orderItem()ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ë•Œ ì•Œì•„ì•¼ í•¨
4. ê²°êµ­ í˜„ì¬ ë¡œê·¸ì˜ ìƒíƒœ ì •ë³´ì¸ íŠ¸ëœì­ì…˜ IDì™€ levelì´ ë‹¤ìŒìœ¼ë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•¨
5. ì •ë¦¬í•˜ë©´, ë¡œê·¸ì— ëŒ€í•œ ë¬¸ë§¥(Context) ì •ë³´ í•„ìš”
