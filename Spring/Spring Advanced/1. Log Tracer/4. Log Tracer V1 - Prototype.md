-----
### ë¡œê·¸ ì¶”ì ê¸° V1 - í”„ë¡œí†  íƒ€ìž… ê°œë°œ
-----
1. ìš”êµ¬ì‚¬í•­ì— ë§žì¶”ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— íš¨ê³¼ì ìœ¼ë¡œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•œ ë¡œê·¸ ì¶”ì ê¸° ê°œë°œ
2. ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ìœ„í•œ ê¸°ë°˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìžˆëŠ” TraceId, TraceStatus í´ëž˜ìŠ¤ ìƒì„±
3. TraceId
```java
package hello.advanced.trace;

import java.util.UUID;

public class TraceId {
    
    private String id; // Trace ID
    private int level; // Trace ê¹Šì´

    // ìƒì„±ìž (ì²˜ìŒ)
    public TraceId() {
        this.id = createId();
        this.level = 0;
    }

    // ë‹¤ìŒ, ì´ì „ ê¹Šì´ì— ëŒ€í•œ ìƒì„±ìž
    private TraceId(String id, int level) {
        this.id = id;
        this.level = level;
    }
    
    // TraceId ìƒì„±
    private String createId() {
        return UUID.randomUUID().toString().substring(0, 8); // UUID ì•žì˜ 8ìžë¦¬ë§Œ ì‚¬ìš©
    }
    
    // ë‹¤ìŒ ê¹Šì´ TraceId ìƒì„±
    public TraceId createNextId() {
        return new TraceId(id, level + 1);
    }

    // ì´ì „ ê¹Šì´ TraceId ìƒì„±
    public TraceId createPreviousId() {
        return new TraceId(id, level - 1);
    }
    
    // ì²« ë²ˆì§¸ ë ˆë²¨ì¸ì§€ í™•ì¸ ë©”ì„œë“œ
    public boolean isFirstLevel() {
        return level == 0;
    }
    
    // Getter
    public String getId() {
        return id;
    }

    public int getLevel() {
        return level;
    }
}
```

  - ë¡œê·¸ ì¶”ì ê¸°ëŠ” íŠ¸ëžœìž­ì…˜ IDì™€ ê¹Šì´ë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²• í•„ìš”
  - ì—¬ê¸°ì„œëŠ” íŠ¸ëžœìž­ì…˜ IDì™€ ê¹Šì´ë¥¼ í‘œí˜„í•˜ëŠ” levelì„ ë¬¶ì–´ì„œ TraceIdë¼ëŠ” ê°œë…ì„ ë§Œë“¤ì—ˆìŒ
  - TraceIdëŠ” ë‹¨ìˆœížˆ id(íŠ¸ëžœìž­ì…˜ id)ì™€ level ì •ë³´ë¥¼ í•¨ê»˜ ê°€ì§€ê³  ìžˆìŒ
  - ì˜ˆì‹œ
```
[796bccd9] OrderController.request()     // íŠ¸ëžœìž­ì…˜ID:796bccd9, level:0 
[796bccd9] |-->OrderService.orderItem()  // íŠ¸ëžœìž­ì…˜ID:796bccd9, level:1 
[796bccd9] |   |-->OrderRepository.save()// íŠ¸ëžœìž­ì…˜ID:796bccd9, level:2
```

4. UUID
   - TraceIdë¥¼ ì²˜ìŒ ìƒì„±í•˜ë©´ createId()ë¥¼ ìƒì„±í•´ UUIDë¥¼ ë§Œë“¤ì–´ëƒ„
   - UUIDê°€ ë„ˆë¬´ ê¸¸ì–´ì„œ ì—¬ê¸°ì„œëŠ” ì•ž 8ìžë¦¬ë§Œ ì‚¬ìš© (ì¶©ë¶„ížˆ ì´ ì •ë„ë©´, ë¡œê·¸ êµ¬ë¶„ ê°€ëŠ¥)
   - ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ê°’ì„ íŠ¸ëžœìž­ì…˜ IDë¡œ ì‚¬ìš©
```
ab99e16f-3cde-4d24-8241-256108c203a2 //ìƒì„±ëœ UUID 
ab99e16f //ì•ž 8ìžë¦¬ë§Œ ì‚¬ìš©
```

5. createNextId()
   - ë‹¤ìŒ TraceIdë¥¼ ë§Œë“¬
   - ì˜ˆì œ ë¡œê·¸ë¥¼ ë³´ë©´, ê¹Šì´ê°€ ì¦ê°€í•´ë„ íŠ¸ëžœìž­ì…˜ IDëŠ” ê°™ì§€ë§Œ, ê¹Šì´ê°€ í•˜ë‚˜ ì¦ê°€
   - ì‹¤í–‰ ì½”ë“œ : new TraceId(id, level + 1)
```
[796bccd9] OrderController.request()
[796bccd9] |-->OrderService.orderItem() // íŠ¸ëžœìž­ì…˜ IDê°€ ê°™ìŒ. ê¹Šì´ëŠ” í•˜ë‚˜ ì¦ê°€.
```
  - ë”°ë¼ì„œ, createNextId()ë¥¼ ì‚¬ìš©í•´ì„œ í˜„ìž¬ TraceIDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ TraceIdë¥¼ ë§Œë“¤ë©´, idëŠ” ê¸°ì¡´ê³¼ ê°™ê³ , levelì€ í•˜ë‚˜ ì¦ê°€

6. createPreviousId()
   - createNextId()ì˜ ë°˜ëŒ€ ì—­í• 
   - idëŠ” ê¸°ì¡´ê³¼ ê°™ê³ , levelì€ í•˜ë‚˜ ê°ì†Œ

7. isFirstLevel() : ì²« ë²ˆì¨° ë ˆë²¨ ì—¬ë¶€ë¥¼ íŽ¸ë¦¬í•˜ê²Œ í™•ì¸ í•  ìˆ˜ ìžˆëŠ” ë©”ì„œë“œ

8. TraceStauts
```java
package hello.advanced.trace;

public class TraceStatus {
    private TraceId traceId; // TraceId
    private Long startTimeMs;
    private String message;

    public TraceStatus(TraceId traceId, Long startTimeMs, String message) {
        this.traceId = traceId;
        this.startTimeMs = startTimeMs;
        this.message = message;
    }

    public TraceId getTraceId() {
        return traceId;
    }

    public Long getStartTimeMs() {
        return startTimeMs;
    }

    public String getMessage() {
        return message;
    }
}
```
  - ë¡œê·¸ì˜ ìƒíƒœ ì •ë³´ë¥¼ ë‚˜íƒ€ëƒ„
  - ë¡œê·¸ë¥¼ ì‹œìž‘í•˜ë©´ ëì´ ìžˆì–´ì•¼í•¨
```
[796bccd9] OrderController.request()  // ë¡œê·¸ ì‹œìž‘
[796bccd9] OrderController.request() time=1016ms // ë¡œê·¸ ì¢…ë£Œ
```
  - TraceStatusëŠ” ë¡œê·¸ë¥¼ ì‹œìž‘í•  ë•Œì˜ ìƒíƒœ ì •ë³´ë¥¼ ê°€ì§€ê³  ìžˆìŒ
  - ì´ ìƒíƒœ ì •ë³´ëŠ” ë¡œê·¸ë¥¼ ì¢…ë£Œí•  ë•Œ ì‚¬ìš©
    + traceId : ë‚´ë¶€ì˜ íŠ¸ëžœìž­ì…˜ IDì™€ levelì„ ê°€ì§€ê³  ìžˆìŒ
    + startTimeMs : ë¡œê·¸ ì‹œìž‘ ì‹œê°„ìœ¼ë¡œ, ë¡œê·¸ ì¢…ë£Œ ì‹œ ì´ ì‹œìž‘ ì‹œê°„ì„ ê¸°ì¤€ì„ ì‹œìž‘ ~ ì¢…ë£Œê¹Œì§€ì˜ ì „ì²´ ìˆ˜í–‰ ì‹œê°„ êµ¬í•  ìˆ˜ ìžˆìŒ
    + message : ì‹œìž‘ ì‹œ ì‚¬ìš©í•œ ë©”ì„¸ì§€ë¡œ, ì´í›„ ë¡œê·¸ ì¢…ë£Œ ì‹œì—ë„ ì´ ë©”ì„¸ì§€ë¥¼ ì‚¬ìš©í•´ ì¶œë ¥

9. TraceId, TraceStatusë¥¼ ì‚¬ìš©í•´ ì‹¤ì œ ë¡œê·¸ ìƒì„±, ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ ê°œë°œ - HelloTraceV1
```java
package hello.advanced.trace.hellotrace;

import hello.advanced.trace.TraceId;
import hello.advanced.trace.TraceStatus;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class HelloTraceV1 {
    private static final String START_PREFIX = "-->";
    private static final String COMPLETE_PREFIX = "<--";
    private static final String EX_PREFIX = "<X-";

    // TraceStatus ë°˜í™˜ (ì‹œìž‘) : ì˜ˆ) [796bccd9] OrderController.request()
    public TraceStatus begin(String message) {
        TraceId traceId = new TraceId();
        Long startTimeMs = System.currentTimeMillis();

        // ë¡œê·¸ ì¶œë ¥
        log.info("[{}] {}{}", traceId.getId(), addSpace(START_PREFIX, traceId.getLevel()),message);
        return new TraceStatus(traceId, startTimeMs, message);
    }

    // TraceStatus ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì‹¤í–‰ (ì¢…ë£Œ) : ì˜ˆ) [796bccd9] OrderController.request() time=1016ms
    public void end(TraceStatus status) {
        complete(status, null);
    }

    // ì •ìƒì ìœ¼ë¡œ ëë‚˜ì§€ ì•Šê³ , ì˜ˆì™¸ê°€ ë°œìƒí•  ê²½ìš° : ì˜ˆ) [b7119f27] OrderController.request() time=11ms ex=java.lang.IllegalStateException: ì˜ˆì™¸ ë°œìƒ!
    public void exception(TraceStatus status, Exception e) {
        complete(status, e);
    }

    private void complete(TraceStatus status, Exception e) {
        Long stopTimeMs = System.currentTimeMillis();
        long resultTimeMs = stopTimeMs - status.getStartTimeMs();

        TraceId traceId = status.getTraceId();

        if(e == null) {
            log.info("[{}] {}{} time = {}ms", traceId.getId(), addSpace(COMPLETE_PREFIX, traceId.getLevel()), status.getMessage(), resultTimeMs);
        }

        else {
            log.info("[{}] {}{} time = {}ms, ex={}", traceId.getId(), addSpace(EX_PREFIX, traceId.getLevel()), status.getMessage(), resultTimeMs, e.toString());
        }
    }

    /**
     * level = 0 
     * level = 1 |-->
     * level = 2 |   |-->
     * 
     * level = 2 |   |<x-
     * level = 1 |<x-|
     */
    private String addSpace(String prefix, int level) {
        StringBuilder sb = new StringBuilder();

        for(int i = 0; i < level; i++) {
            sb.append((i == level - 1) ?  "|" + prefix : "|   ");
        }

        return sb.toString();
    }
}
```
  - HelloTraceV1ë¥¼ ì‚¬ìš©í•´ì„œ ì‹¤ì œ ë¡œê·¸ë¥¼ ì‹œìž‘í•˜ê³  ì¢…ë£Œ ê°€ëŠ¥
  - ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê³  ì‹¤í–‰ì‹œê°„ë„ ì¸¡ì • ê°€ëŠ¥
  - ðŸ’¡ @Component : ì‹±ê¸€í†¤ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ (ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ëŒ€ìƒ)

10. ê³µê°œ ë©”ì„œë“œ
    - ë¡œê·¸ ì¶”ì ê¸°ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê³µê°œ ë©”ì„œë“œëŠ” 3ê°€ì§€
    - begin(...) : TraceStatus begin(String message)
      + ë¡œê·¸ë¥¼ ì‹œìž‘
      + ë¡œê·¸ ë©”ì„¸ì§€ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„, ì‹œìž‘ ë¡œê·¸ë¥¼ ì¶œë ¥
      + ì‘ë‹µ ê²°ê³¼ë¡œ í˜„ìž¬ ë¡œê·¸ ìƒíƒœì¸ TraceStatus ë°˜í™˜
        
    - end(...) : void end(TraceStatus status)
      + ë¡œê·¸ë¥¼ ì •ìƒ ì¢…ë£Œ
      + íŒŒë¼ë¯¸í„°ë¡œ ì‹œìž‘ ë¡œê·¸ì˜ ìƒíƒœ(TraceStatus)ë¥¼ ì „ë‹¬ ë°›ìŒ
      + ì´ ê°’ì„ í™œìš©í•´, ì‹¤í–‰ ì‹œê°„ì„ ê³„ì‚°í•˜ê³ , ì¢…ë£Œ ì‹œì—ë„ ì‹œìž‘í•  ë•Œì™€ ë™ì¼í•œ ë¡œê·¸ ë©”ì„¸ì§€ ì¶œë ¥ ê°€ëŠ¥
      + ì •ìƒ íë¦„ì—ì„œ í˜¸ì¶œ
        
    - exception(...) : void exception(TraceStatus status, Exception e)
      + ë¡œê·¸ë¥¼ ì˜ˆì™¸ ìƒí™©ìœ¼ë¡œ ì¢…ë£Œ
      + TraceStatus, Exception ì •ë³´ë¥¼ í•¨ê»˜ ë°›ì•„ì„œ ì‹¤í–‰ì‹œê°„, ì˜ˆì™¸ ì •ë³´ë¥¼ í¬í•¨í•œ ê²°ê³¼ ë¡œê·¸ë¥¼ ì¶œë ¥
      + ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œ

11. ë¹„ê³µê°œ ë©”ì„œë“œ
    - complete(TraceStatus status, Exception e)
      + end(), exception()ì˜ ìš”ì²­ íë¦„ì„ í•œ ê³³ì—ì„œ íŽ¸ë¦¬í•˜ê²Œ ì²˜ë¦¬
      + ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ë¡œê·¸ë¥¼ ë‚¨ê¹€
        
    - ðŸ’¡ String addSpace(String prefix, int level) : ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì¶œë ¥
      + prefix : ```-->```
        + level 0 :
        + level 1 : ```|-->```
        + level 2 : ```|   |-->```
       
      + prefix : ```<--```
        + level 0 :
        + level 1 : ```|<--```
        + level 2 : ```|   |<--```
       
      + prefix : ```<X-```
        + level 0 :
        + level 1 : ```|<X-```
        + level 2 : ```|   |<X-```

-----
### í…ŒìŠ¤íŠ¸ ìž‘ì„±
-----
1. HelloTraceV1Test (í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” test/java/ í•˜ìœ„ì— ìœ„ì¹˜)
```java
package hello.advanced.trace.hellotrace;

import hello.advanced.trace.TraceStatus;
import org.junit.jupiter.api.Test;

class HelloTraceV1Test {

    @Test
    void begin_end() {
        HelloTraceV1 trace = new HelloTraceV1();
        TraceStatus status = trace.begin("hello");
        trace.end(status);
    }

    @Test
    void begin_exception() {
        HelloTraceV1 trace = new HelloTraceV1();
        TraceStatus status = trace.begin("hello");
        trace.exception(status, new IllegalStateException());
    }
}
```

2. begin_end() - ì‹¤í–‰ ë¡œê·¸
```
[3a890381] hello
[3a890381] hello time = 1ms
```

3. begin_exception() - ì‹¤í–‰ ë¡œê·¸
```
[25fb767e] hello
[25fb767e] hello time = 18ms, ex=java.lang.IllegalStateException
```

4. ì´ëŠ” ì˜¨ì „í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì•„ë‹˜
5. ì¼ë°˜ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¼ê³  í•˜ë©´, ìžë™ìœ¼ë¡œ ê²€ì¦í•˜ëŠ” ê³¼ì •ì´ í•„ìš”
   - ì´ í…ŒìŠ¤íŠ¸ëŠ” ê²€ì¦í•˜ëŠ” ê³¼ì •ì´ ì—†ê³  ê²°ê³¼ë¥¼ ì½˜ì†”ë¡œ ì§ì ‘ í™•ì¸í•´ì•¼ í•¨
   - ì´ë ‡ê²Œ, ì‘ë‹µê°’ì´ ì—†ëŠ” ê²½ìš°ë¥¼ ìžë™ìœ¼ë¡œ ê²€ì¦í•˜ë ¤ë©´ ì—¬ëŸ¬ê°€ì§€ í…ŒìŠ¤íŠ¸ ê¸°ë²•ì´ í•„ìš”
